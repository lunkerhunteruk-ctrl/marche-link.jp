(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{8685:function(e,t,r){Promise.resolve().then(r.bind(r,6945))},6945:function(e,t,r){"use strict";r.d(t,{default:function(){return eD}});var a=r(7437),l=r(2265),n=r(9376);let i=(0,l.createContext)(null);function s(e){let{children:t}=e,[r,n]=(0,l.useState)([]),s=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;n(r=>r.find(t=>t.productId===e.id)?r.map(r=>r.productId===e.id?{...r,quantity:r.quantity+t}:r):[...r,{productId:e.id,quantity:t,product:e}])},[]),o=(0,l.useCallback)(e=>{n(t=>t.filter(t=>t.productId!==e))},[]),c=(0,l.useCallback)((e,t)=>{if(t<=0){n(t=>t.filter(t=>t.productId!==e));return}n(r=>r.map(r=>r.productId===e?{...r,quantity:t}:r))},[]),d=(0,l.useCallback)(()=>{n([])},[]),u=r.reduce((e,t)=>e+t.quantity,0),m=r.reduce((e,t)=>e+t.product.price*t.quantity,0);return(0,a.jsx)(i.Provider,{value:{items:r,addItem:s,removeItem:o,updateQuantity:c,clearCart:d,totalCount:u,totalYen:m},children:t})}function o(){let e=(0,l.useContext)(i);if(!e)throw Error("useCart must be used within CartProvider");return e}var c=r(6514),d=r(4770);let u=(0,l.createContext)(null);function m(){return(0,l.useContext)(u)||{storeName:"ショップ",storeIconUrl:null,storeDescription:null,theme:d.t,loading:!1,paymentMethodLabels:[],paymentDetails:{paypayUrl:null,cashEnabled:!1,bankDetails:null,customMethods:[]}}}function x(e){let{shop:t,children:r}=e,[n,i]=(0,l.useState)(null),[s,o]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=!1;return o(!0),(0,c.M)(t).then(t=>{e||i(t)}).catch(()=>{e||i({name:t||"ショップ",theme:d.t})}).finally(()=>{e||o(!1)}),()=>{e=!0}},[t]);let m=(0,l.useMemo)(()=>{var e,r,a,l;if(!n)return{storeName:t||"ショップ",storeIconUrl:null,storeDescription:null,theme:d.t,loading:s,paymentMethodLabels:[],paymentDetails:{paypayUrl:null,cashEnabled:!1,bankDetails:null,customMethods:[]}};let i=n.payment,o=[];(null==i?void 0:i.paypayEnabled)&&i.paypaySuffix&&o.push("PayPay"),(null==i?void 0:i.cashEnabled)&&o.push("現金手渡し"),(null==i?void 0:i.bankEnabled)&&o.push("銀行振込");let c=null!==(e=null==i?void 0:i.customMethods)&&void 0!==e?e:[];o.push(...c);let u=(null==i?void 0:i.paypayEnabled)&&i.paypaySuffix?d.W+i.paypaySuffix.replace(/^https:\/\/pay\.paypay\.ne\.jp\/?/i,""):null;return{storeName:n.name,storeIconUrl:null!==(r=n.iconUrl)&&void 0!==r?r:null,storeDescription:null!==(a=n.description)&&void 0!==a?a:null,theme:n.theme,loading:s,paymentMethodLabels:o,paymentDetails:{paypayUrl:u,cashEnabled:null!==(l=null==i?void 0:i.cashEnabled)&&void 0!==l&&l,bankDetails:(null==i?void 0:i.bankEnabled)&&(null==i?void 0:i.bankDetails)?i.bankDetails:null,customMethods:c}}},[n,t,s]);return(0,a.jsx)(u.Provider,{value:m,children:r})}var f=r(2532),h=r(8614),y=r(521),p=r(3468),g=r(5621),b=r(8997),v=r(7815),j=r(3491),w=r(7293);async function N(e,t){var r,a,l,n;let i=(0,w.lx)(),s=e.trim().toLowerCase();if(!i||!s)throw Error("ストア情報がありません");if(!(null===(r=t.items)||void 0===r?void 0:r.length)||t.totalAmount<0)throw Error("注文内容が不正です");let o=(0,w.V1)(i,"createOrderWithStock");try{let{data:e}=await o({shop:s,items:t.items,totalAmount:t.totalAmount,...t.lineUserId&&{lineUserId:t.lineUserId},...t.lineDisplayName&&{lineDisplayName:t.lineDisplayName},...t.linePictureUrl&&{linePictureUrl:t.linePictureUrl},...(null===(a=t.customerEmail)||void 0===a?void 0:a.trim())&&{customerEmail:t.customerEmail.trim()},...(null===(l=t.customerPhone)||void 0===l?void 0:l.trim())&&{customerPhone:t.customerPhone.trim()}});if(!(null==e?void 0:e.orderId))throw Error("注文の登録に失敗しました");return{orderId:e.orderId,orderNumber:"number"==typeof(null==e?void 0:e.orderNumber)?e.orderNumber:void 0}}catch(e){throw Error("string"==typeof e.message&&e.message&&"internal"!==e.message?e.message:null!==(n=e.details)&&void 0!==n?n:"注文できませんでした。しばらくしてから再試行してください。")}}async function k(e,t){let r=(0,w.lx)(),a=e.trim().toLowerCase();if(!r||!a||!t)throw Error("ストア情報または注文IDがありません");let l=(0,w.V1)(r,"cancelOrder"),{data:n}=await l({storeId:a,orderId:t});if(!(null==n?void 0:n.ok))throw Error("キャンセルに失敗しました")}async function C(e,t){let r=(0,w.lx)(),a=e.trim().toLowerCase();if(!r||!a||!t)throw Error("ストア情報または注文IDがありません");let l=(0,w.V1)(r,"requestOrderCancellation"),{data:n}=await l({storeId:a,orderId:t});if(!(null==n?void 0:n.ok))throw Error("キャンセル申請に失敗しました")}async function S(e,t){let r=(0,w.lx)(),a=e.trim().toLowerCase();if(!r||!a||!t)throw Error("ストア情報または注文IDがありません");let l=(0,w.V1)(r,"getOrderStatus"),{data:n}=await l({storeId:a,orderId:t}),i=null==n?void 0:n.status;return"unpaid"===i||"paid"===i||"canceled"===i||"cancel_requested"===i?i:"unpaid"}var I=r(6515);let E="marche-link-order-history-",A="marche-link-order-store-names",U="marche-link-order-recent-deletes";function D(e,t){if(0!==t.size)try{var r;let a=sessionStorage.getItem(U),l=a?JSON.parse(a):{},n=M(e),i=l[n],s=new Set(null!==(r=null==i?void 0:i.ids)&&void 0!==r?r:[]);t.forEach(e=>s.add(e)),l[n]={ids:Array.from(s),at:Date.now()},sessionStorage.setItem(U,JSON.stringify(l))}catch(e){}}function L(e,t){let r=function(e){try{let t=sessionStorage.getItem(U);if(!t)return new Set;let r=JSON.parse(t)[M(e)];if(!r||!Array.isArray(r.ids)||Date.now()-r.at>3e5)return new Set;return new Set(r.ids)}catch(e){return new Set}}(e);return 0===r.size?t:t.filter(e=>!r.has(e.id))}function O(e){return"".concat(E).concat(e.trim().toLowerCase())}function M(e){return e.trim().toLowerCase()}function P(e){return{...e,createdAt:new Date(e.createdAt)}}function T(){let e={};for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);if(!(null==r?void 0:r.startsWith(E)))continue;let a=r.slice(E.length);if(a)try{let t=localStorage.getItem(r);if(!t)continue;let l=JSON.parse(t);if(!Array.isArray(l))continue;let n=l.filter(e=>null!=e&&"object"==typeof e&&"string"==typeof e.createdAt).slice(0,50);n.length>0&&(e[a]=n)}catch(e){}}return e}function F(e){let t=O(e);if(!t)return[];try{let e=localStorage.getItem(t);if(!e)return[];let r=JSON.parse(e);if(!Array.isArray(r))return[];return r.filter(e=>null!=e&&"object"==typeof e&&"string"==typeof e.createdAt).map(P).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){return[]}}async function q(){let e=await (0,I.Tc)();if(e)try{let t=(0,w.lx)("asia-northeast1");if(t){let r=(0,w.V1)(t,"getCustomerOrderHistory"),{data:a}=await r({idToken:e}),l=Array.isArray(a.shops)?a.shops:[];if(0===l.length){let r=T(),a=Object.keys(r);if(a.length>0){let l=(0,w.V1)(t,"migrateCustomerOrderHistory");for(let t of(await l({idToken:e,ordersByShop:r}),a))try{localStorage.removeItem(O(t))}catch(e){}return a}}return l}}catch(e){}let t=[];for(let e=0;e<localStorage.length;e++){let r=localStorage.key(e);if(null==r?void 0:r.startsWith(E)){let e=r.slice(E.length);e&&F(e).length>0&&t.push(e)}}return Array.from(new Set(t))}function Z(e,t){if(!e.trim())return;let r=e.trim().toLowerCase();try{let e=localStorage.getItem(A),a=e?JSON.parse(e):{};a[r]=t.trim()||r,localStorage.setItem(A,JSON.stringify(a))}catch(e){}}async function V(e){let t=M(e);if(!t)return[];let r=await (0,I.Tc)();if(r)try{let l=(0,w.lx)("asia-northeast1");if(l){let n=(0,w.V1)(l,"getCustomerOrderHistory"),{data:i}=await n({idToken:r}),s=(i.ordersByShop&&"object"==typeof i.ordersByShop?i.ordersByShop:{})[t];if(Array.isArray(i.shops)&&0===i.shops.length){let e=T();if(Object.keys(e).length>0){var a;let i=(0,w.V1)(l,"migrateCustomerOrderHistory");for(let t of(await i({idToken:r,ordersByShop:e}),Object.keys(e)))try{localStorage.removeItem(O(t))}catch(e){}let o=await n({idToken:r});s=((null===(a=o.data)||void 0===a?void 0:a.ordersByShop)&&"object"==typeof o.data.ordersByShop?o.data.ordersByShop:{})[t]}}if(Array.isArray(s)&&s.length>0){let t=s.map(P).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime());return L(e,t)}return[]}}catch(e){}let l=F(e);return L(e,l)}function z(e,t){try{let r=F(e).filter(e=>!t.has(e.id)),a=O(e);0===r.length?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(r.map(e=>({...e,createdAt:e.createdAt.toISOString()}))))}catch(e){}}async function _(e,t){if(0===t.length)return;let r=M(e);if(!r)return;let a=new Set(t.map(e=>e.trim()).filter(Boolean));if(0===a.size)return;let l=await (0,I.Tc)();if(l)try{let t=(0,w.lx)("asia-northeast1");if(t){let n=(0,w.V1)(t,"deleteCustomerOrderHistoryEntries");await n({idToken:l,shop:r,orderIds:Array.from(a)}),z(e,a),D(e,a);return}}catch(e){}z(e,a),D(e,a)}async function J(e,t){var r,a;let l=M(e);if(!l)return;let n={id:t.id,customerId:"guest",items:t.items,totalAmount:t.totalAmount,status:null!==(r=t.status)&&void 0!==r?r:"unpaid",orderNumber:t.orderNumber,createdAt:new Date().toISOString()},i=await (0,I.Tc)();if(i)try{let e=(0,w.lx)("asia-northeast1");if(e){let r=(0,w.V1)(e,"addCustomerOrderToHistory");await r({idToken:i,shop:l,order:{id:t.id,items:t.items,totalAmount:t.totalAmount,status:null!==(a=t.status)&&void 0!==a?a:"unpaid",orderNumber:t.orderNumber}});return}}catch(e){}try{let t=F(e),r=[n,...t.map(e=>({...e,createdAt:e.createdAt.toISOString()}))].slice(0,50);localStorage.setItem(O(e),JSON.stringify(r))}catch(e){}}async function R(e,t,r){let a=M(e);if(!a)return;let l=await (0,I.Tc)();if(l)try{let e=(0,w.lx)("asia-northeast1");if(e){let n=(0,w.V1)(e,"setCustomerOrderStatus");await n({idToken:l,shop:a,orderId:t,status:r});return}}catch(e){}try{let a=F(e).map(e=>e.id!==t?{...e,createdAt:e.createdAt.toISOString()}:{...e,status:r,createdAt:e.createdAt.toISOString()});localStorage.setItem(O(e),JSON.stringify(a))}catch(e){}}async function W(e,t){let r=null==e?void 0:e.trim().toLowerCase();if(!r||!t)return!0;try{let e=(0,w.lx)("asia-northeast1");if(!e)return!0;let a=(0,w.V1)(e,"checkStoreAccess"),{data:l}=await a({storeId:r,idToken:t});return(null==l?void 0:l.allowed)!==!1}catch(e){return!0}}var B=r(1277),Q=r(9397);function K(e){let{product:t,onAdd:r,onTap:l}=e,n=t.stockQuantity<=0,{theme:i}=m();return(0,a.jsxs)(y.E.div,{className:"flex flex-col",initial:{opacity:0,y:16},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.3},children:[(0,a.jsxs)("div",{role:l?"button":void 0,tabIndex:l?0:void 0,onClick:l?()=>l(t):void 0,onKeyDown:l?e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),l(t))}:void 0,className:"relative aspect-square w-full cursor-pointer overflow-hidden rounded-2xl bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400",children:[t.imageUrl?(0,a.jsx)("img",{src:t.imageUrl,alt:t.title,className:"h-full w-full object-cover ".concat(n?"grayscale":"")}):(0,a.jsx)("div",{className:"h-full w-full bg-gray-200 ".concat(n?"grayscale":"")}),n&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,a.jsx)("span",{className:"rounded-lg bg-gray-900 px-3 py-1.5 text-sm font-semibold text-white",children:"SOLD OUT"})}),!n&&(0,a.jsx)(y.E.button,{type:"button",onClick:e=>{e.stopPropagation(),r(t)},className:"absolute bottom-2 right-2 flex h-10 w-10 items-center justify-center rounded-full shadow-md active:scale-95",style:{backgroundColor:i.buttonColor},whileTap:{scale:.92},"aria-label":"".concat(t.title,"をカートに追加"),children:(0,a.jsx)(Q.Z,{className:"h-5 w-5 text-white",strokeWidth:2.5})})]}),(0,a.jsx)("p",{className:"mt-2 line-clamp-2 text-sm font-medium text-gray-900",children:t.title}),(0,a.jsx)("p",{className:"mt-0.5 text-sm text-gray-600",children:function(e){let t=e.unit||"個";return"\xa5".concat(e.price.toLocaleString()," /").concat(t)}(t)})]})}var $=r(2489),G=r(1047);function H(e){var t,r,n;let{product:i,maxAddable:s,onClose:o,onAdd:c}=e,[d,u]=(0,l.useState)(0),[x,f]=(0,l.useState)(1),{theme:p}=m(),g=(null===(t=i.images)||void 0===t?void 0:t.length)?i.images:i.imageUrl?[i.imageUrl]:[],b=null!==(n=null!==(r=g[d])&&void 0!==r?r:i.imageUrl)&&void 0!==n?n:null,v=i.stockQuantity<=0,j=Math.max(0,s),w=0===j?0:Math.min(Math.max(1,x),j),N=(0,l.useCallback)(()=>{w<=0||(c(i,w),o())},[i,w,c,o]);return(0,a.jsx)(h.M,{children:(0,a.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",onClick:o,children:(0,a.jsxs)(y.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{type:"tween",duration:.2},className:"relative flex max-h-[90dvh] w-full max-w-[min(1000px,95vw)] flex-col overflow-hidden rounded-2xl bg-white shadow-xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{type:"button",onClick:o,className:"absolute top-3 right-3 z-10 flex h-10 w-10 items-center justify-center rounded-full bg-black/50 text-white transition hover:bg-black/70","aria-label":"閉じる",children:(0,a.jsx)($.Z,{className:"h-5 w-5",strokeWidth:2.5})}),(0,a.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col",children:[(0,a.jsxs)("div",{className:"relative aspect-square w-full shrink-0 bg-gray-100",children:[b?(0,a.jsx)("img",{src:b,alt:i.title,className:"h-full w-full object-contain"}):(0,a.jsx)("div",{className:"h-full w-full bg-gray-200"}),v&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,a.jsx)("span",{className:"rounded-lg bg-gray-900 px-3 py-1.5 text-sm font-semibold text-white",children:"SOLD OUT"})})]}),g.length>1&&(0,a.jsx)("div",{className:"flex gap-2 overflow-x-auto p-3",children:g.map((e,t)=>(0,a.jsx)("button",{type:"button",onClick:()=>u(t),className:"relative h-16 w-16 shrink-0 overflow-hidden rounded-lg border-2 bg-gray-100 ".concat(d===t?"border-gray-900 ring-2 ring-gray-400":"border-transparent"),children:(0,a.jsx)("img",{src:e,alt:"",className:"h-full w-full object-cover"})},"".concat(e,"-").concat(t)))}),(0,a.jsxs)("div",{className:"border-t border-gray-100 px-4 py-3",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:i.title}),(0,a.jsx)("p",{className:"mt-0.5 text-sm text-gray-600",children:function(e){let t=e.unit||"個";return"\xa5".concat(e.price.toLocaleString()," /").concat(t)}(i)}),i.description&&(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:i.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 border-t border-gray-100 px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>f(e=>Math.max(1,e-1)),disabled:w<=1,className:"flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 text-gray-700 disabled:opacity-40","aria-label":"数量を減らす",children:(0,a.jsx)(G.Z,{className:"h-4 w-4",strokeWidth:2.5})}),(0,a.jsx)("span",{className:"min-w-[2rem] text-center font-medium tabular-nums",children:w}),(0,a.jsx)("button",{type:"button",onClick:()=>f(e=>j?Math.min(j,e+1):e+1),disabled:j>0&&w>=j,className:"flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 text-gray-700 disabled:opacity-40","aria-label":"数量を増やす",children:(0,a.jsx)(Q.Z,{className:"h-4 w-4",strokeWidth:2.5})})]}),(0,a.jsx)("button",{type:"button",onClick:N,disabled:v||j<=0,className:"flex-1 rounded-xl py-3 font-medium text-white disabled:opacity-50",style:{backgroundColor:v||j<=0?"#9ca3af":p.buttonColor},children:"追加"})]})]})]})})})}function Y(){return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"aspect-square w-full overflow-hidden rounded-2xl bg-gray-200 animate-pulse"}),(0,a.jsx)("div",{className:"mt-2 h-4 w-3/4 rounded bg-gray-200 animate-pulse"}),(0,a.jsx)("div",{className:"mt-1 h-3 w-1/2 rounded bg-gray-100 animate-pulse"})]})}let X={products:{icon:r(4794).Z,title:"まだ商品がありません",description:"このショップでは現在、取り扱い商品がありません。"},history:{icon:g.Z,title:"注文履歴はありません",description:"過去の注文がここに表示されます。"}};function ee(e){let{variant:t}=e,{icon:r,title:l,description:n}=X[t];return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[(0,a.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-gray-100",children:(0,a.jsx)(r,{className:"h-10 w-10 text-gray-400","aria-hidden":!0})}),(0,a.jsx)("h3",{className:"mt-4 text-center text-lg font-medium text-gray-900",children:l}),(0,a.jsx)("p",{className:"mt-1 text-center text-sm text-gray-500",children:n})]})}var et=r(4274);function er(e){let{shop:t,onAddToCart:r}=e,[n,i]=(0,l.useState)(!0),[s,c]=(0,l.useState)(null),[d,u]=(0,l.useState)([]),[x,f]=(0,l.useState)(0),[p,g]=(0,l.useState)(null),[b,v]=(0,l.useState)(null),{items:j,addItem:w}=o(),N=(0,l.useCallback)((e,t)=>Math.max(0,t-j.filter(t=>t.productId===e).reduce((e,t)=>e+t.quantity,0)),[j]);(0,l.useEffect)(()=>{let e=!1;return i(!0),c(null),(async()=>{try{let r=await (0,I.Tc)(),a=await (0,et.xE)(t,r);e||u(a)}catch(t){e||(c(t instanceof Error?t.message:"商品の取得に失敗しました"),u([]))}finally{e||i(!1)}})(),()=>{e=!0}},[t,x]);let{theme:k}=m(),C=(0,l.useCallback)(e=>{if(0>=N(e.id,e.stockQuantity)){v("在庫残り0個です");return}w({id:e.id,title:e.title,imageUrl:e.imageUrl,price:e.price,unit:e.unit},1)},[N,w]),S=(0,l.useCallback)((e,t)=>{let r=N(e.id,e.stockQuantity),a=Math.min(t,r);if(a<=0){v("在庫残り0個です");return}a<t&&v("在庫残り".concat(r,"個です")),w({id:e.id,title:e.title,imageUrl:e.imageUrl,price:e.price,unit:e.unit},a),g(null)},[N,w]);return(0,l.useEffect)(()=>{if(!b)return;let e=setTimeout(()=>v(null),2500);return()=>clearTimeout(e)},[b]),(0,a.jsxs)("div",{className:"flex flex-col",children:[b&&(0,a.jsx)("div",{className:"fixed left-1/2 top-20 z-[55] -translate-x-1/2 rounded-xl bg-gray-900 px-4 py-2.5 text-sm font-medium text-white shadow-lg",role:"status","aria-live":"polite",children:b}),(0,a.jsx)("div",{className:"flex-1 px-4 py-4",children:n?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:[...Array(6)].map((e,t)=>(0,a.jsx)(Y,{},t))}):s?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("p",{className:"text-center text-red-600",children:s}),(0,a.jsx)("button",{type:"button",onClick:()=>{c(null),i(!0),f(e=>e+1)},className:"mt-4 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"再試行"})]}):0===d.length?(0,a.jsx)(ee,{variant:"products"}):(0,a.jsx)(h.M,{mode:"wait",children:(0,a.jsx)(y.E.div,{className:"grid grid-cols-2 gap-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:d.map(e=>(0,a.jsx)(K,{product:e,onAdd:C,onTap:()=>g(e)},e.id))})})}),p&&(0,a.jsx)(H,{product:p,maxAddable:N(p.id,p.stockQuantity),onClose:()=>g(null),onAdd:S})]})}var ea=r(8930),el=r(875);function en(e){return"\xa5".concat(e.toLocaleString())}function ei(e){let{shop:t,currentStoreName:r,orderHistoryVersion:n=0,onReorder:i}=e,[s,o]=(0,l.useState)(t),[u,x]=(0,l.useState)([]),[f,h]=(0,l.useState)([]),[y,p]=(0,l.useState)(!0),[g,b]=(0,l.useState)(!1),[v,j]=(0,l.useState)(new Set),[w,N]=(0,l.useState)(!1),{paymentDetails:k}=m(),[C,S]=(0,l.useState)(null),I=(0,l.useMemo)(()=>{let e=new Set(f);e.add(t);let a=Array.from(e).map(e=>({id:e,name:e===t?r:function(e){if(!e.trim())return null;let t=e.trim().toLowerCase();try{var r;let e=localStorage.getItem(A),a=e?JSON.parse(e):{};return null!==(r=a[t])&&void 0!==r?r:null}catch(e){return null}}(e)||e}));return[...a.filter(e=>e.id===t),...a.filter(e=>e.id!==t).sort((e,t)=>e.name.localeCompare(t.name,"ja"))]},[f,t,r]);(0,l.useEffect)(()=>{let e=!1;return p(!0),Promise.all([q(),V(s)]).then(r=>{let[a,l]=r;e||(h(Array.from(new Set([...a,t]))),x(l))}).finally(()=>{e||p(!1)}),()=>{e=!0}},[t,s,n]),(0,l.useEffect)(()=>{o(e=>f.includes(e)?e:t)},[t,f]),(0,l.useEffect)(()=>{if(!s||s===t){S(null);return}let e=!1;return(0,c.M)(s).then(t=>{var r,a;if(e)return;let l=t.payment;S({paypayUrl:(null==l?void 0:l.paypayEnabled)&&l.paypaySuffix?d.W+l.paypaySuffix.replace(/^https:\/\/pay\.paypay\.ne\.jp\/?/i,""):null,cashEnabled:null!==(r=null==l?void 0:l.cashEnabled)&&void 0!==r&&r,bankDetails:(null==l?void 0:l.bankEnabled)&&(null==l?void 0:l.bankDetails)?l.bankDetails:null,customMethods:null!==(a=null==l?void 0:l.customMethods)&&void 0!==a?a:[]})}).catch(()=>{e||S(null)}),()=>{e=!0}},[s,t]);let E=s===t?k:null!=C?C:{paypayUrl:null,cashEnabled:!1,bankDetails:null,customMethods:[]},U=(0,l.useCallback)(async()=>{x(await V(s))},[s]),D=(0,l.useCallback)(()=>{b(e=>!e),j(new Set)},[]),L=(0,l.useCallback)(e=>{j(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),O=(0,l.useCallback)(async()=>{if(0!==v.size){N(!0);try{await _(s,Array.from(v)),x(e=>e.filter(e=>!v.has(e.id))),j(new Set),b(!1)}finally{N(!1)}}},[s,v]);return(0,a.jsxs)("div",{className:"flex flex-col px-4 py-4 pb-[max(6rem,calc(5rem+env(safe-area-inset-bottom)))]",children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"注文履歴"}),u.length>0&&(0,a.jsx)("button",{type:"button",onClick:D,className:"p-2.5 rounded-full min-h-touch min-w-touch flex items-center justify-center shrink-0 ".concat(g?"bg-red-100 text-red-600":"text-gray-500 hover:bg-gray-100"),"aria-pressed":g,title:g?"削除モードを解除":"削除（タップで選択）","aria-label":g?"削除モードを解除":"削除",children:(0,a.jsx)(ea.Z,{className:"h-6 w-6","aria-hidden":!0})})]}),g&&(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("button",{type:"button",onClick:()=>j(new Set(u.map(e=>e.id))),className:"min-h-touch py-2 px-3 text-sm font-medium text-[var(--store-button)] bg-[var(--store-button)]/10 rounded-full",children:"全選択"}),(0,a.jsx)("button",{type:"button",onClick:()=>j(new Set),className:"min-h-touch py-2 px-3 text-sm font-medium text-gray-600 bg-gray-100 rounded-full",children:"解除"}),(0,a.jsx)("button",{type:"button",onClick:D,className:"min-h-touch py-2 px-3 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-full",children:"キャンセル"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600 shrink-0",children:"店舗:"}),(0,a.jsxs)("div",{className:"relative min-h-touch flex-1 flex items-center",children:[(0,a.jsx)("select",{value:s,onChange:e=>o(e.target.value),disabled:g,className:"min-h-touch w-full appearance-none rounded-xl border border-gray-300 bg-white pl-4 pr-10 py-2.5 text-sm font-medium text-gray-900 focus:border-[var(--store-button)] focus:outline-none focus:ring-2 focus:ring-[var(--store-button)]/30 disabled:opacity-70","aria-label":"表示する店舗の注文履歴を選択",children:I.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,a.jsx)(el.Z,{className:"absolute right-3 top-1/2 h-5 w-5 shrink-0 -translate-y-1/2 text-gray-400 pointer-events-none select-none","aria-hidden":!0})]})]})]}),y?(0,a.jsx)("div",{className:"flex justify-center py-8 text-sm text-gray-500",children:"読み込み中…"}):0===u.length?(0,a.jsx)(ee,{variant:"history"}):(0,a.jsx)("ul",{className:"space-y-4",children:u.map(e=>(0,a.jsx)("li",{className:g?"cursor-pointer":"",onClick:g?()=>L(e.id):void 0,onKeyDown:g?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),L(e.id))}:void 0,role:g?"button":void 0,tabIndex:g?0:void 0,"aria-pressed":g?v.has(e.id):void 0,children:(0,a.jsx)("div",{className:g&&v.has(e.id)?"ring-2 ring-red-500 ring-offset-2 rounded-2xl":"",children:(0,a.jsx)("div",{className:g?"pointer-events-none":"",children:(0,a.jsx)(es,{shop:s,order:e,paymentDetails:E,onReorder:i,onStatusUpdated:U})})})},e.id))}),g&&v.size>0&&(0,a.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-[60] flex justify-center px-4 pt-2 pb-[max(5rem,calc(4rem+env(safe-area-inset-bottom)))] bg-gradient-to-t from-black/30 to-transparent pointer-events-none","aria-hidden":!0,children:(0,a.jsxs)("div",{className:"w-full max-w-xs rounded-2xl bg-white shadow-lg border border-gray-200 p-4 pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"order-delete-dialog-title",children:[(0,a.jsxs)("h3",{id:"order-delete-dialog-title",className:"text-sm font-semibold text-gray-800",children:["削除（",v.size," 件）"]}),(0,a.jsx)("p",{className:"mt-1.5 text-xs text-gray-600",children:"取り消せません。"}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:D,disabled:w,className:"flex-1 min-h-touch py-2 rounded-xl border border-gray-300 text-gray-700 text-sm font-medium",children:"キャンセル"}),(0,a.jsx)("button",{type:"button",onClick:O,disabled:w,className:"flex-1 min-h-touch py-2 rounded-xl bg-red-600 text-white text-sm font-medium disabled:opacity-50",children:w?"削除中...":"削除する"})]})]})})]})}function es(e){var t,r,n;let{shop:i,order:s,paymentDetails:o,onReorder:c,onStatusUpdated:d}=e,[u,m]=(0,l.useState)(!1),[x,f]=(0,l.useState)(null),[h,p]=(0,l.useState)(null),[g,b]=(0,l.useState)(!1),v="canceled"===s.status,j="cancel_requested"===s.status,w="unpaid"===s.status,N=Date.now()-s.createdAt.getTime()<3e5;(0,l.useEffect)(()=>{if("cancel_requested"!==s.status)return;let e=!1;return b(!0),S(i,s.id).then(async t=>{e||(p(t),"canceled"!==t&&"unpaid"!==t||(await R(i,s.id,t),e||d()))}).catch(()=>{e||p("cancel_requested")}).finally(()=>{e||b(!1)}),()=>{e=!0}},[i,s.id,s.status,d]);let I="canceled"===h,E="unpaid"===h,A=v||j||j&&null!==h&&!g,U=async()=>{f(null),m(!0);try{await k(i,s.id),await R(i,s.id,"canceled"),d()}catch(e){f(e instanceof Error?e.message:"キャンセルに失敗しました")}finally{m(!1)}},D=async()=>{f(null),m(!0);try{await C(i,s.id),await R(i,s.id,"cancel_requested"),d()}catch(e){f(e instanceof Error?e.message:"キャンセル申請に失敗しました")}finally{m(!1)}},L=v||I?"canceled":E?"rejected":j?g?"checking":"pending":null;return(0,a.jsxs)(y.E.li,{className:"rounded-2xl border p-4 shadow-sm ".concat(A?"border-gray-200 bg-gray-100 opacity-90 max-w-full":"border-gray-200 bg-white"," ").concat(A?"px-5 py-5":""),initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["#",null!==(r=s.orderNumber)&&void 0!==r?r:s.id]}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:en(s.totalAmount)})]}),"canceled"===L&&!I&&(0,a.jsx)("p",{className:"mt-1 text-sm font-medium text-gray-600",children:"キャンセル"}),"pending"===L&&(0,a.jsx)("p",{className:"mt-1 text-sm font-medium text-amber-700",children:"キャンセル申請中（承認・拒否待ち）"}),"checking"===L&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"確認中…"}),I&&(0,a.jsx)("p",{className:"mt-1 rounded-lg bg-emerald-50 px-3 py-2.5 text-sm font-medium text-emerald-800",children:"承認されました"}),"rejected"===L&&(0,a.jsx)("p",{className:"mt-1 rounded-lg bg-amber-50 px-3 py-2.5 text-sm font-medium text-amber-800",children:"キャンセルはできませんでした"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:new Date(s.createdAt).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)("ul",{className:"mt-2 space-y-0.5 text-sm text-gray-700",children:s.items.map((e,t)=>(0,a.jsxs)("li",{children:[e.name," \xd7 ",e.quantity," — ",en(e.unitPrice*e.quantity)]},t))}),(o.paypayUrl||o.cashEnabled||o.bankDetails||(null!==(n=null===(t=o.customMethods)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0)&&(0,a.jsxs)("div",{className:"mt-3 rounded-xl border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700",children:[(0,a.jsx)("p",{className:"mb-1.5 font-medium text-gray-900",children:"支払い方法の詳細"}),o.paypayUrl&&(0,a.jsxs)("p",{className:"mt-1",children:["PayPay:"," ",(0,a.jsx)("a",{href:o.paypayUrl,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--store-button)] underline break-all",children:o.paypayUrl}),(0,a.jsxs)("span",{className:"text-gray-500",children:["（",en(s.totalAmount),"を送金）"]})]}),o.cashEnabled&&(0,a.jsx)("p",{className:"mt-1",children:"現金手渡し: 受取時に現金でお支払いください。"}),o.bankDetails&&(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("p",{className:"text-gray-900",children:"銀行振込:"}),(0,a.jsx)("pre",{className:"mt-0.5 whitespace-pre-wrap font-sans text-gray-700",children:o.bankDetails})]}),o.customMethods&&o.customMethods.length>0&&(0,a.jsxs)("p",{className:"mt-1",children:["その他: ",o.customMethods.join("、")]})]}),x&&(0,a.jsx)("p",{className:"mt-2 text-xs text-red-600",role:"alert",children:x}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[w&&N&&(0,a.jsx)("button",{type:"button",onClick:U,disabled:u,className:"w-full rounded-xl border border-red-200 bg-red-50 py-2.5 text-sm font-medium text-red-700 active:scale-[0.98] disabled:opacity-50",children:u?"処理中…":"キャンセルする"}),(w||E)&&!N&&(0,a.jsx)("button",{type:"button",onClick:D,disabled:u,className:"w-full rounded-xl border border-[var(--store-button)] bg-[var(--store-button)]/10 py-2.5 text-sm font-medium text-[var(--store-button)] active:scale-[0.98] disabled:opacity-50",children:u?"処理中…":"キャンセルをリクエストする"}),(0,a.jsx)("button",{type:"button",onClick:()=>c(s.items.map(e=>{var t;return{name:e.name,unitPrice:e.unitPrice,quantity:e.quantity,productId:e.productId,imageUrl:null!==(t=e.imageUrl)&&void 0!==t?t:null}})),className:"w-full rounded-xl border border-[var(--store-button)] py-2.5 text-sm font-medium text-[var(--store-button)] active:scale-[0.98]",children:"再注文する"})]})]})}var eo=r(7648);let ec="marche-link-favorite-stores";function ed(){try{let e=localStorage.getItem(ec);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];return t.filter(e=>null!=e&&"object"==typeof e&&"string"==typeof e.storeId&&"string"==typeof e.storeName)}catch(e){return[]}}function eu(e){try{localStorage.setItem(ec,JSON.stringify(e.slice(0,30)))}catch(e){}}async function em(){let e=await (0,I.Tc)();if(e)try{let r=(0,w.lx)("asia-northeast1");if(r){let a=(0,w.V1)(r,"getCustomerFavoriteStores"),{data:l}=await a({idToken:e});if(Array.isArray(l.stores)){let a=l.stores,n=ed();if(0===a.length&&n.length>0){let a=(0,w.V1)(r,"addCustomerFavoriteStore");for(let r of n.slice(0,30)){var t;await a({idToken:e,store:{storeId:r.storeId,storeName:r.storeName,iconUrl:null!==(t=r.iconUrl)&&void 0!==t?t:null}})}let l=n.slice(0,30);return eu([]),l}return a}}}catch(e){}return ed()}async function ex(e){var t,r;let a;let l=e.storeId.trim().toLowerCase();if(!l)return;let n=await (0,I.Tc)();if(n)try{let r=(0,w.lx)("asia-northeast1");if(r){let a=(0,w.V1)(r,"addCustomerFavoriteStore");await a({idToken:n,store:{storeId:l,storeName:(e.storeName||l).trim(),iconUrl:null!==(t=e.iconUrl)&&void 0!==t?t:null}});return}}catch(e){}let i=ed(),s=i.findIndex(e=>e.storeId.toLowerCase()===l),o={storeId:l,storeName:(e.storeName||l).trim(),iconUrl:null!==(r=e.iconUrl)&&void 0!==r?r:null,addedAt:new Date().toISOString()};s>=0?(a=[...i])[s]={...o,addedAt:a[s].addedAt}:a=[o,...i],eu(a)}async function ef(e){let t=e.trim().toLowerCase();if(!t)return;let r=await (0,I.Tc)();if(r)try{let e=(0,w.lx)("asia-northeast1");if(e){let a=(0,w.V1)(e,"removeCustomerFavoriteStore");await a({idToken:r,storeId:t});return}}catch(e){}eu(ed().filter(e=>e.storeId.toLowerCase()!==t))}function eh(e){let{store:t,onRemove:r,themeColor:l}=e,n=(t.storeName||t.storeId).slice(0,1).toUpperCase(),i="/order?shop=".concat(encodeURIComponent(t.storeId));return(0,a.jsxs)("div",{className:"relative flex shrink-0 flex-col items-center",children:[(0,a.jsxs)(eo.default,{href:i,className:"flex flex-col items-center gap-1.5 active:opacity-80","aria-label":"".concat(t.storeName,"のストアページへ"),children:[(0,a.jsx)("div",{className:"relative h-16 w-16 shrink-0 overflow-hidden rounded-full border-2 border-white bg-gray-200 shadow-md ring-1 ring-gray-200",children:t.iconUrl?(0,a.jsx)("img",{src:t.iconUrl,alt:"",className:"h-full w-full object-cover"}):(0,a.jsx)("span",{className:"flex h-full w-full items-center justify-center text-xl font-semibold text-gray-600",style:{backgroundColor:l,color:"white"},children:n})}),(0,a.jsx)("span",{className:"max-w-[72px] truncate text-center text-xs font-medium text-gray-700",children:t.storeName||t.storeId})]}),(0,a.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},className:"absolute -right-0.5 top-0 flex h-5 w-5 items-center justify-center rounded-full bg-gray-400 text-white shadow","aria-label":"お気に入りから削除",children:(0,a.jsx)($.Z,{className:"h-3 w-3"})})]})}function ey(e){var t;let{shop:r}=e,{storeName:n,storeIconUrl:i,theme:s}=m(),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!0),x=(0,l.useCallback)(async()=>{u(!0);try{let e=await em();c(e)}finally{u(!1)}},[]);(0,l.useEffect)(()=>{x()},[x]);let f=!!r&&function(e,t){let r=e.trim().toLowerCase();return!!r&&t.some(e=>e.storeId.toLowerCase()===r)}(r,o),h=null!==(t=null==r?void 0:r.trim().toLowerCase())&&void 0!==t?t:"",y=(0,l.useCallback)(async()=>{if(!h)return;let e=n||h;await ex({storeId:h,storeName:e,iconUrl:i}),Z(h,e),await x()},[h,n,i,x]),p=(0,l.useCallback)(async e=>{await ef(e),await x()},[x]);return(0,a.jsxs)("div",{className:"px-4 py-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"お気に入り"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"よく使うストアを追加すると、ここからすぐ開けます。LINE でログインしていると端末を変えても残ります。"}),d?(0,a.jsx)("p",{className:"mt-6 text-sm text-gray-500",children:"読み込み中..."}):(0,a.jsxs)(a.Fragment,{children:[h&&!f&&(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-3 rounded-xl border border-dashed border-gray-300 bg-gray-50/80 p-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 shrink-0 overflow-hidden rounded-full border-2 border-white bg-gray-200",children:i?(0,a.jsx)("img",{src:i,alt:"",className:"h-full w-full object-cover"}):(0,a.jsx)("span",{className:"flex h-full w-full items-center justify-center text-lg font-semibold text-white",style:{backgroundColor:s.primaryColor},children:(n||r).slice(0,1).toUpperCase()})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"truncate font-medium text-gray-900",children:n||r}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"このストアをお気に入りに追加"})]}),(0,a.jsx)("button",{type:"button",onClick:y,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-white shadow-md active:scale-95",style:{backgroundColor:s.primaryColor},"aria-label":"お気に入りに追加",children:(0,a.jsx)(Q.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"mt-6",children:0===o.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"お気に入りのストアはまだありません。"}):(0,a.jsx)("div",{className:"flex flex-wrap gap-6",children:o.map(e=>(0,a.jsx)(eh,{store:e,onRemove:()=>p(e.storeId),themeColor:s.primaryColor},e.storeId))})})]})]})}var ep=r(6337),eg=r(4413),eb=r(8728),ev=r(9090),ej=r(31);let ew=ej.G$;function eN(e){let{shop:t}=e,{theme:r}=m(),[n,i]=(0,l.useState)(null),[s,o]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=!1;return(async()=>{try{var r,a,l,n;let s=await (0,I.Tc)(),c=(0,w.lx)("asia-northeast1");if(!c){e||(i(!1),o([]));return}let[d,u]=await Promise.all([t&&s?(0,w.V1)(c,"isStoreOwnerForCustomer")({storeId:t,idToken:s}).catch(()=>({data:{isOwner:!1}})):Promise.resolve({data:{isOwner:!1}}),s?(0,w.V1)(c,"getMyStoreIdsForCustomer")({idToken:s}).catch(()=>({data:{storeIds:[]}})):Promise.resolve({data:{storeIds:[]}})]);if(e)return;i(null!==(l=null===(r=d.data)||void 0===r?void 0:r.isOwner)&&void 0!==l&&l),o(null!==(n=null===(a=u.data)||void 0===a?void 0:a.storeIds)&&void 0!==n?n:[])}catch(t){e||(i(!1),o([]))}})(),()=>{e=!0}},[t]);let c=Array.isArray(s)&&s.length>0,d=c?s[0]:"",u=function(e){let t=e.trim().toLowerCase();return t?"".concat(ej.Dj,"?shop=").concat(encodeURIComponent(t)):""}(d),x=(null!=t?t:"").trim().toLowerCase(),f=d&&x===d.trim().toLowerCase();return(0,a.jsxs)("div",{className:"flex min-h-[50dvh] flex-col px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"マイページ"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"設定やお知らせはここに表示されます。"})]}),null===s?(0,a.jsx)("p",{className:"mt-8 text-center text-sm text-gray-500",children:"読み込み中..."}):c?(0,a.jsxs)("div",{className:"mt-auto flex flex-col items-center gap-4 pb-8 pt-12",children:[!0===n&&(0,a.jsxs)("p",{className:"mb-2 flex items-center gap-1.5 text-xs text-gray-500",children:[(0,a.jsx)(ep.Z,{className:"h-3.5 w-3.5 shrink-0","aria-hidden":!0}),"一般のお客様には表示されていません"]}),u&&!f&&(0,a.jsxs)("a",{href:u,className:"flex min-h-touch w-full max-w-xs items-center justify-center gap-2 rounded-xl border-2 border-gray-300 bg-white px-4 py-3 text-base font-medium text-gray-700 shadow-sm active:scale-[0.99]",children:[(0,a.jsx)(eg.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),"自分のストアページ"]}),(0,a.jsxs)("a",{href:ew,className:"flex min-h-touch w-full max-w-xs items-center justify-center gap-2 rounded-xl px-4 py-3 text-base font-medium text-white shadow-sm active:scale-[0.99]",style:{backgroundColor:r.buttonColor},children:[(0,a.jsx)(eb.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),"マイストア管理画面"]})]}):(0,a.jsxs)("div",{className:"mt-8 flex flex-col items-center rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,a.jsx)("p",{className:"text-center font-medium text-gray-800",children:"開店まで、わずか30秒。"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm leading-relaxed text-gray-600",children:"ショップ名を入力するだけで、LINEのなかでお店をオープンできます。"}),(0,a.jsxs)("div",{className:"mt-6 flex w-full max-w-xs flex-col gap-3",children:[(0,a.jsxs)("a",{href:ej.lG,className:"flex min-h-touch items-center justify-center gap-2 rounded-xl px-4 py-3 text-base font-medium text-white shadow-sm active:scale-[0.99]",style:{backgroundColor:r.buttonColor},children:[(0,a.jsx)(eg.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),"ショップ名を入れて開店"]}),(0,a.jsxs)("a",{href:ej.lG,className:"flex min-h-touch items-center justify-center gap-2 rounded-xl border-2 border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 active:scale-[0.99]",children:[(0,a.jsx)(ev.Z,{className:"h-4 w-4 shrink-0","aria-hidden":!0}),"ログイン"]})]}),(0,a.jsx)("p",{className:"mt-4 text-center text-xs text-gray-500",children:"マルシェリンク marche-link.jp"})]})]})}var ek=r(6275);function eC(e){let{onOpenDrawer:t}=e,{items:r,totalCount:l,totalYen:n}=o(),{theme:i}=m();return(0,a.jsx)(h.M,{children:r.length>0&&(0,a.jsxs)(y.E.button,{type:"button",onClick:t,className:"absolute left-4 right-4 bottom-full z-40 mb-2 flex items-center justify-center gap-2 rounded-xl px-4 py-3 text-white shadow-lg active:scale-[0.98]",style:{backgroundColor:i.buttonColor},initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},"aria-label":"カートを見る",children:[(0,a.jsx)(ek.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),(0,a.jsxs)("span",{className:"font-medium",children:["カートを見る（",l,"点 \xa5",n.toLocaleString(),"）"]})]})})}function eS(e){let{open:t,onClose:r,onConfirmOrder:l,isSubmitting:n=!1,submitError:i=null}=e,{items:s,updateQuantity:c,removeItem:d,totalCount:u,totalYen:x}=o(),{theme:f,paymentMethodLabels:p}=m();return(0,a.jsx)(h.M,{children:t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.E.div,{className:"fixed inset-0 z-50 bg-black/40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,"aria-hidden":!0}),(0,a.jsxs)(y.E.div,{className:"fixed inset-x-0 bottom-0 z-50 flex max-h-[70dvh] flex-col rounded-t-2xl bg-white shadow-xl",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},role:"dialog","aria-modal":"true","aria-labelledby":"cart-drawer-title",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 py-3",children:[(0,a.jsxs)("h2",{id:"cart-drawer-title",className:"text-lg font-semibold text-gray-900",children:["カート（",u,"点）"]}),(0,a.jsx)("button",{type:"button",onClick:r,className:"flex h-10 w-10 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100","aria-label":"閉じる",children:(0,a.jsx)($.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:0===s.length?(0,a.jsx)("p",{className:"py-8 text-center text-sm text-gray-500",children:"カートに商品がありません"}):(0,a.jsx)("ul",{className:"space-y-3",children:s.map(e=>(0,a.jsxs)("li",{className:"flex items-center gap-3 rounded-xl border border-gray-100 bg-gray-50/50 p-3",children:[e.product.imageUrl?(0,a.jsx)("img",{src:e.product.imageUrl,alt:"",className:"h-14 w-14 shrink-0 rounded-lg object-cover"}):(0,a.jsx)("div",{className:"h-14 w-14 shrink-0 rounded-lg bg-gray-200"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"truncate text-sm font-medium text-gray-900",children:e.product.title}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["\xa5",e.product.price.toLocaleString()," /",e.product.unit]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>c(e.productId,e.quantity-1),className:"flex h-8 w-8 items-center justify-center rounded-full border border-gray-200 bg-white text-gray-600 active:scale-95","aria-label":"数量を減らす",children:(0,a.jsx)(G.Z,{className:"h-4 w-4"})}),(0,a.jsx)("span",{className:"w-8 text-center text-sm font-medium",children:e.quantity}),(0,a.jsx)("button",{type:"button",onClick:()=>c(e.productId,e.quantity+1),className:"flex h-8 w-8 items-center justify-center rounded-full border border-gray-200 bg-white text-gray-600 active:scale-95","aria-label":"数量を増やす",children:(0,a.jsx)(Q.Z,{className:"h-4 w-4"})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>d(e.productId),className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full text-gray-400 hover:bg-red-50 hover:text-red-600","aria-label":"削除",children:(0,a.jsx)(ea.Z,{className:"h-4 w-4"})})]},e.productId))})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 bg-white px-4 py-4 pb-[env(safe-area-inset-bottom)]",children:[i&&(0,a.jsx)("p",{className:"mb-3 text-center text-sm text-red-600",children:i}),p.length>0&&(0,a.jsxs)("p",{className:"mb-2 text-xs text-gray-500",children:["支払い方法: ",p.join(" / ")]}),(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"合計"}),(0,a.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["\xa5",x.toLocaleString()]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>l(),disabled:0===s.length||n,className:"flex w-full items-center justify-center rounded-xl py-4 text-base font-semibold text-white active:scale-[0.98] disabled:opacity-50",style:{backgroundColor:f.buttonColor},children:n?"送信中…":"注文を確定する"})]})]})]})})}let eI="marche-link-order-try-order-modal-seen",eE=[{id:"home",label:"商品一覧",Icon:p.Z},{id:"history",label:"注文履歴",Icon:g.Z},{id:"favorites",label:"お気に入り",Icon:b.Z},{id:"user",label:"マイページ",Icon:v.Z}];function eA(e){let{shop:t}=e,[r,n]=(0,l.useState)("home"),[i,s]=(0,l.useState)(!1),[c,d]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),[b,v]=(0,l.useState)(!1),k=(0,l.useRef)(!1),{items:C,totalYen:S,addItem:E,clearCart:A}=o(),{storeName:U,storeIconUrl:D,storeDescription:L,theme:O,loading:M}=m(),{minimized:P}=(0,f.n)();(0,l.useEffect)(()=>{let e=!1;return(async()=>{let r=await (0,I.Tc)(),a=await W(t,r);e||x(a)})(),()=>{e=!0}},[t]),(0,l.useEffect)(()=>{if(!t)return;k.current=!1;let e=!1;return(async()=>{try{var r,a;let l=await (0,I.Tc)(),n=(0,w.lx)("asia-northeast1");if(!n||!l){e||g(!1);return}let i=await (0,j.V1)(n,"isStoreOwnerForCustomer")({storeId:t.trim().toLowerCase(),idToken:l});if(e)return;let s=null!==(a=null===(r=i.data)||void 0===r?void 0:r.isOwner)&&void 0!==a&&a;g(s),!s||k.current||(k.current=!0,"1"===localStorage.getItem(eI)||(localStorage.setItem(eI,"1"),e||v(!0)))}catch(t){e||g(!1)}})(),()=>{e=!0}},[t]);let[T,F]=(0,l.useState)(!1),q=O.buttonColor||O.primaryColor,V=M||"#2563eb"===q?"#6b7280":q;(0,l.useEffect)(()=>(document.title="".concat(U," ストアページ"),()=>{document.title="ストアページ"}),[U]),(0,l.useEffect)(()=>{t&&U&&Z(t,U)},[t,U]);let[z,_]=(0,l.useState)(null),[R,Q]=(0,l.useState)(0),K=(0,l.useMemo)(()=>({"--store-primary":O.primaryColor,"--store-button":O.buttonColor,"--store-header":O.headerColor,"--store-bg":O.backgroundColor,"--store-text":O.textColor,"--store-font":O.fontFamily}),[O]),$=(0,l.useCallback)(e=>{E(e)},[E]),G=(0,l.useCallback)(async()=>{if(0!==C.length){_(null),F(!0);try{let e=null,r=null;try{e=await (0,I.o$)()}catch(e){}try{r=await (0,I.cz)()}catch(e){}let a={items:C.map(e=>({productId:e.productId,name:e.product.title,unitPrice:e.product.price,quantity:e.quantity})),totalAmount:S,...e&&{lineUserId:e.userId,lineDisplayName:e.displayName,linePictureUrl:e.pictureUrl},...(null==r?void 0:r.trim())&&{customerEmail:r.trim()}},{orderId:l,orderNumber:i}=await N(t,a),o=a.items.map(e=>{var t,r;return{...e,imageUrl:null!==(r=null===(t=C.find(t=>t.productId===e.productId))||void 0===t?void 0:t.product.imageUrl)&&void 0!==r?r:null}});await J(t,{id:l,orderNumber:i,...a,items:o,status:"unpaid"}),Q(e=>e+1),A(),s(!1),n("history"),d(!0),setTimeout(()=>d(!1),2500)}catch(e){_(e instanceof Error?e.message:"注文の送信に失敗しました")}finally{F(!1)}}},[t,C,S,A]),H=(0,l.useCallback)(e=>{let t=Date.now();e.forEach((e,r)=>{var a,l;E({id:null!==(a=e.productId)&&void 0!==a?a:"reorder-".concat(t,"-").concat(r),title:e.name,imageUrl:null!==(l=e.imageUrl)&&void 0!==l?l:null,price:e.unitPrice,unit:"個"},e.quantity)}),n("home")},[E]);return null===u||M?(0,a.jsx)("div",{className:"relative flex min-h-[100dvh] flex-col items-center justify-center p-6",style:{backgroundColor:O.backgroundColor},children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"読み込み中..."})}):!1===u?(0,a.jsxs)("div",{className:"relative flex min-h-[100dvh] flex-col items-center justify-center p-6",style:{backgroundColor:O.backgroundColor},children:[(0,a.jsx)("p",{className:"text-center font-medium text-gray-900",children:"アクセスできません"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-500",children:"このストアからのアクセスはブロックされています。"})]}):P?(0,a.jsx)(B.u,{}):(0,a.jsxs)("div",{className:"relative flex min-h-[100dvh] flex-col",style:{...K,backgroundColor:O.backgroundColor},children:[(0,a.jsx)("header",{className:"sticky top-0 z-10 border-b border-gray-200/80 bg-white/80 px-4 py-3 backdrop-blur-md shrink-0",style:{color:O.textColor},children:(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[D?(0,a.jsx)("div",{className:"h-9 w-9 shrink-0 overflow-hidden rounded-full border border-gray-200 bg-gray-100",children:(0,a.jsx)("img",{src:D,alt:"",className:"h-full w-full object-cover"})}):null,(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold",style:{fontFamily:O.fontFamily},children:U}),L?(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-0.5 truncate",style:{fontFamily:O.fontFamily},children:L}):null]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;let r=null==t?void 0:t.trim().toLowerCase();if(!r)return;let a=(null===(e=window.location)||void 0===e?void 0:e.origin)?window.location.origin:"https://".concat("marche-link.jp"),l="".concat(a,"/order/?").concat(new URLSearchParams({shop:r}).toString());window.open("https://line.me/R/msg/text/?".concat(encodeURIComponent(l)),"_blank","noopener,noreferrer")},className:"shrink-0 h-8 w-8 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-500","aria-label":"LINEで送る",children:(0,a.jsx)("img",{src:"/line-share-icon.png",alt:"LINEで送る",className:"h-full w-full object-contain"})})]})}),(0,a.jsx)("main",{className:"flex-1 min-h-0 overflow-auto overscroll-y-none pt-4 pb-28",children:(0,a.jsxs)(h.M,{mode:"wait",children:["home"===r&&(0,a.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"min-h-[60dvh]",children:(0,a.jsx)(er,{shop:t,onAddToCart:$})},"home"),"history"===r&&(0,a.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:(0,a.jsx)(ei,{shop:t,currentStoreName:U,orderHistoryVersion:R,onReorder:H})},"history"),"favorites"===r&&(0,a.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:(0,a.jsx)(ey,{shop:t})},"favorites"),"user"===r&&(0,a.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:(0,a.jsx)(eN,{shop:t})},"user")]})}),(0,a.jsx)(h.M,{children:c&&(0,a.jsx)(y.E.div,{className:"fixed left-1/2 top-8 z-[60] -translate-x-1/2 rounded-xl px-6 py-3 text-white shadow-lg",style:{backgroundColor:O.buttonColor},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:(0,a.jsxs)("span",{className:"flex items-center gap-2 font-medium",children:[(0,a.jsx)(eU,{}),"注文が完了しました"]})})}),(0,a.jsxs)("div",{className:"fixed inset-x-0 bottom-0 z-30 px-4 pt-1.5 pb-[max(0.65rem,env(safe-area-inset-bottom))] bg-gray-50",children:[(0,a.jsx)(eC,{onOpenDrawer:()=>s(!0)}),(0,a.jsx)("nav",{className:"mx-auto max-w-md","aria-label":"メインナビゲーション",children:(0,a.jsx)("div",{className:"flex rounded-full bg-gray-200 p-1 shadow-sm",children:eE.map(e=>{let{id:t,label:l,Icon:i}=e;return(0,a.jsxs)("button",{type:"button",onClick:()=>n(t),className:"flex min-h-touch flex-1 flex-col items-center justify-center rounded-full py-2 text-[11px] font-medium transition-colors duration-200 active:opacity-90 ".concat(r===t?"text-white shadow-sm":"text-gray-700"),style:r===t?{backgroundColor:V}:void 0,"aria-current":r===t?"page":void 0,children:[(0,a.jsx)(i,{className:"h-6 w-6 shrink-0 ".concat(r===t?"stroke-[2.5px]":""),"aria-hidden":!0}),(0,a.jsx)("span",{className:"mt-0.5 text-[11px]",children:l})]},t)})})})]}),(0,a.jsx)(eS,{open:i,onClose:()=>{s(!1),_(null)},onConfirmOrder:G,isSubmitting:T,submitError:z}),b&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"owner-try-order-modal-title",children:(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-2xl bg-white p-5 shadow-lg",children:[(0,a.jsx)("h2",{id:"owner-try-order-modal-title",className:"text-center text-sm font-medium text-gray-800",children:"実際に売れたらどうなるか、自分で1回注文して試してみよう！"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!1),className:"mt-4 w-full min-h-touch rounded-xl py-3 text-sm font-medium text-white active:opacity-90",style:{backgroundColor:O.buttonColor||O.primaryColor},children:"わかった"})]})})]})}function eU(){return(0,a.jsx)(y.E.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:400,damping:20},children:(0,a.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})}function eD(){var e,t;let r=null!==(t=null===(e=(0,n.useSearchParams)().get("shop"))||void 0===e?void 0:e.trim().toLowerCase())&&void 0!==t?t:"",[i,o]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{if(r){o(!1);return}let e=setTimeout(()=>o(!0),1200);return()=>clearTimeout(e)},[r]),r)?(0,a.jsx)(s,{children:(0,a.jsx)(x,{shop:r,children:(0,a.jsx)(f.y,{children:(0,a.jsx)(eA,{shop:r})})})}):i?(0,a.jsxs)("main",{className:"flex min-h-[100dvh] flex-col items-center justify-center p-6",children:[(0,a.jsx)("p",{className:"text-center text-gray-600",children:"ショップが指定されていません。"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-500",children:"リンクまたは QR コードからアクセスしてください。"})]}):(0,a.jsx)("main",{className:"flex min-h-[100dvh] flex-col items-center justify-center p-6",children:(0,a.jsx)("p",{className:"text-center text-gray-500",children:"準備中..."})})}},1277:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});var a=r(7437),l=r(2532),n=r(6515),i=r(2489);function s(){let{setMinimized:e}=(0,l.n)();return(0,a.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 z-[100] flex items-center justify-between border-t border-gray-200 bg-white/95 px-4 py-3 pb-safe-bottom shadow-lg backdrop-blur-md",role:"banner",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>e(!1),className:"flex min-h-touch flex-1 items-center gap-2 text-left","aria-label":"元に戻す",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"マルシェリンク"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"タップで元に戻す"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>(0,n.lA)(),className:"flex min-h-touch min-w-touch items-center justify-center rounded-full p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700","aria-label":"アプリを閉じる",children:(0,a.jsx)(i.Z,{className:"h-5 w-5",strokeWidth:2.5})})]})}},31:function(e,t,r){"use strict";r.d(t,{Dj:function(){return f},G$:function(){return s},KC:function(){return x},SX:function(){return d},bm:function(){return c},hD:function(){return o},lG:function(){return m},p3:function(){return i},s1:function(){return n},tE:function(){return u}});var a,l=r(257);let n="2009034946-GQ1UQIRr".trim()||"2009034946-GQ1UQIRr",i=(null===(a=l.env.NEXT_PUBLIC_LIFF_ID_ADMIN_DIRECT)||void 0===a?void 0:a.trim())||"2009034946-LkF5LngF",s="https://liff.line.me/2009034946-LkF5LngF",o="2009034946-KaRhKY16".trim()||"2009034946-KaRhKY16",c="https://marche-link.jp/admin-entry/",d="https://marche-link.jp/admin/",u="marche-link-liff-inited",m="https://liff.line.me/".concat(n,"/"),x="https://liff.line.me/".concat(i,"/"),f="https://liff.line.me/".concat(o)},2532:function(e,t,r){"use strict";r.d(t,{n:function(){return s},y:function(){return i}});var a=r(7437),l=r(2265);let n=(0,l.createContext)(null);function i(e){let{children:t}=e,[r,i]=(0,l.useState)(!1),s={minimized:r,setMinimized:(0,l.useCallback)(e=>i(e),[])};return(0,a.jsx)(n.Provider,{value:s,children:t})}function s(){let e=(0,l.useContext)(n);return null===e?{minimized:!1,setMinimized:()=>{}}:e}},7293:function(e,t,r){"use strict";r.d(t,{E7:function(){return x},G5:function(){return m},T:function(){return f},V1:function(){return i.V1},lx:function(){return h}});var a=r(738),l=r(3301),n=r(5978),i=r(3491);let s={apiKey:"AIzaSyCa4s0nrtJe2PNf86c3843MVDsL6fpwljQ",authDomain:"marche-link.firebaseapp.com",projectId:"marche-link",storageBucket:"marche-link.firebasestorage.app",messagingSenderId:"1006467595458",appId:"1:1006467595458:web:ecf555e02bb7335e5dcf5b"},o=null,c=null,d=null,u=!1;function m(){if(!s.apiKey||!s.projectId)return null;if(o)return o;if(u)return null;try{let e=(0,a.C6)();return o=e.length>0?e[0]:(0,a.ZF)(s)}catch(e){return u=!0,"undefined"!=typeof console&&console.warn&&console.warn("[Firebase] 初期化に失敗しました",e),null}}function x(){try{let e=m();if(!e)return null;return c||(c=(0,l.v0)(e)),c}catch(e){return null}}function f(){try{let e=m();if(!e)return null;return d||(d=(0,n.ad)(e)),d}catch(e){return null}}function h(e){try{let t=m();if(!t)return null;return(0,i.$C)(t,null!=e?e:"asia-northeast1")}catch(e){return null}}},6515:function(e,t,r){"use strict";r.d(t,{$w:function(){return o},DT:function(){return c},Lq:function(){return u},Tc:function(){return x},cz:function(){return f},jl:function(){return d},lA:function(){return h},o$:function(){return m}});let a=null,l=null,n=!1,i=!1;async function s(){if(a)return a;try{return a=(await r.e(949).then(r.bind(r,2949))).default}catch(e){return null}}async function o(e){return(i||(i=!0,window.addEventListener("pagehide",()=>{l=null,a=null,n=!0})),l)?l:l=(async()=>{let t=e;window.location.pathname.startsWith("/admin")&&!window.location.pathname.startsWith("/admin-entry")&&(e.endsWith("KaRhKY16")||e.includes("KaRhKY16"))&&(t="2009034946-LkF5LngF");let r=await s();r&&(n||!r.id)&&(n&&(n=!1),await new Promise(e=>requestAnimationFrame(()=>e())),await r.init({liffId:t}))})().catch(e=>{throw l=null,e})}function c(){if(!a)return!1;try{return a.isInClient()}catch(e){return!1}}function d(){if(!a)return!1;try{return a.isLoggedIn()}catch(e){return!1}}function u(e){a&&a.login({redirectUri:e})}async function m(){var e;let t=await s();if(!t)throw Error("LIFF が利用できません");let r=await t.getProfile();return{userId:r.userId,displayName:null!==(e=r.displayName)&&void 0!==e?e:"",pictureUrl:r.pictureUrl}}async function x(){let e=await s();if(!e||"function"!=typeof e.getIDToken)return null;try{let t=await e.getIDToken();return t&&"string"==typeof t?t:null}catch(e){return null}}async function f(){let e=await s();if(!e||"function"!=typeof e.getDecodedIDToken)return null;try{let t=e.getDecodedIDToken();if((null==t?void 0:t.email)&&"string"==typeof t.email&&t.email.trim())return t.email.trim();return null}catch(e){return null}}function h(){(null==a?void 0:a.closeWindow)&&a.closeWindow()}},4274:function(e,t,r){"use strict";r.d(t,{a9:function(){return n},xE:function(){return i}});var a=r(5978),l=r(7293);async function n(e){let t=(0,l.T)(),r=e.trim().toLowerCase();if(!t||!r)return[];let n=(await (0,a.PL)((0,a.hJ)(t,"stores",r,"products"))).docs,i=n.map(e=>(function(e){var t;let r=e.data(),a="string"==typeof(null==r?void 0:r.imageUrl)?r.imageUrl:null,l=(Array.isArray(null==r?void 0:r.images)?r.images:[]).filter(e=>"string"==typeof e),n=l.length>0?l:a?[a]:[],i=null!==(t=n[0])&&void 0!==t?t:null,s=(null==r?void 0:r.published)!==!1,o="number"==typeof(null==r?void 0:r.stockQuantity)?Math.max(0,r.stockQuantity):0,c="string"==typeof(null==r?void 0:r.description)&&r.description.trim()?r.description.trim():void 0;return{id:e.id,title:"string"==typeof(null==r?void 0:r.title)?r.title:"（無題）",description:c,imageUrl:i,images:n,price:"number"==typeof(null==r?void 0:r.price)?r.price:0,stockQuantity:o,unit:"string"==typeof(null==r?void 0:r.unit)?r.unit:"個",published:s}})(e)).filter(e=>e.published);if(n.length>0){let e=new Map(n.map(e=>[e.id,e]));i.sort((t,r)=>{var a,l,n,i,s,o,c,d,u,m;let x=null!==(u=null===(i=e.get(t.id))||void 0===i?void 0:null===(n=i.data())||void 0===n?void 0:null===(l=n.createdAt)||void 0===l?void 0:null===(a=l.toMillis)||void 0===a?void 0:a.call(l))&&void 0!==u?u:0;return(null!==(m=null===(d=e.get(r.id))||void 0===d?void 0:null===(c=d.data())||void 0===c?void 0:null===(o=c.createdAt)||void 0===o?void 0:null===(s=o.toMillis)||void 0===s?void 0:s.call(o))&&void 0!==m?m:0)-x})}return i}async function i(e,t){let r=e.trim().toLowerCase();if(!r)return[];try{let a=(0,l.lx)("asia-northeast1");if(!a)return n(e);let i=(0,l.V1)(a,"getStorefrontProductsForCustomer"),s={storeId:r};t&&(s.idToken=t);let{data:o}=await i(s);return Array.isArray(null==o?void 0:o.products)?o.products:[]}catch(t){return n(e)}}},6514:function(e,t,r){"use strict";r.d(t,{M:function(){return s}});var a=r(5978),l=r(7293),n=r(4770);function i(e){if("string"!=typeof e)return null;let t=e.trim();if(/^#[0-9A-Fa-f]{6}$/.test(t))return t;if(/^#[0-9A-Fa-f]{3}$/.test(t)){let e=t[1]+t[1],r=t[2]+t[2],a=t[3]+t[3];return"#".concat(e).concat(r).concat(a)}return null}async function s(e){let t=(0,l.T)(),r=e.trim().toLowerCase();if(!t||!r)return{name:r||"ショップ",theme:n.t,description:void 0,payment:{paypayEnabled:!1,paypaySuffix:"",cashEnabled:!1,bankEnabled:!1,bankDetails:"",customMethods:[]}};let s=await (0,a.QT)((0,a.JU)(t,"stores",r));if(!s.exists())return{name:r,theme:n.t,description:void 0,payment:{paypayEnabled:!1,paypaySuffix:"",cashEnabled:!1,bankEnabled:!1,bankDetails:"",customMethods:[]}};let o=s.data(),c="string"==typeof(null==o?void 0:o.name)&&o.name.trim()?o.name.trim():r,d="string"==typeof(null==o?void 0:o.iconUrl)&&o.iconUrl.trim()?o.iconUrl.trim():null,u="string"==typeof(null==o?void 0:o.description)&&o.description.trim()?o.description.trim():null,m=function(e){var t,r,a,l,s,o,c,d;if(!e||"object"!=typeof e)return n.t;let u=e.theme;if(!u||"object"!=typeof u)return n.t;let m=null!==(r=i(null!==(t=u.primaryColor)&&void 0!==t?t:u.buttonColor))&&void 0!==r?r:n.t.primaryColor,x=null!==(l=i(null!==(a=u.buttonColor)&&void 0!==a?a:u.primaryColor))&&void 0!==l?l:m,f=null!==(o=i(null!==(s=u.headerColor)&&void 0!==s?s:u.primaryColor))&&void 0!==o?o:m;return{primaryColor:m,buttonColor:x,headerColor:f,backgroundColor:null!==(c=i(u.backgroundColor))&&void 0!==c?c:n.t.backgroundColor,textColor:null!==(d=i(u.textColor))&&void 0!==d?d:n.t.textColor,fontFamily:"string"==typeof u.fontFamily&&/^(sans-serif|serif|monospace)$/.test(u.fontFamily)?u.fontFamily:n.t.fontFamily}}(o),x=null==o?void 0:o.paymentCustomMethods,f=[];if(Array.isArray(x))for(let e of x)e&&"object"==typeof e&&"string"==typeof e.label?e.label.trim()&&!0===e.enabled&&f.push(e.label.trim()):"string"==typeof e&&e.trim()&&f.push(e.trim());return{name:c,iconUrl:null!=d?d:void 0,description:null!=u?u:void 0,theme:m,payment:{paypayEnabled:(null==o?void 0:o.paymentPayPayEnabled)===!0,paypaySuffix:"string"==typeof(null==o?void 0:o.paymentPayPaySuffix)?o.paymentPayPaySuffix.trim():"",cashEnabled:(null==o?void 0:o.paymentCashEnabled)!==!1,bankEnabled:(null==o?void 0:o.paymentBankEnabled)===!0,bankDetails:"string"==typeof(null==o?void 0:o.paymentBankDetails)?o.paymentBankDetails.trim():"",customMethods:f}}}},4770:function(e,t,r){"use strict";r.d(t,{W:function(){return l},t:function(){return a}});let a={primaryColor:"#6b7280",buttonColor:"#6b7280",headerColor:"#4b5563",backgroundColor:"#f9fafb",textColor:"#111827",fontFamily:"sans-serif"},l="https://pay.paypay.ne.jp/"}},function(e){e.O(0,[358,990,249,648,268,971,117,744],function(){return e(e.s=8685)}),_N_E=e.O()}]);