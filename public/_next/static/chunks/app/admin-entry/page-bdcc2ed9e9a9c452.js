(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62],{3322:function(e,t,n){Promise.resolve().then(n.bind(n,2805))},2805:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var r=n(7437),a=n(2265),s=n(9376),i=n(5978),l=n(31),c=n(6515),o=n(7293),u=n(9450),d=n(3582),m=n(6363),h=n(2498),f=n(8736),x=n(3117),p=n(3388),g=n(2023),j=n(6275),b=n(4794),w=n(2718),N=n(9090),y=n(4413);function v(e){let{hasUser:t,ctaLoading:n=!1,onLogin:s,onSubmitShopName:i,loginLoading:l=!1}=e,[c,o]=(0,a.useState)(!1),[u,d]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[v,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=document.title;return document.title="マルシェリンク | 30秒で開ける、あなたのネットショップ",()=>{document.title=e}},[]);let S=(0,a.useCallback)(async()=>{let e=u.trim();if(!e){k("ショップ名を入力してください。");return}k(null),h(!0);try{await i(e)}catch(e){k(e instanceof Error?e.message:"開店処理に失敗しました。")}finally{h(!1)}},[u,i]);return(0,r.jsx)("div",{className:"min-h-screen flex flex-col bg-earth-50",role:"main","aria-labelledby":"admin-landing-title",children:(0,r.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto",children:[(0,r.jsx)("section",{className:"relative w-full bg-earth-100",children:(0,r.jsxs)("div",{className:"aspect-square max-w-md mx-auto w-full relative overflow-hidden",children:[c?(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-earth-200 via-earth-100 to-earth-200","aria-hidden":!0}):(0,r.jsx)("img",{src:"/LP02.jpg",alt:"こだわりのお店を、スマートに。マルシェリンクで叶える",className:"absolute inset-0 w-full h-full object-cover",width:1e3,height:1e3,sizes:"(max-width: 448px) 100vw, 448px",onError:()=>o(!0)}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-earth-900/60 via-transparent to-transparent"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-5 pb-8 text-white",children:(0,r.jsxs)("h1",{id:"admin-landing-title",className:"font-serif text-xl sm:text-2xl font-semibold leading-snug tracking-wide drop-shadow",children:["名前を決めるだけで、",(0,r.jsx)("br",{}),"あなたらしいお店がそこに。"]})})]})}),(0,r.jsxs)("section",{className:"w-full py-4 px-5 text-center",style:{backgroundColor:"#8B7E74"},"aria-label":"料金について",children:[(0,r.jsx)("p",{className:"font-serif text-white text-lg font-medium",children:"初期費用・月額費用・販売手数料 ずっと0円。"}),(0,r.jsx)("p",{className:"mt-1 text-white/95 text-sm font-sans",children:"売上はすべて作り手のもの。まずはリスクなく始められます。"})]}),(0,r.jsx)("section",{className:"px-5 pt-8 pb-6 max-w-lg mx-auto",children:(0,r.jsx)("p",{className:"font-serif text-earth-800 text-[15px] leading-relaxed tracking-wide",children:"ショップ名に込めた想いを、私たちがデザインに仕立てます。 難しい設定も、長い準備もいりません。 あなたの「売りたい」と思った瞬間に、素敵な店構えでお客様をお迎えしましょう。"})}),(0,r.jsxs)("section",{className:"px-5 pb-10 max-w-lg mx-auto",children:[(0,r.jsx)("h2",{className:"font-serif text-earth-800 text-lg font-semibold text-center mb-6",children:"もう、事務作業に追われる必要はありません。"}),(0,r.jsxs)("div",{className:"rounded-2xl border border-earth-200/80 bg-earth-100 overflow-hidden shadow-sm",children:[(0,r.jsxs)("div",{className:"p-5 pb-4 bg-earth-200/50 border-b border-earth-200/80",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-300/80 text-earth-700",children:(0,r.jsx)(f.Z,{className:"h-4 w-4","aria-hidden":!0})}),(0,r.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-300/80 text-earth-700",children:(0,r.jsx)(x.Z,{className:"h-4 w-4","aria-hidden":!0})})]}),(0,r.jsx)("p",{className:"font-sans text-earth-700 text-sm leading-relaxed",children:"手書きの伝票、散らばるDM、夜中の電卓計算…"})]}),(0,r.jsx)("div",{className:"flex items-center justify-center py-2 text-earth-400","aria-hidden":!0,children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,r.jsxs)("div",{className:"p-5 pt-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,r.jsx)(p.Z,{className:"h-4 w-4","aria-hidden":!0})}),(0,r.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,r.jsx)(g.Z,{className:"h-4 w-4","aria-hidden":!0})})]}),(0,r.jsx)("p",{className:"font-sans text-earth-800 text-sm leading-relaxed",children:"マルシェリンクなら、スマホひとつで完結。あなたの時間は、ものづくりのために。"})]})]})]}),(0,r.jsxs)("section",{className:"px-5 space-y-8 pb-10 max-w-lg mx-auto",children:[(0,r.jsxs)("article",{className:"flex gap-4",children:[(0,r.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,r.jsx)(j.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"職人の手仕事に、スマートな管理を"}),(0,r.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"注文を一元管理。手書きのメモやSNSのDMに埋もれていた注文を、ひとつの場所へ。 受注からお届けまで、大切な商品を待つお客様一人ひとりと、ゆとりを持って向き合えます。"})]})]}),(0,r.jsxs)("article",{className:"flex gap-4",children:[(0,r.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,r.jsx)(b.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"撮る、並べる、それだけで開店"}),(0,r.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"商品登録がかんたん。今日焼けた最高のパン、今朝採れたての野菜。 写真を撮って価格を添えるだけで、あなたのショップが色鮮やかに。 「今、一番いいもの」を、すぐにお客さまの元へ届けられます。"})]})]}),(0,r.jsxs)("article",{className:"flex gap-4",children:[(0,r.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,r.jsx)(w.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"いつものLINEで、心通う商売"}),(0,r.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"LINEでお客様とつながる。使い慣れたLINEの中に、あなたのお店を。 お客様はトーク画面から流れるように注文でき、 店主のあなたは、日々の暮らしの延長で軽やかにお店を運営できます。"})]})]})]}),(0,r.jsxs)("section",{className:"px-5 pt-4 pb-[max(2.5rem,env(safe-area-inset-bottom))] max-w-md mx-auto w-full border-t border-earth-200/80 bg-earth-50/90",children:[(0,r.jsx)("p",{className:"font-serif text-earth-800 text-lg font-medium text-center mt-6",children:"開店まで、わずか30秒。"}),(0,r.jsx)("p",{className:"text-earth-700 text-sm text-center mt-2 leading-relaxed",children:"あなたのショップ名を入力して、下のボタンで開店してください。 未ログインの場合は先にログインしてください。"}),(0,r.jsx)("div",{className:"mt-6 flex flex-col gap-3",children:n?(0,r.jsxs)("div",{className:"space-y-3 text-center py-2","aria-live":"polite",children:[(0,r.jsx)("p",{className:"text-earth-700 text-sm",children:"準備しています..."}),(0,r.jsx)("div",{className:"flex justify-center","aria-hidden":!0,children:(0,r.jsx)("span",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-earth-400 border-t-earth-600"})})]}):t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"block",children:[(0,r.jsx)("span",{className:"sr-only",children:"ショップ名"}),(0,r.jsx)("input",{type:"text",value:u,onChange:e=>{d(e.target.value),k(null)},placeholder:"例: 陽だまりパン工房",className:"w-full rounded-2xl border-2 border-earth-300 bg-white px-4 py-3 text-base text-earth-900 placeholder:text-earth-400 focus:border-earth-500 focus:outline-none focus:ring-2 focus:ring-earth-500/20",autoComplete:"organization",disabled:m})]}),v&&(0,r.jsx)("p",{className:"text-amber-700 text-sm text-center",role:"alert",children:v}),(0,r.jsxs)("button",{type:"button",onClick:S,disabled:m||!u.trim(),className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl bg-earth-600 px-5 py-4 text-base font-semibold text-white shadow-md transition-[transform,opacity] hover:opacity-95 hover:scale-[1.02] active:bg-earth-700 active:scale-[0.99] disabled:opacity-50 disabled:scale-100",children:[(0,r.jsx)(y.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),m?"開店処理中…":"ショップ名を入力して開店する"]}),(0,r.jsx)("p",{className:"text-earth-600/80 text-xs text-center font-sans",children:"※ クレジットカード登録は不要です"})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-earth-700 text-sm text-center",children:"はじめるにはログインしてください。"}),(0,r.jsxs)("button",{type:"button",onClick:s,disabled:l,className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl border-2 border-earth-400 bg-earth-50 px-4 py-3 text-sm font-medium text-earth-800 active:bg-earth-100 disabled:opacity-60",children:[(0,r.jsx)(N.Z,{className:"h-4 w-4 shrink-0","aria-hidden":!0}),l?"ログイン中…":"ログイン"]})]})}),(0,r.jsx)("p",{className:"text-earth-500 text-xs text-center mt-4",children:"マルシェリンク marche-link.jp"})]})]})})}let k=[0,400,900,1500,2200,3e3,3900,4900,6e3,7200],S=[0,300,600,1e3];function I(){return"qrcode"===new URLSearchParams(window.location.search).get("go")}function E(){"undefined"!=typeof document&&(document.body.dataset.adminReady="1");let e=(0,s.useRouter)(),[t,n]=(0,a.useState)(!1),[f,x]=(0,a.useState)("loading"),[p,g]=(0,a.useState)(null),[j,b]=(0,a.useState)(null),w=(0,a.useRef)(!1),N=(0,a.useRef)(!1),y=(0,a.useRef)(!0);(0,a.useEffect)(()=>{n(I())},[]),(0,a.useEffect)(()=>{if(!w.current)return w.current=!0,N.current=!1,(async()=>{{let e=new URLSearchParams(window.location.search),t=e.get("open"),n="orders"===e.get("go");if("/admin/orders/"===t||n){window.location.href="".concat(l.SX,"?open=").concat(encodeURIComponent("/admin/orders/"));return}}if(await new Promise(e=>setTimeout(e,500)),!N.current)for(let a=0;a<k.length;a++){if(N.current||a>0&&(await new Promise(e=>setTimeout(e,k[a])),N.current))return;try{var t,n,r;if(await Promise.race([(0,c.$w)(l.s1),new Promise((e,t)=>setTimeout(()=>t(Error("LIFF の初期化がタイムアウトしました")),2e4))]),N.current)return;let a=(0,c.DT)(),s=(0,c.jl)();if(a&&!s)for(let e of S){if(e>0&&(await new Promise(t=>setTimeout(t,e)),N.current))return;if(s=(0,c.jl)())break}if(a&&!s){y.current=!1,b(null),x("no_store");return}let i=await (0,c.Tc)();if(!i){y.current=!1,"undefined"!=typeof sessionStorage&&sessionStorage.setItem(l.tE,"1"),b(null),x("no_store");return}if(await (0,u.T)(i),N.current)return;let d=(0,o.E7)(),m=null==d?void 0:null===(t=d.currentUser)||void 0===t?void 0:t.uid;if(!m)for(let e of[0,100,200,400,600]){if(e>0&&await new Promise(t=>setTimeout(t,e)),N.current)return;if(m=null!==(r=null==d?void 0:null===(n=d.currentUser)||void 0===n?void 0:n.uid)&&void 0!==r?r:void 0)break}if(!m){y.current=!1,"undefined"!=typeof sessionStorage&&sessionStorage.setItem(l.tE,"1"),x("redirect");let t=I();e.replace(t?"/admin/qrcode/":"/admin/?open="+encodeURIComponent("/admin/orders/"));return}y.current=!1;let h=await (0,u.k)(m);if(N.current)return;if(h.length>=1){"undefined"!=typeof sessionStorage&&sessionStorage.setItem(l.tE,"1"),x("redirect");let t=I();e.replace(t?"/admin/qrcode/":"/admin/?open="+encodeURIComponent("/admin/orders/"));return}"undefined"!=typeof sessionStorage&&sessionStorage.setItem(l.tE,"1"),b(m),x("no_store");return}catch(t){if(N.current)return;let e=t instanceof Error?t.message:String(t);a===k.length-1&&(y.current=!1,g(e),x("error"))}}})(),()=>{N.current=!0,w.current=!1}},[]);let E=(0,a.useCallback)(async t=>{let{storeId:n,buttonColor:r}=await (0,d.W)(t);try{let e=await (0,m.$)(t,r),a=new FormData;a.append("image",e,"icon.jpg"),a.append("subdomain",n);let s=h.E.baseUrl,l=await fetch("".concat(s,"/upload-shop-icon.php"),{method:"POST",body:a}),c=await l.json().catch(()=>({}));if(l.ok&&c.success&&"string"==typeof c.url){let e=(0,o.T)();if(e){let t=c.url.startsWith("http")?c.url:"".concat(s).concat(c.url);await (0,i.r7)((0,i.JU)(e,"stores",n),{iconUrl:t,updatedAt:(0,i.Bt)()})}}}catch(e){}sessionStorage.setItem(l.tE,"1"),sessionStorage.setItem("marche-link-admin-just-created-shop","1"),e.push("/admin/products/quick?created=".concat(encodeURIComponent(t)))},[e]);return"login"===f?(0,r.jsx)(v,{hasUser:!1,ctaLoading:!0,onLogin:()=>(0,c.Lq)(l.bm),onSubmitShopName:E}):"redirect"===f?(0,r.jsx)("main",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50",children:(0,r.jsx)("p",{className:"text-gray-600",children:"管理画面へ移動しています..."})}):"no_store"===f?(0,r.jsx)(v,{hasUser:!!j,ctaLoading:!1,onLogin:()=>(0,c.Lq)(l.bm),onSubmitShopName:E}):"error"===f?(0,r.jsxs)("main",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50 max-w-md mx-auto",children:[(0,r.jsx)("p",{className:"text-red-600 font-medium mb-2",children:"読み込みに失敗しました"}),p&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:p}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"下のリンクをタップして、もう一度お試しください。"}),(0,r.jsx)("a",{href:l.bm,target:"_self",rel:"noopener noreferrer",className:"min-h-touch inline-flex items-center justify-center rounded-xl bg-[#06C755] px-6 py-3 text-sm font-medium text-white no-underline",children:"開き直す"})]}):t&&"loading"===f?(0,r.jsx)("main",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50",children:(0,r.jsx)("p",{className:"text-gray-600",children:"管理画面へ移動しています..."})}):(0,r.jsx)(v,{hasUser:!1,ctaLoading:!0,onLogin:()=>(0,c.Lq)(l.bm),onSubmitShopName:E})}class L extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,message:e instanceof Error?e.message:String(e)}}componentDidCatch(){}render(){return this.state.hasError?(0,r.jsxs)("main",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50 max-w-md mx-auto",children:[(0,r.jsx)("p",{className:"text-red-600 font-medium mb-2",children:"読み込みに失敗しました"}),this.state.message&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:this.state.message}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"下のリンクをタップして、もう一度お試しください。"}),(0,r.jsx)("a",{href:l.bm,target:"_self",rel:"noopener noreferrer",className:"min-h-touch inline-flex items-center justify-center rounded-xl bg-[#06C755] px-6 py-3 text-sm font-medium text-white no-underline",children:"開き直す"})]}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1,message:""}}}function C(){return(0,r.jsx)(L,{children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("main",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50",children:(0,r.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})}),children:(0,r.jsx)(E,{})})})}},31:function(e,t,n){"use strict";n.d(t,{Dj:function(){return f},G$:function(){return l},KC:function(){return h},SX:function(){return u},bm:function(){return o},hD:function(){return c},lG:function(){return m},p3:function(){return i},s1:function(){return s},tE:function(){return d}});var r,a=n(257);let s="2009034946-GQ1UQIRr".trim()||"2009034946-GQ1UQIRr",i=(null===(r=a.env.NEXT_PUBLIC_LIFF_ID_ADMIN_DIRECT)||void 0===r?void 0:r.trim())||"2009034946-LkF5LngF",l="https://liff.line.me/2009034946-LkF5LngF",c="2009034946-KaRhKY16".trim()||"2009034946-KaRhKY16",o="https://marche-link.jp/admin-entry/",u="https://marche-link.jp/admin/",d="marche-link-liff-inited",m="https://liff.line.me/".concat(s,"/"),h="https://liff.line.me/".concat(i,"/"),f="https://liff.line.me/".concat(c)},7293:function(e,t,n){"use strict";n.d(t,{E7:function(){return h},G5:function(){return m},T:function(){return f},V1:function(){return i.V1},lx:function(){return x}});var r=n(738),a=n(3301),s=n(5978),i=n(3491);let l={apiKey:"AIzaSyCa4s0nrtJe2PNf86c3843MVDsL6fpwljQ",authDomain:"marche-link.firebaseapp.com",projectId:"marche-link",storageBucket:"marche-link.firebasestorage.app",messagingSenderId:"1006467595458",appId:"1:1006467595458:web:ecf555e02bb7335e5dcf5b"},c=null,o=null,u=null,d=!1;function m(){if(!l.apiKey||!l.projectId)return null;if(c)return c;if(d)return null;try{let e=(0,r.C6)();return c=e.length>0?e[0]:(0,r.ZF)(l)}catch(e){return d=!0,"undefined"!=typeof console&&console.warn&&console.warn("[Firebase] 初期化に失敗しました",e),null}}function h(){try{let e=m();if(!e)return null;return o||(o=(0,a.v0)(e)),o}catch(e){return null}}function f(){try{let e=m();if(!e)return null;return u||(u=(0,s.ad)(e)),u}catch(e){return null}}function x(e){try{let t=m();if(!t)return null;return(0,i.$C)(t,null!=e?e:"asia-northeast1")}catch(e){return null}}},6515:function(e,t,n){"use strict";n.d(t,{$w:function(){return c},DT:function(){return o},Lq:function(){return d},Tc:function(){return h},cz:function(){return f},jl:function(){return u},lA:function(){return x},o$:function(){return m}});let r=null,a=null,s=!1,i=!1;async function l(){if(r)return r;try{return r=(await n.e(949).then(n.bind(n,2949))).default}catch(e){return null}}async function c(e){return(i||(i=!0,window.addEventListener("pagehide",()=>{a=null,r=null,s=!0})),a)?a:a=(async()=>{let t=e;window.location.pathname.startsWith("/admin")&&!window.location.pathname.startsWith("/admin-entry")&&(e.endsWith("KaRhKY16")||e.includes("KaRhKY16"))&&(t="2009034946-LkF5LngF");let n=await l();n&&(s||!n.id)&&(s&&(s=!1),await new Promise(e=>requestAnimationFrame(()=>e())),await n.init({liffId:t}))})().catch(e=>{throw a=null,e})}function o(){if(!r)return!1;try{return r.isInClient()}catch(e){return!1}}function u(){if(!r)return!1;try{return r.isLoggedIn()}catch(e){return!1}}function d(e){r&&r.login({redirectUri:e})}async function m(){var e;let t=await l();if(!t)throw Error("LIFF が利用できません");let n=await t.getProfile();return{userId:n.userId,displayName:null!==(e=n.displayName)&&void 0!==e?e:"",pictureUrl:n.pictureUrl}}async function h(){let e=await l();if(!e||"function"!=typeof e.getIDToken)return null;try{let t=await e.getIDToken();return t&&"string"==typeof t?t:null}catch(e){return null}}async function f(){let e=await l();if(!e||"function"!=typeof e.getDecodedIDToken)return null;try{let t=e.getDecodedIDToken();if((null==t?void 0:t.email)&&"string"==typeof t.email&&t.email.trim())return t.email.trim();return null}catch(e){return null}}function x(){(null==r?void 0:r.closeWindow)&&r.closeWindow()}},8045:function(e,t,n){"use strict";n.d(t,{J2:function(){return s},Mn:function(){return a},rZ:function(){return i}});let r="marche-link-admin-manual-logout";function a(){try{return"1"===window.localStorage.getItem(r)}catch(e){return!1}}function s(){try{window.localStorage.setItem(r,"1")}catch(e){}}function i(){try{window.localStorage.removeItem(r)}catch(e){}}}},function(e){e.O(0,[358,990,249,302,971,117,744],function(){return e(e.s=3322)}),_N_E=e.O()}]);