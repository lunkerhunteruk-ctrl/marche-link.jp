(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{2662:function(e,t,r){Promise.resolve().then(r.bind(r,520))},520:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return M}});var l=r(7437),a=r(2265),s=r(4887),n=r(9376),o=r(7648),i=r(5978),d=r(3113),c=r(2489);let u=(0,r(9205).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var m=r(3581),x=r(2023);function h(e){let{onCropComplete:t,cropSize:r=280,outputSize:s=400}=e,[n,o]=(0,a.useState)(null),[i,u]=(0,a.useState)({w:0,h:0}),[x,h]=(0,a.useState)(1),[p,g]=(0,a.useState)(0),[f,b]=(0,a.useState)(0),[y,v]=(0,a.useState)(!1),[j,w]=(0,a.useState)({x:0,y:0,offsetX:0,offsetY:0}),[N,C]=(0,a.useState)(null),k=(0,a.useRef)(null),S=(0,a.useRef)(null),E=(0,a.useCallback)(()=>{o(null),h(1),g(0),b(0),C(null),t(null)},[t]),A=(0,a.useCallback)(e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];e.target.value="",r&&r.type.startsWith("image/")&&(C(null),new Promise((e,t)=>{let l=new FileReader;l.onload=()=>{let r=l.result;"string"==typeof r&&r.startsWith("data:")?e(r):t(Error("Failed to read file"))},l.onerror=()=>t(Error("Failed to load image")),l.readAsDataURL(r)}).then(e=>{o(e),u({w:0,h:0}),h(1),g(0),b(0);let t=new window.Image;t.onload=()=>u({w:t.naturalWidth,h:t.naturalHeight}),t.src=e}).catch(()=>C("画像の読み込みに失敗しました")))},[]),I=(0,a.useCallback)(()=>!n||i.w<=0?Promise.resolve(null):new Promise(e=>{let t=new window.Image;t.crossOrigin="anonymous",t.onload=()=>{let l=t.naturalWidth,a=t.naturalHeight,n=r/2,o=r/x,i=l/2-n/x-p/x,d=a/2-n/x-f/x,c=document.createElement("canvas");c.width=s,c.height=s;let u=c.getContext("2d");if(!u){e(null);return}u.drawImage(t,i,d,o,o,0,0,s,s),c.toBlob(t=>e(null!=t?t:null),"image/jpeg",.9)},t.onerror=()=>e(null),t.src=n}),[n,i.w,x,p,f,r,s]);(0,a.useEffect)(()=>{if(!n)return;let e=!1;return I().then(r=>{e||t(r)}),()=>{e=!0}},[n,x,p,f,I,t]);let P=(0,a.useCallback)(e=>{n&&(e.preventDefault(),v(!0),w({x:e.clientX,y:e.clientY,offsetX:p,offsetY:f}))},[n,p,f]),F=(0,a.useCallback)(e=>{y&&(g(j.offsetX+(e.clientX-j.x)),b(j.offsetY+(e.clientY-j.y)))},[y,j]),U=(0,a.useCallback)(()=>v(!1),[]),L=(0,a.useCallback)(()=>v(!1),[]);return(0,a.useEffect)(()=>{if(!y)return;let e=()=>v(!1);return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[y]),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["店舗アイコン ",(0,l.jsx)("span",{className:"text-xs text-gray-500",children:"（任意）"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"写真を選ぶと、枠内で位置・大きさを調整してアイコンにできます。"}),n?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{ref:k,className:"relative mx-auto overflow-hidden rounded-2xl border-2 border-gray-200 bg-gray-100",style:{width:r,height:r},onPointerDown:P,onPointerMove:F,onPointerUp:U,onPointerLeave:L,children:[(0,l.jsx)("img",{ref:S,src:n,alt:"アイコン用に切り抜く画像",className:"absolute left-1/2 top-1/2 max-w-none select-none touch-none",style:{width:i.w*x,height:i.h*x,transform:"translate(calc(-50% + ".concat(p,"px), calc(-50% + ").concat(f,"px))"),pointerEvents:"none"},draggable:!1,onLoad:()=>{S.current&&u({w:S.current.naturalWidth,h:S.current.naturalHeight})}}),(0,l.jsx)("div",{className:"pointer-events-none absolute inset-0 rounded-xl ring-2 ring-white/80 ring-offset-2 ring-offset-gray-100","aria-hidden":!0}),(0,l.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,l.jsx)("div",{className:"h-[88%] w-[88%] rounded-full border-2 border-dashed border-white/90 shadow-inner"})})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 px-1",children:[(0,l.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"大きさ"}),(0,l.jsx)("input",{type:"range",min:.5,max:2.5,step:.05,value:x,onChange:e=>h(parseFloat(e.target.value)),className:"h-2 w-full accent-brand"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("button",{type:"button",onClick:E,className:"min-h-touch flex items-center justify-center gap-1.5 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 active:bg-gray-50",children:[(0,l.jsx)(c.Z,{className:"h-4 w-4","aria-hidden":!0}),"削除"]}),(0,l.jsxs)("label",{className:"min-h-touch flex cursor-pointer items-center justify-center gap-1.5 rounded-xl border border-brand/40 bg-brand-light px-4 py-2.5 text-sm font-medium text-brand active:scale-[0.99]",children:[(0,l.jsx)(d.Z,{className:"h-4 w-4","aria-hidden":!0}),"別の写真を選ぶ",(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:A,className:"hidden","aria-label":"別の画像を選択"})]})]}),N&&(0,l.jsx)("p",{className:"text-sm text-red-600",role:"alert",children:N})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3 rounded-2xl border-2 border-dashed border-gray-300 bg-gray-50/50 p-6",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:A,className:"hidden",id:"store-icon-file","aria-label":"店舗アイコン画像を選択"}),(0,l.jsxs)("label",{htmlFor:"store-icon-file",className:"flex min-h-touch cursor-pointer flex-col items-center gap-2 rounded-xl border border-gray-200 bg-white px-6 py-4 text-gray-700 shadow-sm active:scale-[0.99]",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(m.Z,{className:"h-8 w-8 text-gray-400","aria-hidden":!0}),(0,l.jsx)(d.Z,{className:"h-8 w-8 text-gray-400","aria-hidden":!0})]}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"写真を選ぶ"})]})]})]})}var p=r(7293),g=r(6942);let f=[{id:"pattern-1",name:"パターン1",description:"落ち着いた緑系",theme:{primaryColor:"#4a7c59",buttonColor:"#4a7c59",headerColor:"#3d6b4d",backgroundColor:"#faf8f5",textColor:"#1f2937",fontFamily:"sans-serif"}},{id:"pattern-2",name:"パターン2",description:"爽やかな青系",theme:{primaryColor:"#2563eb",buttonColor:"#2563eb",headerColor:"#1d4ed8",backgroundColor:"#f0f9ff",textColor:"#1e3a5f",fontFamily:"sans-serif"}},{id:"pattern-3",name:"パターン3",description:"温かみのオレンジ系",theme:{primaryColor:"#c2410c",buttonColor:"#c2410c",headerColor:"#9a3412",backgroundColor:"#fff7ed",textColor:"#431407",fontFamily:"sans-serif"}},{id:"pattern-4",name:"パターン4",description:"シンプルなモノトーン",theme:{primaryColor:"#171717",buttonColor:"#171717",headerColor:"#262626",backgroundColor:"#ffffff",textColor:"#171717",fontFamily:"sans-serif"}},{id:"pattern-5",name:"パターン5",description:"ナチュラルな茶系",theme:{primaryColor:"#6b4423",buttonColor:"#6b4423",headerColor:"#5c3d1f",backgroundColor:"#fef3c7",textColor:"#292524",fontFamily:"serif"}}];async function b(e){if(!(0,p.G5)())throw Error("接続を確認して再度お試しください。");let t=(0,p.lx)("asia-northeast1");if(!t)throw Error("接続を確認して再度お試しください。");try{let r=(0,p.V1)(t,"generateDesignPresets"),l=await r({onboarding:e}),a=l.data.presets;if(!Array.isArray(a)||a.length<5)throw Error("プリセットの生成に失敗しました。しばらくしてから再度お試しください。");let s="fallback"===l.data.source?"fallback":"ai";return{presets:a,source:s}}catch(e){throw Error(e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:"プリセットの生成に失敗しました。通信環境を確認して再度お試しください。")}}async function y(e,t){if(!(0,p.G5)())throw Error("Firebase が利用できません");let r=(0,p.lx)("asia-northeast1");if(!r)throw Error("Cloud Functions が利用できません");let l=(0,p.V1)(r,"updateStoreActivePreset");await l({storeId:e,activePresetId:t})}async function v(e,t,r){if(!(0,p.G5)())throw Error("Firebase が利用できません");let l=(0,p.lx)("asia-northeast1");if(!l)throw Error("Cloud Functions が利用できません");let a=(0,p.V1)(l,"updateStoreInstalledPresets");return(await a({storeId:e,installedPresets:t,designSeed:r})).data}var j=r(5173),w=r(6679),N=r(2498),C=r(4274),k=r(9397);let S="marche-link-design-last-generated-",E=["魚貝類","生花・フラワー","野菜・果物","精肉","惣菜・加工品","パン","衣類","子供用品","雑貨・生活用品","ハンドクラフト・アクセサリー","美術・工芸品","電化製品","プラモデル","コレクターアイテム","釣具","スポーツ用品","建築資材","自動車パーツ","生体","サービスチケット","レッスン","その他"];function A(){return(0,l.jsx)("div",{className:"mx-auto w-full max-w-[180px] aspect-[9/16] rounded-[2rem] bg-gray-200/80 shadow-xl overflow-hidden border-[6px] border-gray-300",children:(0,l.jsx)("div",{className:"w-full h-full bg-white overflow-hidden flex flex-col",children:(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center gap-2 bg-gray-100 p-4",children:[(0,l.jsx)(d.Z,{className:"h-10 w-10 text-gray-400",strokeWidth:1.5,"aria-hidden":!0}),(0,l.jsx)("span",{className:"text-xs font-medium text-gray-500 text-center",children:"デザイン未設定"})]})})})}function I(e){var t,r,s,n,o,i,d;let{storeId:c,storeName:u,theme:m}=e,[x,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=!1;return g(!0),(0,C.a9)(c).then(t=>{e||h(t.slice(0,6))}).finally(()=>{e||g(!1)}),()=>{e=!0}},[c]);let f=null!==(r=null!==(t=m.buttonColor)&&void 0!==t?t:m.primaryColor)&&void 0!==r?r:"#4a7c59",b=null!==(n=null!==(s=m.headerColor)&&void 0!==s?s:m.primaryColor)&&void 0!==n?n:"#3d6b4d",y=null!==(o=m.backgroundColor)&&void 0!==o?o:"#faf8f5",v=null!==(i=m.textColor)&&void 0!==i?i:"#1f2937",j=null!==(d=m.fontFamily)&&void 0!==d?d:"sans-serif";return(0,l.jsx)("div",{className:"mx-auto w-full max-w-[200px] aspect-[9/16] rounded-[2rem] bg-gray-200/80 shadow-xl overflow-hidden border-[6px] border-gray-300",children:(0,l.jsxs)("div",{className:"w-full h-full overflow-hidden flex flex-col",style:{backgroundColor:y,color:v,fontFamily:j},children:[(0,l.jsxs)("header",{className:"shrink-0 border-b border-black/10 px-2 py-1.5 text-white",style:{backgroundColor:b},children:[(0,l.jsx)("p",{className:"text-[10px] font-semibold truncate",children:u}),(0,l.jsx)("p",{className:"text-[8px] opacity-90",children:"Open"})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto p-1.5",children:p?(0,l.jsx)("div",{className:"grid grid-cols-2 gap-1.5",children:[1,2,3,4].map(e=>(0,l.jsx)("div",{className:"aspect-square rounded-lg bg-gray-200 animate-pulse"},e))}):0===x.length?(0,l.jsx)("div",{className:"flex flex-col items-center justify-center py-4 px-2 text-center",children:(0,l.jsx)("span",{className:"text-[9px] text-gray-500",children:"商品がありません"})}):(0,l.jsx)("div",{className:"grid grid-cols-2 gap-1.5",children:x.map(e=>(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden bg-gray-100",children:[e.imageUrl?(0,l.jsx)("img",{src:e.imageUrl,alt:"",className:"h-full w-full object-cover"}):(0,l.jsx)("div",{className:"h-full w-full bg-gray-200"}),(0,l.jsx)("span",{className:"absolute bottom-0.5 right-0.5 flex h-5 w-5 items-center justify-center rounded-full shadow",style:{backgroundColor:f},children:(0,l.jsx)(k.Z,{className:"h-2.5 w-2.5 text-white",strokeWidth:2.5,"aria-hidden":!0})})]}),(0,l.jsx)("p",{className:"mt-0.5 line-clamp-2 text-[8px] font-medium text-gray-900",children:e.title}),(0,l.jsxs)("p",{className:"text-[7px] text-gray-600",children:["\xa5",e.price.toLocaleString(),"/",e.unit]})]},e.id))})})]})})}function P(e){var t,r,a,s,n,o,i,d;let{preset:c}=e,u=c.theme,m=[null!==(r=null!==(t=u.primaryColor)&&void 0!==t?t:u.buttonColor)&&void 0!==r?r:"#4a7c59",null!==(s=null!==(a=u.headerColor)&&void 0!==a?a:u.primaryColor)&&void 0!==s?s:"#3d6b4d",null!==(n=u.backgroundColor)&&void 0!==n?n:"#faf8f5",null!==(o=u.textColor)&&void 0!==o?o:"#1f2937",null!==(d=null!==(i=u.buttonColor)&&void 0!==i?i:u.primaryColor)&&void 0!==d?d:"#4a7c59"];return(0,l.jsx)("div",{className:"mt-3 rounded-xl overflow-hidden border border-gray-200 shadow-sm",role:"img","aria-label":"".concat(c.name,"の配色"),children:(0,l.jsx)("div",{className:"flex h-14 sm:h-16",children:m.map((e,t)=>(0,l.jsx)("div",{className:"flex-1 min-w-0 transition-opacity hover:opacity-90 ".concat(0===t?"rounded-l-lg":""," ").concat(t===m.length-1?"rounded-r-lg":""),style:{backgroundColor:e},title:e},t))})})}function F(e){var t,r,s,n;let{preset:o,index:i,storeId:d,isPreview:c,isActive:u,onPreview:m,onApply:x,onError:h}=e,[p,g]=(0,a.useState)(!1);return(0,l.jsxs)("li",{role:"group",tabIndex:0,className:"rounded-2xl border bg-white p-5 shadow-sm transition-all ".concat(u?"border-2 border-gray-500 shadow-md ring-2 ring-gray-400/30":"border border-gray-200"," ").concat(c?"ring-2 ring-gray-400 shadow-md scale-[1.02]":"hover:shadow-md"),onMouseEnter:m,onFocus:m,children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,l.jsx)("p",{className:"font-medium text-gray-900",children:o.name}),0===i&&(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 font-medium",children:"おすすめ"})]}),o.description&&(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-0.5",children:o.description}),(0,l.jsx)(P,{preset:o}),(0,l.jsx)("button",{type:"button",onClick:()=>{g(!0),h(""),y(d,o.id).then(()=>x(o.id)).catch(e=>{let t=e instanceof Error?e.message:String(e),r=e&&"string"==typeof e.code?e.code:"";"internal"===t||"internal"===r||r.includes("internal")?h("サーバーエラーです。Cloud Function（updateStoreActivePreset）のデプロイを確認してください。"):h(t||"適用に失敗しました")}).finally(()=>g(!1))},disabled:p,className:"mt-4 min-h-touch w-full rounded-xl px-4 py-3 font-medium disabled:opacity-50 active:scale-[0.98] transition-transform ".concat(u?"text-white":"border-2 border-gray-400 bg-white text-gray-700 hover:bg-gray-50 active:bg-gray-100"),style:u?{backgroundColor:null!==(n=null!==(s=null===(t=o.theme)||void 0===t?void 0:t.buttonColor)&&void 0!==s?s:null===(r=o.theme)||void 0===r?void 0:r.primaryColor)&&void 0!==n?n:"#4a7c59"}:void 0,children:p?"適用中...":u?"このパレットを適用中":"このパレットを適用"})]})}function U(e){let{open:t,onClose:r,initialSeed:s,storeNameFallback:n,storeDescriptionFallback:o,accentColor:i,onSubmit:d,loading:m,error:x,successMessage:h,limitReachedMessage:p,onDismissLimitMessage:g}=e,f=null!=i?i:"#4a7c59",[b,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(""),[w,N]=(0,a.useState)([]),[C,k]=(0,a.useState)(""),[S,A]=(0,a.useState)(""),[I,P]=(0,a.useState)("");(0,a.useEffect)(()=>{var e,r,l,a,i;t&&(y(null!==(e=null==s?void 0:s.storeName)&&void 0!==e?e:n),j(null!==(r=null==s?void 0:s.description)&&void 0!==r?r:o),N(Array.isArray(null==s?void 0:s.productCategories)?s.productCategories:[]),k(null!==(l=null==s?void 0:s.concept)&&void 0!==l?l:""),A(null!==(a=null==s?void 0:s.preferredAtmosphere)&&void 0!==a?a:""),P(null!==(i=null==s?void 0:s.avoidColorsImage)&&void 0!==i?i:""))},[t,s,n,o]);let F=e=>{N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return((0,a.useEffect)(()=>{if(!t)return;let e=document.body.style.overflow,r=document.body.style.position,l=document.body.style.width;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",()=>{document.body.style.overflow=e,document.body.style.position=r,document.body.style.width=l}},[t]),t)?(0,l.jsx)("div",{className:"fixed inset-0 z-[9999] flex flex-col items-end sm:items-center sm:justify-center bg-black/50 p-0 sm:p-4",role:"dialog","aria-modal":"true","aria-labelledby":"design-seed-modal-title",children:(0,l.jsxs)("div",{className:"relative bg-white w-full flex flex-col rounded-2xl shadow-xl max-w-lg mt-auto sm:mt-0 max-h-[90dvh] sm:max-h-[90vh] min-h-0 flex-1 sm:flex-initial sm:min-h-[80vh] overflow-hidden",children:[(0,l.jsxs)("div",{className:"shrink-0 flex items-center justify-between border-b border-gray-200 bg-white px-4 py-3 rounded-t-2xl",children:[(0,l.jsx)("h3",{id:"design-seed-modal-title",className:"text-lg font-semibold text-gray-900",children:h?"完了":"デザインの元になる情報"}),(0,l.jsx)("button",{type:"button",onClick:r,className:"p-2 -m-2 text-gray-500 hover:text-gray-700","aria-label":"閉じる",children:(0,l.jsx)(c.Z,{className:"h-5 w-5"})})]}),p&&(0,l.jsx)("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-black/30 p-4 rounded-b-2xl",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full p-5 text-center",children:[(0,l.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed",children:p}),(0,l.jsx)("button",{type:"button",onClick:g,className:"mt-4 min-h-touch w-full rounded-xl px-4 py-3 text-sm font-medium text-white",style:{backgroundColor:f},children:"閉じる"})]})}),h?(0,l.jsxs)("div",{className:"flex flex-col flex-1 min-h-0 p-6 justify-center",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center text-center mb-8",children:[(0,l.jsx)("div",{className:"w-14 h-14 rounded-full flex items-center justify-center mb-5 shrink-0",style:{backgroundColor:"".concat(f,"20")},children:(0,l.jsx)(u,{className:"w-8 h-8",style:{color:f},"aria-hidden":!0})}),(0,l.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:h}),(0,l.jsx)("p",{className:"text-base text-gray-600 leading-relaxed",children:"閉じるで一覧に戻り、新しい5案のカラーパレットを確認できます。"})]}),(0,l.jsx)("button",{type:"button",onClick:r,className:"min-h-touch w-full rounded-xl px-4 py-3.5 text-base font-medium text-white active:opacity-90",style:{backgroundColor:f},children:"閉じる"})]}):(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d({storeName:b.trim()||null,description:v.trim()||null,productCategories:w.length?w:null,concept:C.trim()||null,preferredAtmosphere:S.trim()||null,avoidColorsImage:I.trim()||null})},className:"flex flex-col min-h-0 flex-1 flex-nowrap",children:[(0,l.jsxs)("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain p-4 space-y-4",children:[(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["内容を編集して「お店をデザインする」を押すと、表示中の5つのカラーパレットが",(0,l.jsx)("strong",{children:"すべて"}),"新しい案に差し替わります。変わらなければ不具合の可能性があります。"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ショップ名"}),(0,l.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"w-full border border-gray-300 rounded-xl px-3 py-2.5 text-base",placeholder:"例：〇〇マルシェ"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明（こちらに記入した内容がそのままストア名の横に表示されます。）"}),(0,l.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),className:"w-full border border-gray-300 rounded-xl px-3 py-2.5 text-base",rows:2,placeholder:"ショップの簡単な説明"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"取扱いカテゴリ"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:E.map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>F(e),className:"min-h-touch px-3 py-1.5 rounded-full text-sm border ".concat(w.includes(e)?"bg-gray-200 border-gray-400 text-gray-900":"bg-white border-gray-300 text-gray-600"),children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ショップのコンセプト ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("textarea",{value:C,onChange:e=>k(e.target.value),className:"w-full border border-gray-300 rounded-xl px-3 py-2.5 text-base",rows:3,placeholder:"例：朝採れの「甘い」を直接届ける。家族で安心して食べられる野菜のセレクトショップ。",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"希望する雰囲気・色"}),(0,l.jsx)("textarea",{value:S,onChange:e=>A(e.target.value),className:"w-full border border-gray-300 rounded-xl px-3 py-2.5 text-base",rows:2,placeholder:"例：ナチュラルで落ち着いたデザイン"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"避けたい色・イメージ"}),(0,l.jsx)("textarea",{value:I,onChange:e=>P(e.target.value),className:"w-full border border-gray-300 rounded-xl px-3 py-2.5 text-base",rows:2,placeholder:"例：どぎつい原色は避けたい"})]}),x&&(0,l.jsx)("p",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded-xl px-3 py-2",role:"alert",children:x})]}),(0,l.jsx)("div",{className:"shrink-0 border-t border-gray-200 bg-white p-4 pb-[env(safe-area-inset-bottom)] sm:pb-4 rounded-b-2xl",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{type:"button",onClick:r,className:"flex-1 min-h-touch rounded-xl border border-gray-300 bg-white px-4 py-3 font-medium text-gray-700",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",disabled:m||!C.trim(),className:"flex-1 min-h-touch rounded-xl px-4 py-3 font-medium text-white active:opacity-90 disabled:opacity-50 disabled:bg-gray-300 disabled:text-gray-500",style:m||!C.trim()?void 0:{backgroundColor:f,color:"#fff"},children:m?"実行中...":"お店をデザインする"})]})})]})]})}):null}function L(){return(0,l.jsxs)("main",{className:"min-h-screen bg-gray-50 px-4 py-6 max-w-2xl mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ショップのデザイン"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"ショップ作成後、ここから配色プリセットを選んで適用できます。"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,l.jsx)(o.default,{href:"/admin/register",className:"text-[var(--admin-accent)] underline",children:"新規ショップ登録"}),"を完了すると、このページでデザインを切り替えられます。"]}),(0,l.jsx)("p",{className:"text-xs text-gray-400 mt-4",children:"ログイン済みでショップを1件以上登録している場合は、しばらく待つかページを再読み込みしてください。"})]})}function Z(){var e,t,r,o,u;let y=(0,n.useSearchParams)(),C=y.get("storeId"),{user:k}=(0,g.a)(),[E,P]=(0,a.useState)(C),[Z,M]=(0,a.useState)(!C),[D,T]=(0,a.useState)(f),[R,W]=(0,a.useState)(null),[V,J]=(0,a.useState)(!0),[z,B]=(0,a.useState)(null),[H,O]=(0,a.useState)(null),[X,Y]=(0,a.useState)(null),[_,q]=(0,a.useState)(null),[Q,G]=(0,a.useState)(""),[$,K]=(0,a.useState)(""),[ee,et]=(0,a.useState)(!1),[er,el]=(0,a.useState)(null),[ea,es]=(0,a.useState)(""),[en,eo]=(0,a.useState)(""),[ei,ed]=(0,a.useState)(!1),[ec,eu]=(0,a.useState)(null),[em,ex]=(0,a.useState)(null),[eh,ep]=(0,a.useState)(!1),[eg,ef]=(0,a.useState)(null),[eb,ey]=(0,a.useState)(null),[ev,ej]=(0,a.useState)(!1),[ew,eN]=(0,a.useState)(null),eC=(0,a.useRef)(null),[ek,eS]=(0,a.useState)(!1),[eE,eA]=(0,a.useState)(null),[eI,eP]=(0,a.useState)(!1),[eF,eU]=(0,a.useState)(!1),[eL,eZ]=(0,a.useState)(null),[eM,eD]=(0,a.useState)(null),[eT,eR]=(0,a.useState)(null),[eW,eV]=(0,a.useState)(null),[eJ,ez]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(C){P(C),M(!1);return}if(!(null==k?void 0:k.uid)){P(null),M(!1);return}let e=(0,p.T)();if(!e){M(!1);return}M(!0),(0,i.QT)((0,i.JU)(e,"adminUsers",k.uid)).then(e=>{var t;let r=e.exists()&&Array.isArray(null===(t=e.data())||void 0===t?void 0:t.storeIds)?e.data().storeIds:[];P(r.length>=1?r[0]:null)}).catch(()=>P(null)).finally(()=>M(!1))},[C,null==k?void 0:k.uid]),(0,a.useEffect)(()=>{if(!E){J(!1);return}let e=(0,p.T)();if(!e){J(!1);return}J(!0),(0,i.QT)((0,i.JU)(e,"stores",E)).then(e=>{var t,r,l,a,s;if(!e.exists()){T(f),W(null),Y(null!==(l=null===(r=f[0])||void 0===r?void 0:r.id)&&void 0!==l?l:null);return}let n=e.data(),o=Array.isArray(s=null==n?void 0:n.installedPresets)&&0!==s.length?s.filter(e=>e&&"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.name&&null!=e.theme&&"object"==typeof e.theme).map(e=>{var t,r,l;return{id:e.id,name:e.name,description:e.description,theme:{buttonColor:null!==(t=e.theme.buttonColor)&&void 0!==t?t:e.theme.primaryColor,headerColor:null!==(r=e.theme.headerColor)&&void 0!==r?r:e.theme.primaryColor,backgroundColor:e.theme.backgroundColor,textColor:e.theme.textColor,fontFamily:e.theme.fontFamily,primaryColor:null!==(l=e.theme.primaryColor)&&void 0!==l?l:e.theme.buttonColor}}}):f;T(o);let i="string"==typeof(null==n?void 0:n.activePresetId)?n.activePresetId:null;W(i),Y(null!==(a=null!=i?i:null===(t=o[0])||void 0===t?void 0:t.id)&&void 0!==a?a:null),q((null==n?void 0:n.designSeed)&&"object"==typeof n.designSeed?n.designSeed:null);let d="string"==typeof(null==n?void 0:n.name)?n.name:"";G(d),K(d),(0,j.Rd)(E,d),(0,j.VV)();let c="string"==typeof(null==n?void 0:n.description)?n.description:"";es(c),eo(c),ex("string"==typeof(null==n?void 0:n.iconUrl)&&n.iconUrl.trim()?n.iconUrl.trim():null),ey("string"==typeof(null==n?void 0:n.ogpImageUrl)&&n.ogpImageUrl.trim()?n.ogpImageUrl.trim():null)}).catch(()=>{var e,t;T(f),W(null),Y(null!==(t=null===(e=f[0])||void 0===e?void 0:e.id)&&void 0!==t?t:null)}).finally(()=>J(!1))},[E]);let eB=null!=z?z:R,eH=eB&&null!==(r=D.find(e=>e.id===eB))&&void 0!==r?r:null,eO=(0,a.useRef)(null),eX=async()=>{let e=$.trim();if(!E||!e)return;let t=(0,p.T)();if(t){et(!0),el(null);try{await (0,i.r7)((0,i.JU)(t,"stores",E),{name:e,updatedAt:(0,i.Bt)()}),G(e),(0,j.Rd)(E,e),(0,j.VV)()}catch(e){el(e instanceof Error?e.message:"保存に失敗しました")}finally{et(!1)}}},eY=async()=>{if(!E)return;let e=(0,p.T)();if(!e)return;let t=en.trim();ed(!0),eu(null);try{await (0,i.r7)((0,i.JU)(e,"stores",E),{description:t,updatedAt:(0,i.Bt)()}),es(t)}catch(e){eu(e instanceof Error?e.message:"保存に失敗しました")}finally{ed(!1)}},e_=async e=>{if(E){ej(!0),eN(null);try{let t=new FormData;t.append("image",e,e.name||"ogp.jpg"),t.append("subdomain",E);let r=N.E.baseUrl,l=await fetch("".concat(r,"/upload-ogp-image.php"),{method:"POST",body:t}),a=await l.json().catch(()=>({}));if(!l.ok||!a.success||"string"!=typeof a.url)throw Error(a.message||"アップロードに失敗しました");let s=a.url.startsWith("http")?a.url:"".concat(r).concat(a.url),n="".concat(s).concat(s.includes("?")?"&":"?","v=").concat(Date.now()),o=(0,p.T)();if(!o)throw Error("Firebase が利用できません");await (0,i.r7)((0,i.JU)(o,"stores",E),{ogpImageUrl:n,updatedAt:(0,i.Bt)()}),ey(n)}catch(e){eN(e instanceof Error?e.message:"アップロードに失敗しました")}finally{ej(!1)}}},eq=async()=>{if(E){ej(!0),eN(null);try{let e=(0,p.T)();if(!e)throw Error("Firebase が利用できません");await (0,i.r7)((0,i.JU)(e,"stores",E),{ogpImageUrl:null,updatedAt:(0,i.Bt)()}),ey(null)}catch(e){eN(e instanceof Error?e.message:"削除に失敗しました")}finally{ej(!1)}}};return Z?(0,l.jsx)("main",{className:"min-h-screen bg-gray-50 px-4 py-6",children:(0,l.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})}):E?V?(0,l.jsx)("main",{className:"min-h-screen bg-gray-50 px-4 py-6",children:(0,l.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})}):(0,l.jsxs)("main",{className:"min-h-screen bg-gray-50 px-4 pb-24 max-w-2xl mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-1",children:"ショップのデザイン"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"登録時のコンセプトに合わせたテーマから選べます。"}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"ショップ名"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"お店のページのヘッダーなどに表示される名前です。"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"text",value:$,onChange:e=>K(e.target.value),placeholder:"ショップ名",className:"flex-1 min-h-touch rounded-xl border border-gray-300 px-4 py-2.5 text-sm","aria-label":"ショップ名"}),(0,l.jsx)("button",{type:"button",onClick:eX,disabled:ee||$.trim()===Q,className:"min-h-touch shrink-0 rounded-xl bg-[var(--admin-accent)] px-4 py-2.5 text-sm font-medium text-white active:opacity-90 disabled:opacity-50 disabled:pointer-events-none",children:ee?"保存中…":"保存"})]}),er&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:er})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"説明（こちらに記入した内容がそのままストア名の横に表示されます。）"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("textarea",{value:en,onChange:e=>eo(e.target.value),placeholder:"ショップの簡単な説明",rows:2,className:"flex-1 min-h-touch rounded-xl border border-gray-300 px-4 py-2.5 text-sm resize-y","aria-label":"説明"}),(0,l.jsx)("button",{type:"button",onClick:eY,disabled:ei||en===ea,className:"min-h-touch shrink-0 rounded-xl bg-[var(--admin-accent)] px-4 py-2.5 text-sm font-medium text-white active:opacity-90 disabled:opacity-50 disabled:pointer-events-none self-end",children:ei?"保存中…":"保存"})]}),ec&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:ec})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"ショップのアイコン（丸）"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"ストアページのお気に入りタブで表示されます。300\xd7300px で登録されます。"}),ek?(0,l.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-4",children:[(0,l.jsx)(h,{cropSize:300,outputSize:300,onCropComplete:e=>eA(e)}),(0,l.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{eS(!1),eA(null)},className:"min-h-touch rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700",children:"キャンセル"}),(0,l.jsx)("button",{type:"button",disabled:!eE||eh,onClick:async()=>{if(E&&eE){ep(!0),ef(null);try{let e=new FormData;e.append("image",eE,"icon.jpg"),e.append("subdomain",E);let t=N.E.baseUrl,r=await fetch("".concat(t,"/upload-shop-icon.php"),{method:"POST",body:e}),l=await r.json().catch(()=>({}));if(!r.ok||!l.success||"string"!=typeof l.url)throw Error(l.message||"アップロードに失敗しました");let a=(0,p.T)();if(!a)throw Error("Firebase が利用できません");let s=l.url.startsWith("http")?l.url:"".concat(t).concat(l.url),n="".concat(s).concat(s.includes("?")?"&":"?","v=").concat(Date.now());await (0,i.r7)((0,i.JU)(a,"stores",E),{iconUrl:n,updatedAt:(0,i.Bt)()}),ex(n),eS(!1),eA(null)}catch(e){ef(e instanceof Error?e.message:"アップロードに失敗しました")}finally{ep(!1)}}},className:"min-h-touch rounded-xl bg-[var(--admin-accent)] px-4 py-2.5 text-sm font-medium text-white active:opacity-90 disabled:opacity-50",children:eh?"保存中…":"保存して反映"})]})]}):(0,l.jsx)("div",{className:"flex flex-col sm:flex-row items-start gap-4",children:em?(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"h-16 w-16 rounded-full overflow-hidden border-2 border-gray-200 bg-gray-100 shrink-0",children:(0,l.jsx)("img",{src:em,alt:"ショップアイコン",className:"h-full w-full object-cover"})}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>eS(!0),disabled:eh,className:"min-h-touch inline-flex items-center gap-1.5 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 active:bg-gray-50 disabled:opacity-50",children:[(0,l.jsx)(d.Z,{className:"h-4 w-4","aria-hidden":!0}),"変更"]}),(0,l.jsxs)("button",{type:"button",onClick:async()=>{if(!E)return;let e=(0,p.T)();if(e){ep(!0),ef(null);try{await (0,i.r7)((0,i.JU)(e,"stores",E),{iconUrl:null,updatedAt:(0,i.Bt)()}),ex(null)}catch(e){ef(e instanceof Error?e.message:"削除に失敗しました")}finally{ep(!1)}}},disabled:eh,className:"min-h-touch inline-flex items-center gap-1.5 rounded-xl border border-red-200 bg-red-50 px-4 py-2.5 text-sm font-medium text-red-700 active:bg-red-100 disabled:opacity-50",children:[(0,l.jsx)(c.Z,{className:"h-4 w-4","aria-hidden":!0}),"削除"]})]})]}):(0,l.jsxs)("button",{type:"button",onClick:()=>eS(!0),disabled:eh,className:"min-h-touch inline-flex items-center gap-2 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 px-5 py-4 text-gray-600 hover:border-gray-400 hover:bg-gray-100 active:scale-[0.99] disabled:opacity-50",children:[(0,l.jsx)(m.Z,{className:"h-6 w-6 text-gray-400","aria-hidden":!0}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"アイコンを登録する"})]})}),eg&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:eg})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"共有リンクプレビュー用画像"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"推奨 1200\xd7630px。LINEやSNSでリンクを共有したときのプレビューに使われます。未設定の場合はストアアイコンまたは商品画像が使われます。"}),(0,l.jsx)("input",{ref:eC,type:"file",accept:"image/*",className:"sr-only","aria-hidden":!0,onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];e.target.value="",(null==r?void 0:r.type.startsWith("image/"))&&e_(r)}}),eb?(0,l.jsxs)("div",{className:"flex flex-wrap items-start gap-3",children:[(0,l.jsx)("img",{src:eb,alt:"共有リンクプレビュー用画像のプレビュー",className:"h-24 w-auto rounded-2xl border border-gray-200 object-cover"}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=eC.current)||void 0===e?void 0:e.click()},disabled:ev,className:"min-h-touch rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 active:bg-gray-50 disabled:opacity-50",children:ev?"送信中…":"変更"}),(0,l.jsx)("button",{type:"button",onClick:eq,disabled:ev,className:"min-h-touch rounded-xl border border-red-200 bg-white px-3 py-2 text-sm font-medium text-red-600 active:bg-red-50 disabled:opacity-50",children:"削除"})]})]}):(0,l.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=eC.current)||void 0===e?void 0:e.click()},disabled:ev,className:"min-h-touch rounded-xl border border-dashed border-gray-300 bg-gray-50 px-4 py-3 text-sm font-medium text-gray-600 active:bg-gray-100 disabled:opacity-50",children:ev?"送信中…":"画像を選んで登録"}),ew&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:ew})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"現在のテーマ"}),eB&&eH?(0,l.jsx)(I,{storeId:E,storeName:Q||"ショップ",theme:eH.theme}):(0,l.jsx)(A,{})]}),(0,l.jsx)("section",{className:"space-y-4 mb-8",children:(0,l.jsx)("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-[var(--admin-accent)]/10",children:(0,l.jsx)(x.Z,{className:"h-5 w-5 text-[var(--admin-accent)]",strokeWidth:2,"aria-hidden":!0})}),(0,l.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,l.jsx)("p",{className:"text-base font-semibold text-gray-900",children:"お店専用のデザインを5案提案"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-0.5",children:"店舗の世界観に基づき、ぴったりの配色・テーマを自動でご提案します。"}),(0,l.jsx)("button",{type:"button",onClick:()=>{eZ(null),eD(null),eV(null),O(null),eP(!0)},className:"mt-4 w-full min-h-touch rounded-xl bg-[var(--admin-accent)] px-4 py-2.5 text-sm font-medium text-white active:opacity-90 disabled:opacity-50","data-action":"open-ai-modal","aria-label":"AIでデザイン案を生成するモーダルを開く",children:"今すぐ作成"})]})]})})}),z&&(0,l.jsx)("p",{className:"mb-4 text-sm text-gray-700 bg-gray-100 border border-gray-200 rounded-xl px-4 py-3",role:"status",children:"デザインを適用しました。"}),H&&(0,l.jsx)("p",{className:"mb-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded-xl px-4 py-3",role:"alert",children:H}),"undefined"!=typeof document&&(0,s.createPortal)((0,l.jsx)(U,{open:eI,onClose:()=>{eP(!1),eD(null),ez(null)},initialSeed:_,storeNameFallback:Q,storeDescriptionFallback:ea,accentColor:null!==(u=null!==(o=null==eH?void 0:null===(e=eH.theme)||void 0===e?void 0:e.buttonColor)&&void 0!==o?o:null==eH?void 0:null===(t=eH.theme)||void 0===t?void 0:t.primaryColor)&&void 0!==u?u:void 0,loading:eF,error:eL,successMessage:eM,limitReachedMessage:eJ,onDismissLimitMessage:()=>ez(null),onSubmit:async e=>{if(eZ(null),O(null),E){let e=function(e){try{let t=localStorage.getItem(S+e);if(!t)return null;let r=parseInt(t,10);return Number.isFinite(r)?r:null}catch(e){return null}}(E),t=Date.now();if(null!=e&&t-e<864e5){let r=new Date(e+864e5),l=new Date(t);l.setDate(l.getDate()+1);let a=r.getDate()===l.getDate()&&r.getMonth()===l.getMonth()&&r.getFullYear()===l.getFullYear()?"明日の".concat(r.getHours(),"時頃"):"".concat(r.getMonth()+1,"月").concat(r.getDate(),"日 ").concat(r.getHours(),"時頃");ez("デザインの自動生成は1日1回までとさせていただいております。次回は".concat(a,"からご利用いただけます。ご了承ください。"));return}}eU(!0);try{var t,r,l,a,s,n,o;let d={storeName:null!==(r=e.storeName)&&void 0!==r?r:void 0,description:null!==(l=e.description)&&void 0!==l?l:void 0,productCategories:null!==(a=e.productCategories)&&void 0!==a?a:void 0,concept:null!==(s=e.concept)&&void 0!==s?s:void 0,preferredAtmosphere:null!==(n=e.preferredAtmosphere)&&void 0!==n?n:void 0,avoidColorsImage:null!==(o=e.avoidColorsImage)&&void 0!==o?o:void 0},{presets:c,source:u}=await Promise.race([b(d),new Promise((e,t)=>setTimeout(()=>t(Error("タイムアウトしました。通信を確認して再度お試しください。")),6e4))]);if(!c||c.length<5)throw Error("プリセットの生成に失敗しました");eV(u);let{presets:m}=await v(E,c,e);if(T(m),W(m[0].id),null!=y.get("hexVerify")&&function(e,t,r){let l=["primaryColor","buttonColor","headerColor","backgroundColor","textColor"],a=!1;for(let s=0;s<Math.max(t.length,r.length);s++){let n=t[s],o=r[s];if(!n||!o){a=!0,console.warn("[".concat(e,"] 件数不一致: generated=").concat(t.length," saved=").concat(r.length));break}for(let t of l){let r=n.theme[t],l=o.theme[t];(null!=r?r:"").toLowerCase().trim()!==(null!=l?l:"").toLowerCase().trim()&&(a=!0,console.warn("[".concat(e,"] 不一致 pattern-").concat(s+1," theme.").concat(t,': generated="').concat(r,'" saved="').concat(l,'"')))}}!a&&t.length===r.length&&t.length>0&&console.info("[".concat(e,"] 全プリセットのHEXが保存内容と一致しました (").concat(r.length,"件)"))}("デザイン再生成",c,m),B(null),O(null),q(e),e.storeName&&e.storeName.trim()){let t=e.storeName.trim();G(t),K(t),(0,j.Rd)(E,t),(0,j.VV)();let r=(0,p.T)();E&&r&&(0,i.r7)((0,i.JU)(r,"stores",E),{name:t,updatedAt:(0,i.Bt)()}).catch(()=>{})}let x=(0,p.T)();if(E&&x){let t="string"==typeof e.description?e.description.trim():"";(0,i.r7)((0,i.JU)(x,"stores",E),{description:t,updatedAt:(0,i.Bt)()}).catch(()=>{}),es(t),eo(t)}E&&function(e){try{localStorage.setItem(S+e,String(Date.now()))}catch(e){}}(E),eD("5案を更新しました。"),eR("5案を更新しました"),setTimeout(()=>eR(null),5e3),null===(t=eO.current)||void 0===t||t.scrollIntoView({behavior:"smooth",block:"start"})}catch(t){let e=t instanceof Error?t.message:"再生成に失敗しました";eZ(e),O(e)}finally{eU(!1)}}}),document.body),eT&&(0,l.jsx)("p",{className:"mb-4 text-sm text-green-700 bg-green-50 border border-green-200 rounded-xl px-4 py-3",role:"status",children:eT}),(0,l.jsxs)("section",{ref:eO,className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"お店のために考えたプリセット"}),"fallback"===eW&&(0,l.jsx)("p",{className:"mb-3 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-xl px-4 py-3",role:"status",children:"自動提案が利用できなかったため、テンプレート案を表示しています。"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"あなたのお店のために、特別に考えられた5つの配色案です。「お店をデザインする」で再生成すると、すべて新しい案に差し替わります。各パレットにマウスを乗せるとプレビューが切り替わります。"}),(0,l.jsx)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5 list-none p-0 m-0",children:D.map((e,t)=>(0,l.jsx)(F,{preset:e,index:t,storeId:E,isPreview:X===e.id,isActive:eB===e.id,onPreview:()=>Y(e.id),onApply:e=>{B(e),W(e),O(null),window.dispatchEvent(new CustomEvent(w.EO))},onError:O},e.id))})]})]}):(0,l.jsx)(L,{})}var M=function(){let[e,t]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{t(!0)},[]),e)?(0,l.jsx)(a.Suspense,{fallback:(0,l.jsx)(L,{}),children:(0,l.jsx)(Z,{})}):(0,l.jsx)(L,{})}},2498:function(e,t,r){"use strict";r.d(t,{E:function(){return l}});let l={siteName:"マルシェリンク",baseUrl:"https://marche-link.jp",ogImageUrl:"https://marche-link.jp/admin-ogp.png",ogImageWidth:1200,ogImageHeight:630,ogTitle:"ストア管理画面 | マルシェリンク",defaultDescription:"注文・商品・QRコードを、いつものLINEでまとめて管理。"}},4274:function(e,t,r){"use strict";r.d(t,{a9:function(){return s},xE:function(){return n}});var l=r(5978),a=r(7293);async function s(e){let t=(0,a.T)(),r=e.trim().toLowerCase();if(!t||!r)return[];let s=(await (0,l.PL)((0,l.hJ)(t,"stores",r,"products"))).docs,n=s.map(e=>(function(e){var t;let r=e.data(),l="string"==typeof(null==r?void 0:r.imageUrl)?r.imageUrl:null,a=(Array.isArray(null==r?void 0:r.images)?r.images:[]).filter(e=>"string"==typeof e),s=a.length>0?a:l?[l]:[],n=null!==(t=s[0])&&void 0!==t?t:null,o=(null==r?void 0:r.published)!==!1,i="number"==typeof(null==r?void 0:r.stockQuantity)?Math.max(0,r.stockQuantity):0,d="string"==typeof(null==r?void 0:r.description)&&r.description.trim()?r.description.trim():void 0;return{id:e.id,title:"string"==typeof(null==r?void 0:r.title)?r.title:"（無題）",description:d,imageUrl:n,images:s,price:"number"==typeof(null==r?void 0:r.price)?r.price:0,stockQuantity:i,unit:"string"==typeof(null==r?void 0:r.unit)?r.unit:"個",published:o}})(e)).filter(e=>e.published);if(s.length>0){let e=new Map(s.map(e=>[e.id,e]));n.sort((t,r)=>{var l,a,s,n,o,i,d,c,u,m;let x=null!==(u=null===(n=e.get(t.id))||void 0===n?void 0:null===(s=n.data())||void 0===s?void 0:null===(a=s.createdAt)||void 0===a?void 0:null===(l=a.toMillis)||void 0===l?void 0:l.call(a))&&void 0!==u?u:0;return(null!==(m=null===(c=e.get(r.id))||void 0===c?void 0:null===(d=c.data())||void 0===d?void 0:null===(i=d.createdAt)||void 0===i?void 0:null===(o=i.toMillis)||void 0===o?void 0:o.call(i))&&void 0!==m?m:0)-x})}return n}async function n(e,t){let r=e.trim().toLowerCase();if(!r)return[];try{let l=(0,a.lx)("asia-northeast1");if(!l)return s(e);let n=(0,a.V1)(l,"getStorefrontProductsForCustomer"),o={storeId:r};t&&(o.idToken=t);let{data:i}=await n(o);return Array.isArray(null==i?void 0:i.products)?i.products:[]}catch(t){return s(e)}}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var l=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,l.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:d="",children:c,iconNode:u,...m}=e;return(0,l.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:r,strokeWidth:i?24*Number(o)/Number(a):o,className:s("lucide",d),...m},[...u.map(e=>{let[t,r]=e;return(0,l.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let r=(0,l.forwardRef)((r,n)=>{let{className:i,...d}=r;return(0,l.createElement)(o,{ref:n,iconNode:t,className:s("lucide-".concat(a(e)),i),...d})});return r.displayName="".concat(e),r}},3581:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let l=(0,r(9205).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},3113:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let l=(0,r(9205).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},9397:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let l=(0,r(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2023:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let l=(0,r(9205).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let l=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,t,r){"use strict";var l=r(5475);r.o(l,"usePathname")&&r.d(t,{usePathname:function(){return l.usePathname}}),r.o(l,"useRouter")&&r.d(t,{useRouter:function(){return l.useRouter}}),r.o(l,"useSearchParams")&&r.d(t,{useSearchParams:function(){return l.useSearchParams}})}},function(e){e.O(0,[358,990,249,648,679,971,117,744],function(){return e(e.s=2662)}),_N_E=e.O()}]);