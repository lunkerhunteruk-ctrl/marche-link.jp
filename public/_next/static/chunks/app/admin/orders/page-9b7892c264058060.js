(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[606],{2592:function(e,t,a){Promise.resolve().then(a.bind(a,5342))},5342:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var r=a(7437),s=a(2265),l=a(7648),n=a(8930),i=a(7168);let d=(0,a(9205).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var c=a(5978),o=a(7293),u=a(6679);function m(e){return"\xa5".concat(e.toLocaleString())}function x(e){return"".concat(e.getFullYear(),"/").concat(String(e.getMonth()+1).padStart(2,"0"),"/").concat(String(e.getDate()).padStart(2,"0")," ").concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"))}function h(e){let t=e.data(),a=Array.isArray(null==t?void 0:t.items)?t.items.map(e=>({name:"string"==typeof(null==e?void 0:e.name)?e.name:"（不明）",unitPrice:"number"==typeof(null==e?void 0:e.unitPrice)?e.unitPrice:0,quantity:"number"==typeof(null==e?void 0:e.quantity)?Math.max(0,e.quantity):0})):[],r=(null==t?void 0:t.createdAt)&&"function"==typeof t.createdAt.toDate?t.createdAt.toDate():new Date,s=(null==t?void 0:t.status)==="paid"||(null==t?void 0:t.status)==="canceled"||(null==t?void 0:t.status)==="cancel_requested"?t.status:"unpaid",l=(null==t?void 0:t.paidAt)&&"function"==typeof t.paidAt.toDate?t.paidAt.toDate():void 0;return{id:e.id,orderNumber:"number"==typeof(null==t?void 0:t.orderNumber)?t.orderNumber:void 0,customerId:"string"==typeof(null==t?void 0:t.customerId)?t.customerId:"guest",lineUserId:"string"==typeof(null==t?void 0:t.lineUserId)?t.lineUserId:void 0,lineDisplayName:"string"==typeof(null==t?void 0:t.lineDisplayName)?t.lineDisplayName:void 0,linePictureUrl:"string"==typeof(null==t?void 0:t.linePictureUrl)?t.linePictureUrl:void 0,customerEmail:"string"==typeof(null==t?void 0:t.customerEmail)?t.customerEmail:void 0,customerPhone:"string"==typeof(null==t?void 0:t.customerPhone)?t.customerPhone:void 0,items:a,totalAmount:"number"==typeof(null==t?void 0:t.totalAmount)?t.totalAmount:0,status:s,createdAt:r,paidAt:l}}let p={current:0},y={current:null};function g(e){var t;let{order:a}=e,s="canceled"===a.status;return(0,r.jsxs)("div",{className:"rounded-xl border p-4 shadow-sm ".concat(s?"bg-gray-100 border-gray-200 text-gray-500":"bg-white border-gray-200"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:a.linePictureUrl?(0,r.jsx)("img",{src:a.linePictureUrl,alt:"",className:"w-full h-full object-cover"}):null}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium truncate ".concat(s?"text-gray-600":"text-gray-900"),children:a.lineDisplayName||"（ゲスト）"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:["注文 #",null!==(t=a.orderNumber)&&void 0!==t?t:a.id.slice(0,12)," \xb7 ",x(a.createdAt)]})]}),(0,r.jsx)("span",{className:"text-sm font-semibold shrink-0 ".concat(s?"text-gray-600":"text-gray-900"),children:m(a.totalAmount)}),s&&(0,r.jsx)("span",{className:"shrink-0 rounded-full bg-gray-300 px-2 py-0.5 text-xs font-medium text-gray-600",children:"キャンセル"})]}),(a.customerEmail||a.customerPhone)&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mb-1 space-y-0.5",children:[a.customerEmail&&(0,r.jsxs)("p",{children:["メール: ",a.customerEmail]}),a.customerPhone&&(0,r.jsxs)("p",{children:["TEL: ",a.customerPhone]})]}),(0,r.jsx)("ul",{className:"text-base space-y-1 ".concat(s?"text-gray-600":"text-gray-700"),children:a.items.map((e,t)=>(0,r.jsxs)("li",{children:[e.name," \xd7 ",e.quantity," …"," ",m(e.unitPrice*e.quantity)]},t))})]})}function b(){var e;let{storeIds:t,premium:a,loading:b}=(0,u.dD)(),f=null!==(e=t[0])&&void 0!==e?e:null,[v,N]=(0,s.useState)(0);(0,s.useEffect)(()=>{N(0)},[f]);let[j,w]=(0,s.useState)([]),[k,C]=(0,s.useState)(!0),[S,A]=(0,s.useState)(null),[D,P]=(0,s.useState)(null),[E,U]=(0,s.useState)(null),[M,I]=(0,s.useState)(!1),[T,q]=(0,s.useState)(new Set),[L,_]=(0,s.useState)(!1),Z=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=(0,o.T)();if(!a||!f){w([]),C(!1),A(null);return}y.current&&(clearTimeout(y.current),y.current=null),p.current+=1;let r=p.current;C(!0),A(null);let s=(0,c.IO)((0,c.hJ)(a,"stores",f,"orders"),(0,c.Xo)("createdAt","desc")),l=t?()=>(0,c.zN)(s):()=>(0,c.PL)(s),n=!1;try{let e=await Promise.race([l(),new Promise((e,t)=>{y.current=setTimeout(()=>{y.current=null,t(Error("読み込みがタイムアウトしました。通信環境を確認して再試行してください。"))},18e3)})]);if(y.current&&(clearTimeout(y.current),y.current=null),r!==p.current)return;w(e.docs.map(h)),n=!0}catch(a){if(y.current&&(clearTimeout(y.current),y.current=null),r!==p.current)return;let t=a instanceof Error?a.message:"注文の取得に失敗しました";if(e<2){setTimeout(()=>Z(e+1),2e3);return}A(t),w([]),n=!0}finally{n&&r===p.current&&C(!1)}},[f]);(0,s.useEffect)(()=>{if(f){if(!(0,o.T)()&&v<6){let e=setTimeout(()=>N(e=>e+1),800);return()=>clearTimeout(e)}Z()}},[f,Z,v]);let F=(0,s.useMemo)(()=>j.filter(e=>"unpaid"===e.status),[j]),z=(0,s.useMemo)(()=>j.filter(e=>"cancel_requested"===e.status),[j]),H=(0,s.useMemo)(()=>j.filter(e=>"paid"===e.status||"canceled"===e.status).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),[j]),O=(0,s.useMemo)(()=>{let e=new Map;for(let s of H){var t,a,r;let l=null!==(a=null!==(t=s.lineUserId)&&void 0!==t?t:s.customerId)&&void 0!==a?a:"guest";e.has(l)||e.set(l,{lineUserId:l,lineDisplayName:null!==(r=s.lineDisplayName)&&void 0!==r?r:"（ゲスト）"})}return Array.from(e.values()).sort((e,t)=>e.lineDisplayName.localeCompare(t.lineDisplayName))},[H]),[V,J]=(0,s.useState)("unpaid"),[Y,K]=(0,s.useState)("list"),[R,B]=(0,s.useState)(""),[W,$]=(0,s.useState)(""),[X,G]=(0,s.useState)("all"),[Q,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[er,es]=(0,s.useState)(null),[el,en]=(0,s.useState)(null),ei=(0,s.useCallback)(async()=>{let e=(0,o.lx)("asia-northeast1");if(!e||!f){alert("ストア情報がありません");return}en("csv"),es(null);try{let t=(0,o.V1)(e,"requestOrdersExport"),{data:a}=await t({storeId:f,type:"csv"});a.downloadUrl?(es(a.downloadUrl),window.open(a.downloadUrl,"_blank","noopener,noreferrer")):alert("ダウンロード用のURLを取得できませんでした。")}catch(t){let e=t instanceof Error?t.message:String(t);alert(e.includes("permission")||e.includes("ログイン")?e:"エクスポートに失敗しました。しばらくしてから再試行してください。")}finally{en(null)}},[f]),ed=(0,s.useMemo)(()=>{let e=H;if(R){let t=new Date(R);t.setHours(0,0,0,0),e=e.filter(e=>e.createdAt>=t)}if(W){let t=new Date(W);t.setHours(23,59,59,999),e=e.filter(e=>e.createdAt<=t)}if("paid"===X?e=e.filter(e=>"paid"===e.status):"canceled"===X&&(e=e.filter(e=>"canceled"===e.status)),Q&&(e=e.filter(e=>{var t;return(null!==(t=e.lineUserId)&&void 0!==t?t:e.customerId)===Q})),"monthly"===Y){let[t,a]=et.split("-").map(Number);e=e.filter(e=>e.createdAt.getFullYear()===t&&e.createdAt.getMonth()===a-1)}return e},[H,R,W,X,Q,Y,et]),ec=(0,s.useMemo)(()=>{let e=new Map;for(let s of ed){var t,a,r;let l=null!==(a=null!==(t=s.lineUserId)&&void 0!==t?t:s.customerId)&&void 0!==a?a:"guest";e.has(l)||e.set(l,{lineUserId:l,lineDisplayName:null!==(r=s.lineDisplayName)&&void 0!==r?r:"（ゲスト）"})}return Array.from(e.values()).sort((e,t)=>e.lineDisplayName.localeCompare(t.lineDisplayName))},[ed]),eo=(0,s.useMemo)(()=>{if("monthly"!==Y)return null;let e=ed.filter(e=>"paid"===e.status),t=e.reduce((e,t)=>e+t.totalAmount,0);return{count:ed.length,paidCount:e.length,total:t}},[Y,ed]),eu=(0,s.useMemo)(()=>F.reduce((e,t)=>e+t.totalAmount,0),[F]),em=(0,s.useMemo)(()=>j.filter(e=>"paid"===e.status&&e.paidAt&&function(e){let t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()}(e.paidAt)).reduce((e,t)=>e+t.totalAmount,0),[j]),ex=async e=>{let t=(0,o.T)();if(t&&f){P(e);try{let a=new Date;await (0,c.r7)((0,c.JU)(t,"stores",f,"orders",e),{status:"paid",paidAt:(0,c.Bt)()}),w(t=>t.map(t=>t.id===e?{...t,status:"paid",paidAt:a}:t))}finally{P(null)}}},eh=async e=>{let t=(0,o.T)();if(t&&f){U(e);try{await (0,c.r7)((0,c.JU)(t,"stores",f,"orders",e),{status:"canceled"}),w(t=>t.map(t=>t.id===e?{...t,status:"canceled"}:t))}finally{U(null)}}},ep=async e=>{let t=(0,o.T)();if(t&&f){U(e);try{await (0,c.r7)((0,c.JU)(t,"stores",f,"orders",e),{status:"unpaid"}),w(t=>t.map(t=>t.id===e?{...t,status:"unpaid"}:t))}finally{U(null)}}};if(b||!f)return(0,r.jsxs)("main",{className:"max-w-2xl mx-auto px-4 py-6 pb-24",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-4",children:"注文管理・集計"}),(0,r.jsx)("p",{className:"text-gray-500",children:b?"読み込み中…":"ショップが登録されていません。"})]});let ey=(0,s.useCallback)(()=>{A(null),Z()},[Z]),eg=(0,s.useCallback)(e=>{q(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),eb=(0,s.useCallback)(()=>{I(!1),q(new Set)},[]),ef=(0,s.useCallback)(async()=>{let e=(0,o.T)();if(e&&f&&0!==T.size){_(!0);try{await Promise.all(Array.from(T).map(t=>(0,c.oe)((0,c.JU)(e,"stores",f,"orders",t)))),w(e=>e.filter(e=>!T.has(e.id))),q(new Set),I(!1)}finally{_(!1)}}},[f,T]),ev=(0,s.useMemo)(()=>(a?ed:H).map(e=>e.id),[a,ed,H]),eN=(0,s.useMemo)(()=>"history"===V?ev:j.map(e=>e.id),[V,ev,j]),ej="unpaid"===V?j.length>0:(a?ed:H).length>0;return(0,r.jsxs)("main",{className:"max-w-2xl mx-auto px-4 py-6 pb-24",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-4 flex-wrap",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"注文管理・集計"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[ej&&(0,r.jsx)("button",{type:"button",onClick:()=>I(e=>!e),className:"p-2.5 rounded-full min-h-touch min-w-touch flex items-center justify-center ".concat(M?"bg-[var(--admin-accent)]/15 text-[var(--admin-accent)]":"text-gray-500 hover:bg-gray-100"),"aria-pressed":M,title:M?"削除モードを解除":"削除（タップで選択）","aria-label":"削除",children:(0,r.jsx)(n.Z,{className:"h-6 w-6","aria-hidden":!0})}),(0,r.jsxs)("button",{type:"button",onClick:ey,disabled:k,className:"flex items-center gap-1.5 min-h-touch rounded-xl bg-[var(--admin-accent)] px-4 py-2.5 text-sm font-medium text-white active:opacity-90 disabled:opacity-60 disabled:pointer-events-none","aria-label":"注文を再読み込み",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 ".concat(k?"animate-spin":"")}),k?"更新中…":"更新"]})]})]}),M&&ej&&(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[(0,r.jsx)("button",{type:"button",onClick:()=>q(new Set(eN)),className:"min-h-touch py-2 px-3 text-sm font-medium text-[var(--admin-accent)] bg-[var(--admin-accent)]/10 rounded-full",children:"全選択"}),(0,r.jsx)("button",{type:"button",onClick:()=>q(new Set),className:"min-h-touch py-2 px-3 text-sm font-medium text-gray-600 bg-gray-100 rounded-full",children:"解除"}),(0,r.jsx)("button",{type:"button",onClick:eb,className:"min-h-touch py-2 px-3 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-full",children:"キャンセル"})]}),S?(0,r.jsxs)("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-6",children:[(0,r.jsx)("p",{className:"text-amber-800 font-medium",children:"注文を読み込めませんでした"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-amber-700",children:S}),(0,r.jsx)("div",{className:"mt-4 flex flex-wrap gap-3",children:(0,r.jsx)("button",{type:"button",onClick:()=>Z(),className:"min-h-touch rounded-xl bg-amber-600 px-4 py-2.5 text-sm font-medium text-white active:opacity-90",children:"再試行する"})})]}):k?(0,r.jsx)("p",{className:"text-gray-500",children:"注文を読み込み中…"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("section",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-0.5",children:"今月の売り上げ"}),(0,r.jsx)("p",{className:"text-lg font-bold text-gray-900",children:m(em)})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-0.5",children:"未回収金額"}),(0,r.jsx)("p",{className:"text-lg font-bold text-amber-700",children:m(eu)})]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:(0,r.jsx)(l.default,{href:"/admin/settings/payment",className:"text-[var(--admin-accent)] underline",children:"支払い方法の設定（PayPay・振込先）"})}),(0,r.jsxs)("div",{className:"flex border-b border-gray-200 mb-4",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>J("unpaid"),className:"flex-1 py-3 text-sm font-medium border-b-2 min-h-touch ".concat("unpaid"===V?"border-[var(--admin-accent)] text-[var(--admin-accent)]":"border-transparent text-gray-500"),children:["未処理（",F.length+z.length,"）"]}),(0,r.jsx)("button",{type:"button",onClick:()=>J("history"),className:"flex-1 py-3 text-sm font-medium border-b-2 min-h-touch ".concat("history"===V?"border-[var(--admin-accent)] text-[var(--admin-accent)]":"border-transparent text-gray-500"),children:"履歴"})]}),"unpaid"===V&&(0,r.jsx)("ul",{className:"space-y-4 max-w-md",children:0===F.length&&0===z.length?(0,r.jsx)("li",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 p-8 text-center text-gray-500",children:"未払いの注文はありません。"}):(0,r.jsxs)(r.Fragment,{children:[F.map(e=>{var t;return(0,r.jsx)("li",{role:M?"button":void 0,tabIndex:M?0:void 0,onClick:M?()=>eg(e.id):void 0,onKeyDown:M?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eg(e.id))}:void 0,className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm ".concat(M?"cursor-pointer":""," ").concat(M&&T.has(e.id)?"ring-2 ring-[var(--admin-accent)] ring-offset-2":""),children:(0,r.jsxs)("div",{className:M?"pointer-events-none":"",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:e.linePictureUrl?(0,r.jsx)("img",{src:e.linePictureUrl,alt:"",className:"w-full h-full object-cover"}):null}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.lineDisplayName||"（ゲスト）"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:["注文 #",null!==(t=e.orderNumber)&&void 0!==t?t:e.id.slice(0,12)," \xb7 ",x(e.createdAt)]})]}),(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-900 shrink-0",children:m(e.totalAmount)})]}),(e.customerEmail||e.customerPhone)&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mb-2 space-y-0.5",children:[e.customerEmail&&(0,r.jsxs)("p",{children:["メール: ",e.customerEmail]}),e.customerPhone&&(0,r.jsxs)("p",{children:["TEL: ",e.customerPhone]})]}),(0,r.jsx)("ul",{className:"text-base text-gray-700 mb-4 space-y-1",children:e.items.map((e,t)=>(0,r.jsxs)("li",{children:[e.name," \xd7 ",e.quantity," …"," ",m(e.unitPrice*e.quantity)]},t))}),(0,r.jsx)("button",{type:"button",onClick:()=>ex(e.id),disabled:D===e.id,className:"w-full min-h-touch rounded-xl font-medium py-2.5 disabled:opacity-70 ".concat(D===e.id?"bg-gray-300 text-gray-600":"bg-[var(--admin-accent)] text-white active:opacity-90"),children:D===e.id?"処理中…":"受取完了（消込）"})]})},e.id)}),z.map(e=>{var t;return(0,r.jsx)("li",{role:M?"button":void 0,tabIndex:M?0:void 0,onClick:M?()=>eg(e.id):void 0,onKeyDown:M?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eg(e.id))}:void 0,className:"rounded-xl border border-gray-200 bg-gray-50 p-4 shadow-sm opacity-90 ".concat(M?"cursor-pointer":""," ").concat(M&&T.has(e.id)?"ring-2 ring-[var(--admin-accent)] ring-offset-2":""),children:(0,r.jsxs)("div",{className:M?"pointer-events-none":"",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:e.linePictureUrl?(0,r.jsx)("img",{src:e.linePictureUrl,alt:"",className:"w-full h-full object-cover"}):null}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.lineDisplayName||"（ゲスト）"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:["注文 #",null!==(t=e.orderNumber)&&void 0!==t?t:e.id.slice(0,12)," \xb7 ",x(e.createdAt)]})]}),(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-900 shrink-0",children:m(e.totalAmount)})]}),(0,r.jsx)("p",{className:"text-xs font-medium text-amber-700 mb-2",children:"キャンセル申請中"}),(e.customerEmail||e.customerPhone)&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mb-2 space-y-0.5",children:[e.customerEmail&&(0,r.jsxs)("p",{children:["メール: ",e.customerEmail]}),e.customerPhone&&(0,r.jsxs)("p",{children:["TEL: ",e.customerPhone]})]}),(0,r.jsx)("ul",{className:"text-base text-gray-700 mb-4 space-y-1",children:e.items.map((e,t)=>(0,r.jsxs)("li",{children:[e.name," \xd7 ",e.quantity," …"," ",m(e.unitPrice*e.quantity)]},t))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>eh(e.id),disabled:E===e.id,className:"flex-1 min-h-touch rounded-xl border border-red-200 bg-red-50 py-2.5 text-sm font-medium text-red-700 disabled:opacity-70",children:E===e.id?"処理中…":"キャンセルを承認"}),(0,r.jsx)("button",{type:"button",onClick:()=>ep(e.id),disabled:E===e.id,className:"flex-1 min-h-touch rounded-xl border border-gray-300 bg-white py-2.5 text-sm font-medium text-gray-700 disabled:opacity-70",children:E===e.id?"処理中…":"キャンセルを拒否"})]})]})},e.id)})]})}),"history"===V&&(0,r.jsxs)("div",{className:"space-y-4 max-w-md",children:[!a&&(0,r.jsx)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:"プレミアムプランで顧客別・月間表示やCSV出力が利用できます。"}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative flex w-full rounded-full bg-gray-200 p-1 min-h-touch",children:[(0,r.jsx)("div",{className:"absolute top-1 bottom-1 rounded-full bg-[var(--admin-accent)] transition-[left] duration-200 ease-out",style:{width:"calc((100% - 8px) / 3)",left:"calc(4px + (100% - 8px) * ".concat(["list","customer","monthly"].indexOf(Y)/3,")")}}),["list","customer","monthly"].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>K(e),className:"relative z-10 flex-1 min-h-touch rounded-full py-2 text-sm font-medium transition-colors duration-200 ".concat(Y===e?"text-white":"text-gray-700"),children:"list"===e?"一覧":"customer"===e?"顧客別":"月間"},e))]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[(0,r.jsxs)("label",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"開始日"}),(0,r.jsx)("input",{type:"date",value:R,onChange:e=>B(e.target.value),className:"rounded border border-gray-300 px-2 py-1"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"終了日"}),(0,r.jsx)("input",{type:"date",value:W,onChange:e=>$(e.target.value),className:"rounded border border-gray-300 px-2 py-1"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"状態"}),(0,r.jsxs)("select",{value:X,onChange:e=>G(e.target.value),className:"rounded border border-gray-300 px-2 py-1",children:[(0,r.jsx)("option",{value:"all",children:"すべて"}),(0,r.jsx)("option",{value:"paid",children:"完了のみ"}),(0,r.jsx)("option",{value:"canceled",children:"キャンセルのみ"})]})]}),"customer"===Y&&(0,r.jsxs)("label",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"顧客"}),(0,r.jsxs)("select",{value:Q,onChange:e=>ee(e.target.value),className:"rounded border border-gray-300 px-2 py-1 min-w-[120px]",children:[(0,r.jsx)("option",{value:"",children:"全員"}),O.map(e=>(0,r.jsx)("option",{value:e.lineUserId,children:e.lineDisplayName},e.lineUserId))]})]}),"monthly"===Y&&(0,r.jsxs)("label",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"年月"}),(0,r.jsx)("input",{type:"month",value:et,onChange:e=>ea(e.target.value),className:"rounded border border-gray-300 px-2 py-1"})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("button",{type:"button",disabled:null!==el,onClick:()=>ei(),className:"inline-flex items-center gap-1.5 min-h-touch rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 active:bg-gray-50 disabled:opacity-60",children:[(0,r.jsx)(d,{className:"h-4 w-4 ".concat("csv"===el?"animate-pulse":"")}),"csv"===el?"準備中…":"CSV"]}),er&&(0,r.jsxs)("a",{href:er,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 min-h-touch rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 active:bg-gray-50",children:[(0,r.jsx)(d,{className:"h-4 w-4"}),"CSVをダウンロード"]})]}),"monthly"===Y&&eo&&(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white p-4 grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"件数"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[eo.count," 件"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"売上合計（完了のみ）"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:m(eo.total)})]})]})]}),(0,r.jsx)("ul",{className:"space-y-4",children:0===(a?ed:H).length?(0,r.jsx)("li",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 p-8 text-center text-gray-500",children:"履歴はありません。"}):"customer"===Y&&a?ec.filter(e=>!Q||e.lineUserId===Q).map(e=>{let t=ed.filter(t=>{var a;return(null!==(a=t.lineUserId)&&void 0!==a?a:t.customerId)===e.lineUserId});return 0===t.length?null:(0,r.jsxs)("li",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 sticky top-0 bg-gray-50 py-1 -mx-1 px-1 rounded",children:e.lineDisplayName}),(0,r.jsx)("ul",{className:"space-y-3",children:t.map(e=>(0,r.jsx)("li",{role:M?"button":void 0,tabIndex:M?0:void 0,onClick:M?()=>eg(e.id):void 0,onKeyDown:M?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eg(e.id))}:void 0,className:M?"cursor-pointer ".concat(T.has(e.id)?"ring-2 ring-[var(--admin-accent)] ring-offset-2 rounded-xl":""):"",children:(0,r.jsx)("div",{className:M?"pointer-events-none":"",children:(0,r.jsx)(g,{order:e})})},e.id))})]},e.lineUserId)}):(a?ed:H).map(e=>(0,r.jsx)("li",{role:M?"button":void 0,tabIndex:M?0:void 0,onClick:M?()=>eg(e.id):void 0,onKeyDown:M?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eg(e.id))}:void 0,className:M?"cursor-pointer ".concat(T.has(e.id)?"ring-2 ring-[var(--admin-accent)] ring-offset-2 rounded-xl":""):"",children:(0,r.jsx)("div",{className:M?"pointer-events-none":"",children:(0,r.jsx)(g,{order:e})})},e.id))})]}),M&&T.size>0&&(0,r.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-[60] flex justify-center px-4 pt-2 pb-[max(7rem,calc(5rem+env(safe-area-inset-bottom)))] bg-gradient-to-t from-black/30 to-transparent pointer-events-none","aria-hidden":!0,children:(0,r.jsxs)("div",{className:"w-full max-w-xs rounded-2xl bg-white shadow-lg border border-gray-200 p-4 pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"admin-order-delete-dialog-title",children:[(0,r.jsxs)("h3",{id:"admin-order-delete-dialog-title",className:"text-sm font-semibold text-gray-800",children:["削除（",T.size," 件）"]}),(0,r.jsx)("p",{className:"mt-1.5 text-xs text-gray-600",children:"取り消せません。"}),(0,r.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:eb,disabled:L,className:"flex-1 min-h-touch py-2 rounded-xl border border-gray-300 text-gray-700 text-sm font-medium",children:"キャンセル"}),(0,r.jsx)("button",{type:"button",onClick:ef,disabled:L,className:"flex-1 min-h-touch py-2 rounded-xl bg-[var(--admin-accent)] text-white text-sm font-medium disabled:opacity-50",children:L?"削除中...":"削除する"})]})]})})]})]})}},9205:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:c="",children:o,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:a,strokeWidth:d?24*Number(i)/Number(s):i,className:l("lucide",c),...m},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(o)?o:[o]])}),d=(e,t)=>{let a=(0,r.forwardRef)((a,n)=>{let{className:d,...c}=a;return(0,r.createElement)(i,{ref:n,iconNode:t,className:l("lucide-".concat(s(e)),d),...c})});return a.displayName="".concat(e),a}},7168:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[358,990,249,648,679,971,117,744],function(){return e(e.s=2592)}),_N_E=e.O()}]);