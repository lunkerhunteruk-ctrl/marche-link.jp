(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[244],{3041:function(e,t,n){Promise.resolve().then(n.bind(n,110))},110:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),l=n(2265),u=n(3168),i=n(2268),a=n(6942),o=n(2489),c=n(9397);function s(e){let{title:t,items:n,onAdd:u,onRemove:i,onReorder:a,placeholder:s="追加"}=e,[d,f]=(0,l.useState)(""),[h,m]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),v=(0,l.useRef)(null),y=(0,l.useRef)(null),w=(0,l.useRef)(null),x=(0,l.useRef)(null),b=(0,l.useRef)(!1),N=()=>{let e=d.trim();e&&!n.includes(e)&&(u(e),f(""))},k=(0,l.useCallback)((e,t)=>{let r=v.current;if(!r||0===n.length)return 0;let l=Array.from(r.children).filter(e=>e.hasAttribute("data-drag-index")).sort((e,t)=>{var n,r;return parseInt(null!==(n=e.getAttribute("data-drag-index"))&&void 0!==n?n:"0",10)-parseInt(null!==(r=t.getAttribute("data-drag-index"))&&void 0!==r?r:"0",10)});for(let n=0;n<l.length;n++){let r=l[n].getBoundingClientRect();if(e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom)return e<r.left+r.width/2?n:n+1}return l.length},[n.length]),E=(e,t)=>{if(b.current){e.preventDefault();return}m(t),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t)))},I=()=>{m(null),g(null),y.current=null},T=(e,t)=>{w.current=window.setTimeout(()=>{w.current=null,b.current=!0,x.current=t,m(t)},400)},j=e=>{if(null!==x.current&&e.changedTouches[0]){let t=e.changedTouches[0],n=k(t.clientX,t.clientY);y.current!==n&&(y.current=n,g(n))}},L=()=>{w.current&&(clearTimeout(w.current),w.current=null);let e=x.current,t=y.current;if(null!==e&&null!==t&&!Number.isNaN(t)&&t!==e&&a){let r=[...n],[l]=r.splice(e,1);r.splice(e<t?t-1:t,0,l),a(r)}x.current=null,y.current=null,g(null),b.current=!1,m(null)},D=()=>{w.current&&(clearTimeout(w.current),w.current=null),x.current=null,y.current=null,g(null),b.current=!1,m(null)};(0,l.useEffect)(()=>{if(null===h)return;let e=e=>{null!==x.current&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>document.removeEventListener("touchmove",e)},[h]);let C=!!(a&&n.length>1);return(0,r.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-white p-4",children:[(0,r.jsx)("h2",{className:"mb-3 text-base font-semibold text-gray-900",children:t}),(0,r.jsxs)("div",{ref:v,className:"mb-3 flex flex-wrap gap-2",onDragOver:C?e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move");let t=k(e.clientX,e.clientY);y.current!==t&&(y.current=t,g(t))}:void 0,onDrop:C?e=>{var t;e.preventDefault();let r=null!=h?h:e.dataTransfer.getData("text/plain")?parseInt(e.dataTransfer.getData("text/plain"),10):null,l=null!==(t=y.current)&&void 0!==t?t:0;if(null===r||r===l||Number.isNaN(r)||!a){m(null),g(null),y.current=null;return}let u=[...n],[i]=u.splice(r,1);u.splice(r<l?l-1:l,0,i),a(u),m(null),g(null),y.current=null}:void 0,onDragLeave:C?I:void 0,children:[n.map((e,t)=>(0,r.jsxs)(l.Fragment,{children:[p===t&&(0,r.jsx)("div",{className:"h-8 w-0.5 flex-shrink-0 self-center rounded-full bg-[var(--admin-accent)]","aria-hidden":!0}),(0,r.jsxs)("span",{"data-drag-index":t,draggable:C,onDragStart:C?e=>E(e,t):void 0,onDragEnd:C?I:void 0,onTouchStart:C?e=>T(e,t):void 0,onTouchMove:C?j:void 0,onTouchEnd:C?L:void 0,onTouchCancel:C?D:void 0,className:"inline-flex min-h-touch touch-none select-none items-center gap-1 rounded-full border-2 px-3 py-1.5 text-sm text-gray-800 ".concat(h===t?"border-[var(--admin-accent)] bg-gray-50 opacity-80":"border-transparent bg-gray-100"),style:C?{WebkitTouchCallout:"none",WebkitUserSelect:"none"}:void 0,children:[e,(0,r.jsx)("button",{type:"button",onClick:()=>i(t),className:"flex items-center justify-center rounded-full p-0.5 hover:bg-gray-200","aria-label":"".concat(e," を削除"),children:(0,r.jsx)(o.Z,{className:"h-3.5 w-3.5"})})]})]},"".concat(e,"-").concat(t))),p===n.length&&n.length>0&&(0,r.jsx)("div",{className:"h-8 w-0.5 flex-shrink-0 self-center rounded-full bg-[var(--admin-accent)]","aria-hidden":!0})]}),n.length>1&&a&&(0,r.jsx)("p",{className:"mb-3 text-xs text-gray-500",children:"長押しまたはドラッグで順番を入れ替えられます。"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"text",value:d,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),N()),placeholder:s,className:"min-w-0 flex-1 rounded-xl border border-gray-300 px-4 py-2.5 text-base focus:border-[var(--admin-accent)] focus:outline-none focus:ring-2 focus:ring-[var(--admin-accent)]/30"}),(0,r.jsx)("button",{type:"button",onClick:N,className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full border border-[var(--admin-accent)] bg-[var(--admin-accent)] text-white active:scale-[0.98]","aria-label":"追加",children:(0,r.jsx)(c.Z,{className:"h-5 w-5",strokeWidth:2.5})})]})]})}function d(){let{user:e}=(0,a.a)(),[t,n]=(0,l.useState)([...u.HR]),[o,c]=(0,l.useState)([...u.X0]),[d,f]=(0,l.useState)([...u.ST]),[h,m]=(0,l.useState)(!0),[p,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!(null==e?void 0:e.uid)){m(!1);return}(0,i.b)(e.uid).then(e=>{n(e.productNames),c(e.units),f(e.categories)}).finally(()=>m(!1))},[null==e?void 0:e.uid]);let v=(0,l.useCallback)(t=>{(null==e?void 0:e.uid)&&(g(!0),(0,i.x)(e.uid,t).catch(()=>{}).finally(()=>g(!1)))},[null==e?void 0:e.uid]);return h?(0,r.jsx)("main",{className:"py-6",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"読み込み中..."})}):(0,r.jsxs)("main",{className:"space-y-6",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"クイック出品で使う「よく使う商品名」「単位」「カテゴリ」をタグのように追加・削除できます。追加・削除すると自動で保存されます。"}),p&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"保存中..."}),(0,r.jsx)(s,{title:"よく使う商品名",items:t,onAdd:e=>{n(t=>{let n=[...t,e];return v({productNames:n,units:o,categories:d}),n})},onRemove:e=>{n(t=>{let n=t.filter((t,n)=>n!==e);return v({productNames:n,units:o,categories:d}),n})},onReorder:e=>{n(e),v({productNames:e,units:o,categories:d})},placeholder:"例: クロワッサン"}),(0,r.jsx)(s,{title:"よく使う単位",items:o,onAdd:e=>{c(n=>{let r=[...n,e];return v({productNames:t,units:r,categories:d}),r})},onRemove:e=>{c(n=>{let r=n.filter((t,n)=>n!==e);return v({productNames:t,units:r,categories:d}),r})},onReorder:e=>{c(e),v({productNames:t,units:e,categories:d})},placeholder:"例: 個"}),(0,r.jsx)(s,{title:"カテゴリ",items:d,onAdd:e=>{f(n=>{let r=[...n,e];return v({productNames:t,units:o,categories:r}),r})},onRemove:e=>{f(n=>{let r=n.filter((t,n)=>n!==e);return v({productNames:t,units:o,categories:r}),r})},onReorder:e=>{f(e),v({productNames:t,units:o,categories:e})},placeholder:"例: パン"})]})}},31:function(e,t,n){"use strict";n.d(t,{Dj:function(){return m},G$:function(){return a},KC:function(){return h},SX:function(){return s},bm:function(){return c},hD:function(){return o},lG:function(){return f},p3:function(){return i},s1:function(){return u},tE:function(){return d}});var r,l=n(257);let u="2009034946-GQ1UQIRr".trim()||"2009034946-GQ1UQIRr",i=(null===(r=l.env.NEXT_PUBLIC_LIFF_ID_ADMIN_DIRECT)||void 0===r?void 0:r.trim())||"2009034946-LkF5LngF",a="https://liff.line.me/2009034946-LkF5LngF",o="2009034946-KaRhKY16".trim()||"2009034946-KaRhKY16",c="https://marche-link.jp/admin-entry/",s="https://marche-link.jp/admin/",d="marche-link-liff-inited",f="https://liff.line.me/".concat(u,"/"),h="https://liff.line.me/".concat(i,"/"),m="https://liff.line.me/".concat(o)},3168:function(e,t,n){"use strict";n.d(t,{HR:function(){return r},ST:function(){return u},X0:function(){return l}});let r=["クロワッサン","メロンパン","アップルパイ","食パン","カレーパン","惣菜パン","飲み物"],l=["個","本","束","ケース","箱","袋","パック"],u=["パン","飲み物","惣菜","その他"]},7293:function(e,t,n){"use strict";n.d(t,{E7:function(){return h},G5:function(){return f},T:function(){return m},V1:function(){return i.V1},lx:function(){return p}});var r=n(738),l=n(3301),u=n(5978),i=n(3491);let a={apiKey:"AIzaSyCa4s0nrtJe2PNf86c3843MVDsL6fpwljQ",authDomain:"marche-link.firebaseapp.com",projectId:"marche-link",storageBucket:"marche-link.firebasestorage.app",messagingSenderId:"1006467595458",appId:"1:1006467595458:web:ecf555e02bb7335e5dcf5b"},o=null,c=null,s=null,d=!1;function f(){if(!a.apiKey||!a.projectId)return null;if(o)return o;if(d)return null;try{let e=(0,r.C6)();return o=e.length>0?e[0]:(0,r.ZF)(a)}catch(e){return d=!0,"undefined"!=typeof console&&console.warn&&console.warn("[Firebase] 初期化に失敗しました",e),null}}function h(){try{let e=f();if(!e)return null;return c||(c=(0,l.v0)(e)),c}catch(e){return null}}function m(){try{let e=f();if(!e)return null;return s||(s=(0,u.ad)(e)),s}catch(e){return null}}function p(e){try{let t=f();if(!t)return null;return(0,i.$C)(t,null!=e?e:"asia-northeast1")}catch(e){return null}}},6942:function(e,t,n){"use strict";n.d(t,{a:function(){return c}});var r=n(2265),l=n(3301),u=n(7293),i=n(6515),a=n(31),o=n(8045);function c(){let[e,t]=(0,r.useState)(null),[n,c]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e;try{let n=(0,u.E7)();if(!n){c(!1);return}e=(0,l.Aj)(n,e=>{t(null!=e?e:null),c(!1)})}catch(e){t(null),c(!1)}return()=>{try{null==e||e()}catch(e){}}},[]),{user:e,loading:n,signInWithLine:async()=>{let e;let t="1"===new URLSearchParams(window.location.search).get("line_debug"),n=e=>{t&&"undefined"!=typeof alert&&alert(e)},r=(0,u.E7)();if(!r)throw Error("Firebase Auth が利用できません");try{await (0,i.$w)(a.p3)}catch(e){throw Error("LINE でログインしてください。LINE アプリ内で、管理画面の LIFF リンクから開き直すか、もう一度お試しください。")}let c=null;for(let e of[0,200,500,1e3])if(e>0&&await new Promise(t=>setTimeout(t,e)),c=await (0,i.Tc)())break;if(!c){if((0,i.DT)()){(0,i.Lq)(a.SX);return}throw Error("このページは LINE アプリ内で開く必要があります。リンクを LINE のトークに送り、そのリンクをタップして開いてください。")}n("1/4 LIFF IDトークン取得済み");let s=(0,u.lx)("asia-northeast1");if(!s)throw Error("Cloud Functions が利用できません");let d=(0,u.V1)(s,"getLineAuthCustomToken");try{e=await Promise.race([d({idToken:c}),new Promise((e,t)=>setTimeout(()=>t(Error("認証サーバーからの応答がありません。通信を確認して再試行してください。Cloud Functions のデプロイと LINE_CHANNEL_ID の設定を確認してください（docs/auth-server-no-response.md）。")),2e4))])}catch(e){throw n("2/4 失敗: "+(e instanceof Error?e.message:String(e))),e}n("2/4 カスタムトークン受信済み");let{customToken:f}=e.data;if(!f)throw n("3/4 失敗: customToken が空"),Error("認証に失敗しました");try{n("3/4 Firebase にサインイン中..."),await (0,l._p)(r,f)}catch(t){let e=t instanceof Error?t.message:String(t);if(n("3/4 失敗: "+e),e.includes("auth/api-key-not-valid"))throw Error("Firebase の API キーが無効です。LINE 内で開いている場合は、Google Cloud Console の API キー「HTTP リファラ」制限で LINE 由来のリクエストを許可するか、制限を「なし」にしてください。詳しくは docs/firebase-api-key-iphone.md");throw Error(e.includes("auth/")?"Firebase へのログインに失敗しました。再試行してください。":e)}n("4/4 ログイン完了"),(0,o.rZ)()},signOut:async()=>{let e=(0,u.E7)();e&&await (0,l.w7)(e)}}}},6515:function(e,t,n){"use strict";n.d(t,{$w:function(){return o},DT:function(){return c},Lq:function(){return d},Tc:function(){return h},cz:function(){return m},jl:function(){return s},lA:function(){return p},o$:function(){return f}});let r=null,l=null,u=!1,i=!1;async function a(){if(r)return r;try{return r=(await n.e(949).then(n.bind(n,2949))).default}catch(e){return null}}async function o(e){return(i||(i=!0,window.addEventListener("pagehide",()=>{l=null,r=null,u=!0})),l)?l:l=(async()=>{let t=e;window.location.pathname.startsWith("/admin")&&!window.location.pathname.startsWith("/admin-entry")&&(e.endsWith("KaRhKY16")||e.includes("KaRhKY16"))&&(t="2009034946-LkF5LngF");let n=await a();n&&(u||!n.id)&&(u&&(u=!1),await new Promise(e=>requestAnimationFrame(()=>e())),await n.init({liffId:t}))})().catch(e=>{throw l=null,e})}function c(){if(!r)return!1;try{return r.isInClient()}catch(e){return!1}}function s(){if(!r)return!1;try{return r.isLoggedIn()}catch(e){return!1}}function d(e){r&&r.login({redirectUri:e})}async function f(){var e;let t=await a();if(!t)throw Error("LIFF が利用できません");let n=await t.getProfile();return{userId:n.userId,displayName:null!==(e=n.displayName)&&void 0!==e?e:"",pictureUrl:n.pictureUrl}}async function h(){let e=await a();if(!e||"function"!=typeof e.getIDToken)return null;try{let t=await e.getIDToken();return t&&"string"==typeof t?t:null}catch(e){return null}}async function m(){let e=await a();if(!e||"function"!=typeof e.getDecodedIDToken)return null;try{let t=e.getDecodedIDToken();if((null==t?void 0:t.email)&&"string"==typeof t.email&&t.email.trim())return t.email.trim();return null}catch(e){return null}}function p(){(null==r?void 0:r.closeWindow)&&r.closeWindow()}},2268:function(e,t,n){"use strict";n.d(t,{b:function(){return o},x:function(){return c}});var r=n(5978),l=n(7293),u=n(3168);let i={productNames:[...u.HR],units:[...u.X0],categories:[...u.ST]};function a(e){return Array.isArray(e)&&e.every(e=>"string"==typeof e)}async function o(e){let t=(0,l.T)();if(!t)return i;let n=await (0,r.QT)((0,r.JU)(t,"adminUsers",e));if(!n.exists())return i;let u=n.data();return{productNames:a(null==u?void 0:u.presetProductNames)?u.presetProductNames:i.productNames,units:a(null==u?void 0:u.presetUnits)?u.presetUnits:i.units,categories:a(null==u?void 0:u.presetCategories)?u.presetCategories:i.categories}}async function c(e,t){let n=(0,l.T)();n&&await (0,r.pl)((0,r.JU)(n,"adminUsers",e),{presetProductNames:t.productNames,presetUnits:t.units,presetCategories:t.categories},{merge:!0})}},8045:function(e,t,n){"use strict";n.d(t,{J2:function(){return u},Mn:function(){return l},rZ:function(){return i}});let r="marche-link-admin-manual-logout";function l(){try{return"1"===window.localStorage.getItem(r)}catch(e){return!1}}function u(){try{window.localStorage.setItem(r,"1")}catch(e){}}function i(){try{window.localStorage.removeItem(r)}catch(e){}}},9205:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:l=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:c="",children:s,iconNode:d,...f}=e;return(0,r.createElement)("svg",{ref:t,...i,width:l,height:l,stroke:n,strokeWidth:o?24*Number(a)/Number(l):a,className:u("lucide",c),...f},[...d.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(s)?s:[s]])}),o=(e,t)=>{let n=(0,r.forwardRef)((n,i)=>{let{className:o,...c}=n;return(0,r.createElement)(a,{ref:i,iconNode:t,className:u("lucide-".concat(l(e)),o),...c})});return n.displayName="".concat(e),n}},9397:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2489:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[358,990,249,971,117,744],function(){return e(e.s=3041)}),_N_E=e.O()}]);