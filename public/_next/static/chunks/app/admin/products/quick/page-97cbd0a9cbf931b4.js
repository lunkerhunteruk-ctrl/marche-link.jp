(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[671],{915:function(e,t,r){Promise.resolve().then(r.bind(r,4141))},4141:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(7437),a=r(2265),s=r(6942);function l(e){let{label:t,value:r,options:s,onChange:l,onAddNew:o,placeholder:i="選択または入力...",required:c=!1,disabled:u=!1}=e,[d,m]=(0,a.useState)(!1),[x,b]=(0,a.useState)(r),[f,h]=(0,a.useState)(!1),p=(0,a.useRef)(null),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{b(r)},[r]),(0,a.useEffect)(()=>{function e(e){!p.current||p.current.contains(e.target)||(m(!1),s.some(e=>e.name===x)||b(r))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[x,r,s]);let y=s.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())),w=o&&""!==x.trim()&&!s.some(e=>e.name.toLowerCase()===x.trim().toLowerCase()),v=e=>{b(e.name),l(e.name),m(!1)},N=async()=>{if(o&&w){h(!0);try{let e=await o(x.trim());e&&(b(e.name),l(e.name))}catch(e){console.error("追加に失敗しました:",e)}finally{h(!1),m(!1)}}};return(0,n.jsxs)("div",{ref:p,className:"relative",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,c&&(0,n.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{ref:g,type:"text",value:x,onChange:e=>{b(e.target.value),m(!0)},onFocus:()=>{m(!0)},onKeyDown:e=>{if("Enter"===e.key)e.preventDefault(),w?N():1===y.length&&v(y[0]);else if("Escape"===e.key){var t;m(!1),null===(t=g.current)||void 0===t||t.blur()}},placeholder:i,disabled:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed pr-8"}),(0,n.jsx)("button",{type:"button",onClick:()=>m(!d),disabled:u,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed",children:(0,n.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),d&&(0,n.jsxs)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:[y.length>0?(0,n.jsx)("ul",{className:"py-1",children:y.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)("button",{type:"button",onClick:()=>v(e),className:"w-full px-3 py-2 text-left hover:bg-gray-100 ".concat(e.name===r?"bg-blue-50 text-blue-700":"text-gray-900"),children:e.name})},e.id))}):!w&&(0,n.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"該当する項目がありません"}),w&&(0,n.jsx)("div",{className:"border-t border-gray-200 px-2 py-2",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"text",value:x,readOnly:!0,className:"flex-1 min-w-0 max-w-[140px] px-2 py-1 text-sm border border-gray-300 rounded bg-gray-50"}),(0,n.jsx)("button",{type:"button",onClick:N,disabled:f,className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-amber-500 text-white rounded hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed",children:f?(0,n.jsx)("span",{className:"text-xs",children:"..."}):(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})})]})]})}var o=r(7293);async function i(){let e=(0,o.lx)();if(!e)throw Error("Firebase Functions が利用できません");let t=(0,o.V1)(e,"getCategories");return(await t()).data.categories}async function c(e){let t=(0,o.lx)();if(!t)throw Error("Firebase Functions が利用できません");let r=(0,o.V1)(t,"addCategory");return(await r({name:e})).data.category}async function u(){let e=(0,o.lx)();if(!e)throw Error("Firebase Functions が利用できません");let t=(0,o.V1)(e,"getUnits");return(await t()).data.units}async function d(e){let t=(0,o.lx)();if(!t)throw Error("Firebase Functions が利用できません");let r=(0,o.V1)(t,"addUnit");return(await r({name:e})).data.unit}async function m(e){let t=(0,o.lx)();if(!t)throw Error("Firebase Functions が利用できません");let r=(0,o.V1)(t,"createProduct");return(await r(e)).data.productId}function x(){let{user:e,loading:t}=(0,s.a)(),[r,o]=(0,a.useState)([]),[x,b]=(0,a.useState)([]),[f,h]=(0,a.useState)(!0),[p,g]=(0,a.useState)(null),[y,w]=(0,a.useState)({name:"",category:"",unit:"",price:"",description:""}),[v,N]=(0,a.useState)(!1),[j,E]=(0,a.useState)(null),[C,_]=(0,a.useState)(!1);(0,a.useEffect)(()=>{async function t(){h(!0),g(null);try{let[e,t]=await Promise.all([i(),u()]);o(e),b(t)}catch(e){console.error("データの読み込みに失敗しました:",e),g("データの読み込みに失敗しました。Cloud Functions が未デプロイの可能性があります。")}finally{h(!1)}}e&&t()},[e]);let S=async e=>{try{let t=await c(e);return o(e=>[...e,t]),t}catch(e){throw console.error("カテゴリの追加に失敗しました:",e),e}},k=async e=>{try{let t=await d(e);return b(e=>[...e,t]),t}catch(e){throw console.error("単位の追加に失敗しました:",e),e}},I=async e=>{if(e.preventDefault(),E(null),_(!1),!y.name.trim()){E("商品名を入力してください");return}if(!y.category.trim()){E("カテゴリを選択または入力してください");return}if(!y.unit.trim()){E("単位を選択または入力してください");return}let t=parseFloat(y.price);if(isNaN(t)||t<0){E("有効な価格を入力してください");return}N(!0);try{await m({name:y.name.trim(),category:y.category.trim(),unit:y.unit.trim(),price:t,description:y.description.trim()||void 0}),_(!0),w({name:"",category:"",unit:"",price:"",description:""})}catch(e){console.error("商品登録に失敗しました:",e),E("商品登録に失敗しました。Cloud Functions が未デプロイの可能性があります。")}finally{N(!1)}};return t?(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})}):e?(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-6",children:"商品登録"}),p&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800 text-sm",children:p}),C&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md text-green-800 text-sm",children:"商品を登録しました"}),j&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-800 text-sm",children:j}),(0,n.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"max-w-md",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["商品名",(0,n.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,n.jsx)("input",{type:"text",value:y.name,onChange:e=>w(t=>({...t,name:e.target.value})),placeholder:"例: トマト",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:v})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3 max-w-md",children:[(0,n.jsx)(l,{label:"単位",value:y.unit,options:x,onChange:e=>w(t=>({...t,unit:e})),onAddNew:k,placeholder:"例: 個, kg...",required:!0,disabled:v||f}),(0,n.jsx)(l,{label:"カテゴリ",value:y.category,options:r,onChange:e=>w(t=>({...t,category:e})),onAddNew:S,placeholder:"選択...",required:!0,disabled:v||f})]}),(0,n.jsxs)("div",{className:"max-w-md",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["価格（税込）",(0,n.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"\xa5"}),(0,n.jsx)("input",{type:"number",value:y.price,onChange:e=>w(t=>({...t,price:e.target.value})),placeholder:"0",min:"0",step:"1",className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:v})]})]}),(0,n.jsxs)("div",{className:"max-w-md",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),(0,n.jsx)("textarea",{value:y.description,onChange:e=>w(t=>({...t,description:e.target.value})),placeholder:"商品の説明（任意）",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",disabled:v})]}),(0,n.jsx)("div",{className:"max-w-md",children:(0,n.jsx)("button",{type:"submit",disabled:v||f,className:"w-full px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"登録中...":"商品を登録"})})]})]}):(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)("p",{className:"text-red-600",children:"ログインが必要です"})})}},7293:function(e,t,r){"use strict";r.d(t,{E7:function(){return d},G5:function(){return u},V1:function(){return s.V1},lx:function(){return m}});var n=r(738),a=r(3301),s=r(3491),l=r(257);let o={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID},i=null,c=null;function u(){if(!o.apiKey||!o.projectId)return null;if(!i){let e=(0,n.C6)();i=e.length>0?e[0]:(0,n.ZF)(o)}return i}function d(){let e=u();return e?(c||(c=(0,a.getAuth)(e)),c):null}function m(e){let t=u();return t?(0,s.$C)(t,null!=e?e:"asia-northeast1"):null}},6942:function(e,t,r){"use strict";r.d(t,{a:function(){return l}});var n=r(2265),a=r(3301),s=r(7293);function l(){let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=(0,s.E7)();if(!e){l(!1);return}let r=(0,a.Aj)(e,e=>{t(null!=e?e:null),l(!1)});return()=>r()},[]),{user:e,loading:r,signIn:async(e,t)=>{let r=(0,s.E7)();if(!r)throw Error("Firebase Auth が利用できません");await (0,a.e5)(r,e,t)},signOut:async()=>{let e=(0,s.E7)();e&&await (0,a.w7)(e)}}}}},function(e){e.O(0,[990,322,971,117,744],function(){return e(e.s=915)}),_N_E=e.O()}]);