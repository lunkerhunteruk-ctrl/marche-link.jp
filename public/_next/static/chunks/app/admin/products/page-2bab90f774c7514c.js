(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{5611:function(e,t,r){Promise.resolve().then(r.bind(r,1791))},1791:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var a=r(7437),l=r(2265),n=r(7648),i=r(5978),s=r(7293),c=r(6679),o=r(316),d=r(7168),u=r(8930),m=r(9205);let h=(0,m.Z)("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]),x=(0,m.Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var p=r(4794),f=r(2489),g=r(9397),y=r(3581),b=r(3113),v=r(3465),w=r(3168);function j(e,t){var r,a,l,n,i,s;let c=null!==(i=null===(a=e.createdAt)||void 0===a?void 0:null===(r=a.toMillis)||void 0===r?void 0:r.call(a))&&void 0!==i?i:0;return(null!==(s=null===(n=t.createdAt)||void 0===n?void 0:null===(l=n.toMillis)||void 0===l?void 0:l.call(n))&&void 0!==s?s:0)-c}let k={current:null},N={current:0},C={current:null};function E(){var e,t,r,m;let{storeIds:f,loading:g,newOrderNotificationEnabled:y}=(0,c.dD)(),[b,w]=(0,l.useState)([]),[E,S]=(0,l.useState)(!0),[T,A]=(0,l.useState)(null),L=(0,l.useRef)(!0),[Z,z]=(0,l.useState)(null),[P,D]=(0,l.useState)(new Set),[R,I]=(0,l.useState)(!1),[U,Q]=(0,l.useState)(!1),[B,F]=(0,l.useState)(""),[J,O]=(0,l.useState)(!1),[q,W]=(0,l.useState)(null),V=(0,l.useRef)(null),[H,X]=(0,l.useState)(!1),[_,K]=(0,l.useState)(null),[$,G]=(0,l.useState)(null),[Y,ee]=(0,l.useState)(!1),[et,er]=(0,l.useState)(null),[ea,el]=(0,l.useState)({}),[en,ei]=(0,l.useState)(null),[es,ec]=(0,l.useState)(0),eo=null!==(t=f[0])&&void 0!==t?t:"";(0,l.useEffect)(()=>{ec(0)},[eo]);let ed=(0,l.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=(0,s.T)(),n=eo.trim().toLowerCase();if(!l||!n){L.current&&(w([]),S(!1));return}a&&(k.current=null),C.current&&(clearTimeout(C.current),C.current=null),N.current+=1;let c=N.current,o=(null===(e=k.current)||void 0===e?void 0:e.subdomain)===n?k.current.list:null;!a&&t&&o&&o.length>=0&&L.current?(w(o),S(!1)):L.current&&c===N.current&&(S(!0),A(null));let d=!1;try{let e=await (()=>{let e=(0,i.hJ)(l,"stores",n,"products");return Promise.race([(a?()=>(0,i.zN)(e):()=>(0,i.PL)(e))(),new Promise((e,t)=>{C.current=setTimeout(()=>{C.current=null,t(Error("読み込みがタイムアウトしました"))},18e3)})])})();if(C.current&&(clearTimeout(C.current),C.current=null),c!==N.current||!L.current)return;let t=[];for(let r of e.docs)try{t.push(function(e){var t;let r=e.data(),a="string"==typeof(null==r?void 0:r.imageUrl)?r.imageUrl:null,l=(Array.isArray(null==r?void 0:r.images)?r.images:[]).filter(e=>"string"==typeof e).slice(0,3),n=l.length>0?l:a?[a]:[],i=(null==r?void 0:r.published)!==!1,s="number"==typeof(null==r?void 0:r.stockQuantity)?Math.max(0,r.stockQuantity):0,c=(null==r?void 0:r.stockManuallyEditedAt)&&"function"==typeof r.stockManuallyEditedAt.toDate?r.stockManuallyEditedAt:null;return{id:e.id,title:"string"==typeof(null==r?void 0:r.title)?r.title:"（無題）",imageUrl:null!=a?a:null!==(t=n[0])&&void 0!==t?t:null,images:n,category:"string"==typeof(null==r?void 0:r.category)?r.category:"",price:"number"==typeof(null==r?void 0:r.price)?r.price:0,stockQuantity:s,unit:"string"==typeof(null==r?void 0:r.unit)?r.unit:"",published:i,createdAt:(null==r?void 0:r.createdAt)&&r.createdAt.toDate?r.createdAt:null,stockManuallyEditedAt:c}}(r))}catch(e){}t.sort(j),w(t),k.current={subdomain:n,list:t},A(null),d=!0}catch(t){if(C.current&&(clearTimeout(C.current),C.current=null),!L.current)return;let e=t instanceof Error?t.message:"商品の取得に失敗しました";r>=2?(A(e),w(null!=o?o:[]),S(!1),d=!0):c===N.current&&setTimeout(()=>{L.current&&c===N.current&&ed(!1,r+1)},2e3)}finally{d&&L.current&&c===N.current&&S(!1)}},[eo]);(0,l.useEffect)(()=>(L.current=!0,()=>{L.current=!1}),[]),(0,l.useEffect)(()=>{var e;if(g)return;let t=eo.trim().toLowerCase(),r=(null===(e=k.current)||void 0===e?void 0:e.subdomain)===t;if(t&&!(0,s.T)()&&es<6){let e=setTimeout(()=>ec(e=>e+1),800);return()=>clearTimeout(e)}ed(!!r)},[g,ed,eo,es]);let eu=(0,l.useCallback)(async()=>{let e=(0,s.T)(),t=eo.trim().toLowerCase();if(!e||!t){el({});return}try{let r=(0,i.IO)((0,i.hJ)(e,"stores",t,"orders"),(0,i.ar)("status","==","canceled")),a=await (0,i.PL)(r),l={};for(let e of a.docs){let t=e.data(),r=Array.isArray(null==t?void 0:t.restockedProductIds)?t.restockedProductIds:[];for(let a of Array.isArray(null==t?void 0:t.items)?t.items:[]){let t="string"==typeof(null==a?void 0:a.productId)?a.productId.trim():"",n="number"==typeof(null==a?void 0:a.quantity)?Math.max(0,Math.floor(a.quantity)):0;!t||n<=0||r.includes(t)||(l[t]||(l[t]={totalQty:0,orderEntries:[]}),l[t].totalQty+=n,l[t].orderEntries.push({orderId:e.id,quantity:n}))}}L.current&&el(l)}catch(e){L.current&&el({})}},[eo]);(0,l.useEffect)(()=>{!g&&eo.trim()&&eu()},[g,eo,eu]);let em=(0,l.useCallback)(()=>{A(null),S(!0),ed(!1,0)},[ed]),eh=e=>{null!==Z&&D(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},ex=(0,l.useCallback)((e,t)=>{w(r=>{var a;let l=r.map(r=>r.id===e?t(r):r),n=eo.trim().toLowerCase();return(null===(a=k.current)||void 0===a?void 0:a.subdomain)===n&&(k.current={subdomain:n,list:l}),l}),W(r=>(null==r?void 0:r.id)===e?t(r):r)},[eo]),ep=(0,l.useCallback)(async(e,t)=>{let r=(0,s.T)(),a=eo.trim().toLowerCase();if(r&&a){K(null),X(!0);try{var l;let n=await (0,v.R)(t),s=new FormData;s.append("image",n,"product.jpg"),s.append("subdomain",a);let c=await fetch("/upload-product-image.php",{method:"POST",body:s}),d=await c.json().catch(()=>({}));if(!c.ok)throw Error(d.message||"アップロード失敗 (".concat(c.status,")"));let u=null!==(l=d.url)&&void 0!==l?l:null;if(!u)throw Error("URLが返されませんでした");let m=b.find(t=>t.id===e);if(!m||m.images.length>=3)return;let h=[...m.images,u];await (0,i.r7)((0,i.JU)(r,"stores",a,"products",e),{images:h,imageUrl:h[0]}),ex(e,e=>({...e,images:h,imageUrl:h[0]})),y&&(0,o.i)(a)}catch(e){K(e instanceof Error?e.message:"画像の追加に失敗しました")}finally{X(!1)}}},[eo,b,ex,y]),ef=(0,l.useCallback)(async(e,t)=>{let r=(0,s.T)(),a=eo.trim().toLowerCase();if(!r||!a)return;let l=t.length>0?t[0]:"";await (0,i.r7)((0,i.JU)(r,"stores",a,"products",e),{images:t,imageUrl:l}),ex(e,e=>({...e,images:t,imageUrl:l})),y&&(0,o.i)(a)},[eo,ex,y]),eg=async()=>{let e=(0,s.T)();if(!e||!eo.trim()||0===P.size)return;let t=eo.trim().toLowerCase(),r=Array.from(new Set(b.filter(e=>P.has(e.id)).flatMap(e=>{var t;return((null===(t=e.images)||void 0===t?void 0:t.length)?e.images:e.imageUrl?[e.imageUrl]:[]).filter(e=>"string"==typeof e&&e.length>0)})));I(!0);try{if(r.length>0){let e=new FormData;e.append("subdomain",t),e.append("urls",JSON.stringify(r)),await fetch("/delete-product-images.php",{method:"POST",body:e})}await Promise.all(Array.from(P).map(r=>(0,i.oe)((0,i.JU)(e,"stores",t,"products",r)))),L.current&&(w(e=>{var r;let a=e.filter(e=>!P.has(e.id));return k.current=(null===(r=k.current)||void 0===r?void 0:r.subdomain)===t?{subdomain:t,list:a}:k.current,a}),D(new Set),z(null),y&&(0,o.i)(t))}catch(e){L.current&&A(e instanceof Error?e.message:"削除に失敗しました")}finally{L.current&&I(!1)}},ey=(0,l.useCallback)(async(e,t,r)=>{let a=(0,s.T)();if(!a||!eo.trim())return;Q(!0);let l=eo.trim().toLowerCase();try{await (0,i.r7)((0,i.JU)(a,"stores",l,"products",e),{published:t}),L.current&&(w(r=>{var a;let n=r.map(r=>r.id===e?{...r,published:t}:r);return(null===(a=k.current)||void 0===a?void 0:a.subdomain)===l&&(k.current={subdomain:l,list:n}),n}),W(r=>(null==r?void 0:r.id)===e?{...r,published:t}:r),y&&(0,o.i)(l),t&&(G("".concat(null!=r?r:"商品","をストアに公開しました。")),ee(!1),setTimeout(()=>{L.current&&ee(!0)},1500),setTimeout(()=>{L.current&&(G(null),ee(!1))},2e3)))}catch(e){L.current&&A(e instanceof Error?e.message:"公開状態の更新に失敗しました")}finally{L.current&&Q(!1)}},[eo,y]),eb=(0,l.useCallback)(async(e,t)=>{let r=(0,s.T)();if(!r||!eo.trim()||0===Object.keys(t).length)return;let a=eo.trim().toLowerCase(),l="stockQuantity"in t,n=l?{...t,stockManuallyEditedAt:(0,i.Bt)()}:t;try{if(await (0,i.r7)((0,i.JU)(r,"stores",a,"products",e),n),L.current){let r=l?{...t,stockManuallyEditedAt:i.EK.now()}:t;w(t=>{var l;let n=t.map(t=>t.id===e?{...t,...r}:t);return(null===(l=k.current)||void 0===l?void 0:l.subdomain)===a&&(k.current={subdomain:a,list:n}),n}),W(t=>(null==t?void 0:t.id)===e&&t?{...t,...r}:t),y&&(0,o.i)(a)}}catch(e){L.current&&A(e instanceof Error?e.message:"更新に失敗しました")}},[eo,y]),ev=(0,l.useCallback)(async(e,t)=>{let r=(0,s.T)();if(!r||!eo.trim()||0===e.size)return;Q(!0);let a=eo.trim().toLowerCase();try{await Promise.all(Array.from(e).map(e=>(0,i.r7)((0,i.JU)(r,"stores",a,"products",e),{published:t}))),L.current&&(w(r=>{var l;let n=r.map(r=>e.has(r.id)?{...r,published:t}:r);return(null===(l=k.current)||void 0===l?void 0:l.subdomain)===a&&(k.current={subdomain:a,list:n}),n}),W(r=>r&&e.has(r.id)?{...r,published:t}:r),D(new Set),z(null),y&&(0,o.i)(a))}catch(e){L.current&&A(e instanceof Error?e.message:"公開状態の更新に失敗しました")}finally{L.current&&Q(!1)}},[eo,y]),ew=(0,l.useCallback)(async e=>{let t=ea[e];if(!t||t.totalQty<=0)return;let r=(0,s.T)(),a=eo.trim().toLowerCase();if(r&&a){ei(e);try{var l;let n=(0,i.JU)(r,"stores",a,"products",e),s=b.find(t=>t.id===e),c=(null!==(l=null==s?void 0:s.stockQuantity)&&void 0!==l?l:0)+t.totalQty;await (0,i.r7)(n,{stockQuantity:c}),await Promise.all(t.orderEntries.map(t=>{let{orderId:l}=t;return(0,i.r7)((0,i.JU)(r,"stores",a,"orders",l),{restockedProductIds:(0,i.vr)(e)})})),L.current&&(ex(e,e=>({...e,stockQuantity:c})),el(t=>{let r={...t};return delete r[e],r}),y&&(0,o.i)(a))}catch(e){L.current&&A(e instanceof Error?e.message:"補充に失敗しました")}finally{L.current&&ei(null)}}},[eo,ea,b,ex,y]),ej=(0,l.useCallback)(async(e,t)=>{let r=(0,s.T)();if(!r||!eo.trim()||0===e.size)return;O(!0);let a=eo.trim().toLowerCase(),l=Math.max(0,Math.floor(t));try{let t=(0,i.Bt)();if(await Promise.all(Array.from(e).map(e=>(0,i.r7)((0,i.JU)(r,"stores",a,"products",e),{stockQuantity:l,stockManuallyEditedAt:t}))),L.current){let t=i.EK.now();w(r=>{var n;let i=r.map(r=>e.has(r.id)?{...r,stockQuantity:l,stockManuallyEditedAt:t}:r);return(null===(n=k.current)||void 0===n?void 0:n.subdomain)===a&&(k.current={subdomain:a,list:i}),i}),W(r=>r&&e.has(r.id)?{...r,stockQuantity:l,stockManuallyEditedAt:t}:r),F(""),D(new Set),z(null),y&&(0,o.i)(a)}}catch(e){L.current&&A(e instanceof Error?e.message:"在庫数量の更新に失敗しました")}finally{L.current&&O(!1)}},[eo,y]);if((0,l.useEffect)(()=>{P.size>0&&er(null)},[P.size]),g)return(0,a.jsx)("div",{className:"py-8 text-center text-gray-500",children:"読み込み中..."});if(!eo)return(0,a.jsxs)("div",{className:"py-8",children:[(0,a.jsx)("p",{className:"text-gray-600 text-center mb-4",children:"ショップが登録されていません。"}),(0,a.jsxs)("p",{className:"text-center",children:[(0,a.jsx)(n.default,{href:"/admin/register",className:"text-[var(--admin-accent)] underline",children:"新規ショップ登録"}),"を完了すると商品を管理できます。"]})]});if(T)return(0,a.jsxs)("div",{className:"py-8",children:[(0,a.jsx)("p",{className:"text-red-600 text-center mb-4",children:T}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-3",children:(0,a.jsxs)("button",{type:"button",onClick:em,disabled:E,className:"flex items-center gap-2 min-h-touch rounded-xl bg-[var(--admin-accent)] px-5 py-3 text-sm font-medium text-white active:opacity-90 disabled:opacity-60","aria-label":"商品を再読み込み",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 ".concat(E?"animate-spin":"")}),E?"読み込み中…":"再読み込み"]})})]});if(E&&0===b.length)return(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"商品を読み込み中..."}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-3",children:(0,a.jsxs)("button",{type:"button",onClick:em,disabled:E,className:"inline-flex items-center gap-2 min-h-touch rounded-xl bg-[var(--admin-accent)] px-5 py-3 text-sm font-medium text-white active:opacity-90 disabled:opacity-60","aria-label":"商品を再読み込み",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 ".concat(E?"animate-spin":"")}),E?"読み込み中…":"再試行"]})})]});let ek=()=>{D(new Set),z(null),F(""),er(null)},eN=et&&!("undefined"!=typeof navigator&&/Line\//i.test(navigator.userAgent)),eC=et&&null!==(r=({delete:"商品を一括で削除できます。",stock:"在庫数量を一括で変更できます。",publish:"商品を一括公開・非公開にできます。"})[et])&&void 0!==r?r:"";return(0,a.jsxs)("div",{className:"py-4 pb-32",children:[(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-4 min-h-touch",children:[null!==Z&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mr-auto shrink-0",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{D(new Set(b.map(e=>e.id)))},className:"min-h-touch shrink-0 py-2 px-4 text-sm font-medium text-[var(--admin-accent)] bg-[var(--admin-accent)]/10 rounded-full border border-[var(--admin-accent)]/30 active:bg-[var(--admin-accent)]/20 whitespace-nowrap",children:"全選択"}),(0,a.jsx)("button",{type:"button",onClick:()=>{D(new Set)},className:"min-h-touch shrink-0 py-2 px-4 text-sm font-medium text-gray-600 bg-gray-100 rounded-full border border-gray-200 active:bg-gray-200 whitespace-nowrap",children:"解除"}),(0,a.jsx)("button",{type:"button",onClick:ek,className:"min-h-touch shrink-0 py-2 px-4 text-sm font-medium text-gray-600 bg-white rounded-full border border-gray-300 active:bg-gray-50 whitespace-nowrap",children:"キャンセル"})]}),(0,a.jsxs)("div",{className:"relative flex items-center gap-2 shrink-0",children:[eN&&eC&&(0,a.jsx)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 rounded-xl bg-gray-900 text-white text-sm shadow-lg z-50 max-w-[85vw] text-center md:hidden",role:"tooltip",children:eC}),(0,a.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),"delete"!==Z&&(z("delete"),D(new Set)),er("delete")},className:"p-2.5 rounded-full min-h-touch min-w-touch md:min-w-0 md:px-4 flex items-center justify-center gap-2 shrink-0 ".concat("delete"===Z?"bg-[var(--admin-accent)]/15 text-[var(--admin-accent)]":"text-gray-500 hover:bg-gray-100"),"aria-pressed":"delete"===Z,title:"delete"===Z?"選択した商品を削除":"削除モード（タップで選択）",children:[(0,a.jsx)(u.Z,{className:"h-7 w-7 shrink-0","aria-hidden":!0}),(0,a.jsx)("span",{className:"hidden md:inline text-sm font-medium whitespace-nowrap",children:"一括削除"})]}),(0,a.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),"stock"!==Z&&(z("stock"),D(new Set),F("")),er("stock")},className:"p-2.5 rounded-full min-h-touch min-w-touch md:min-w-0 md:px-4 flex items-center justify-center gap-2 shrink-0 ".concat("stock"===Z?"bg-[var(--admin-accent)]/15 text-[var(--admin-accent)]":"text-gray-500 hover:bg-gray-100"),"aria-pressed":"stock"===Z,title:"stock"===Z?"商品をタップして選択し、下のモーダルで在庫数を入力":"在庫数量の一括更新（タップで選択モード）","aria-label":"在庫数量の一括更新",children:[(0,a.jsx)(h,{className:"h-7 w-7 shrink-0","aria-hidden":!0}),(0,a.jsx)("span",{className:"hidden md:inline text-sm font-medium whitespace-nowrap",children:"在庫一括変更"})]}),(0,a.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),"publish"!==Z&&(z("publish"),D(new Set)),er("publish")},className:"p-2.5 rounded-full min-h-touch min-w-touch md:min-w-0 md:px-4 flex items-center justify-center gap-2 shrink-0 ".concat("publish"===Z?"bg-[var(--admin-accent)]/15 text-[var(--admin-accent)]":"text-gray-500 hover:bg-gray-100"),"aria-pressed":"publish"===Z,title:"publish"===Z?"選択した商品の公開設定":"公開・非公開の一括変更（タップで選択）",children:[(0,a.jsx)(x,{className:"h-7 w-7 shrink-0","aria-hidden":!0}),(0,a.jsx)("span",{className:"hidden md:inline text-sm font-medium whitespace-nowrap",children:"一括公開・非公開"})]})]})]}),E&&b.length>0&&(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:"更新中..."}),0===b.length?(0,a.jsxs)("div",{className:"rounded-2xl border-2 border-dashed border-gray-200 bg-white p-8 text-center",children:[(0,a.jsx)(p.Z,{className:"mx-auto h-12 w-12 text-gray-300","aria-hidden":!0}),(0,a.jsx)("p",{className:"mt-3 text-gray-500",children:"まだ商品がありません"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-400",children:[(0,a.jsx)(n.default,{href:"/admin/products/quick",className:"text-[var(--admin-accent)] underline",children:"商品登録"}),"から追加してください。"]})]}):(0,a.jsx)("ul",{className:"grid grid-cols-3 gap-3",children:b.map(e=>{var t;let r=P.has(e.id),l=null!==Z,n=l&&r?"border-[var(--admin-accent)] bg-[var(--admin-accent)]/10 ring-2 ring-[var(--admin-accent)]":e.published?"border-gray-200 bg-white":"border-2 border-gray-300 bg-gray-50/80",i=ea[e.id],s=null!==(t=null==i?void 0:i.totalQty)&&void 0!==t?t:0,c=s>0&&!e.stockManuallyEditedAt,o=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-full min-w-0",children:(0,a.jsxs)("div",{className:"relative aspect-square w-full min-w-0 overflow-hidden rounded-xl bg-gray-100",children:[e.imageUrl?(0,a.jsx)("img",{src:e.imageUrl,alt:e.title,className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center text-gray-400",children:(0,a.jsx)(p.Z,{className:"h-8 w-8"})}),c&&(0,a.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),ew(e.id)},disabled:en===e.id,className:"absolute left-0 right-0 top-0 z-10 flex items-center justify-center rounded-t-xl bg-amber-500/95 px-1.5 py-1 text-[10px] font-medium text-white active:bg-amber-600 disabled:opacity-60",title:"キャンセル個数".concat(s,"個を在庫に戻す"),children:en===e.id?"補充中…":"キャンセル".concat(s,"個補充")})]})}),(0,a.jsxs)("div",{className:"min-w-0 p-1.5 text-center",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900 truncate",title:e.title,children:e.title}),(0,a.jsxs)("p",{className:"text-[10px] text-gray-600 truncate",children:["\xa5",e.price.toLocaleString()," / 数量",e.stockQuantity]})]}),!e.published&&(0,a.jsx)("span",{className:"absolute top-1 left-1 rounded bg-gray-500 px-1.5 py-0.5 text-[10px] font-medium text-white","aria-hidden":!0,children:"下書き"}),l&&r&&(0,a.jsx)("span",{className:"absolute top-1 right-1 flex items-center justify-center rounded-full w-5 h-5 bg-[var(--admin-accent)] text-white text-xs font-bold","aria-hidden":!0,children:"✓"})]});return(0,a.jsx)("li",{className:"relative",children:l?(0,a.jsx)("button",{type:"button",onClick:()=>eh(e.id),className:"relative w-full flex flex-col rounded-2xl border shadow-sm text-left transition-colors hover:bg-gray-50 overflow-hidden ".concat(n),children:o}):(0,a.jsx)("button",{type:"button",onClick:()=>W(e),className:"relative w-full flex flex-col rounded-2xl border shadow-sm text-left transition-colors hover:bg-gray-50 overflow-hidden ".concat(n),children:o})},e.id)})}),"delete"===Z&&P.size>0&&(0,a.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-[60] flex justify-center px-4 pt-2 pb-[max(7rem,calc(5rem+env(safe-area-inset-bottom)))] bg-gradient-to-t from-black/30 to-transparent pointer-events-none","aria-hidden":!0,children:(0,a.jsxs)("div",{className:"w-full max-w-xs rounded-2xl bg-white shadow-lg border border-gray-200 p-4 pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:[(0,a.jsxs)("h3",{id:"delete-dialog-title",className:"text-sm font-semibold text-gray-800",children:["削除（",P.size," 件）"]}),(0,a.jsx)("p",{className:"mt-1.5 text-xs text-gray-600",children:"取り消せません。"}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:ek,disabled:R,className:"flex-1 min-h-touch py-2 rounded-xl border border-gray-300 text-gray-700 text-sm font-medium",children:"キャンセル"}),(0,a.jsx)("button",{type:"button",onClick:eg,disabled:R,className:"flex-1 min-h-touch py-2 rounded-xl bg-[var(--admin-accent)] text-white text-sm font-medium disabled:opacity-50",children:R?"削除中...":"削除する"})]})]})}),"publish"===Z&&P.size>0&&(0,a.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-[60] flex justify-center px-4 pt-2 pb-[max(7rem,calc(5rem+env(safe-area-inset-bottom)))] bg-gradient-to-t from-black/30 to-transparent pointer-events-none","aria-hidden":!0,children:(0,a.jsxs)("div",{className:"w-full max-w-xs rounded-2xl bg-white shadow-lg border border-gray-200 p-4 pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"publish-dialog-title",children:[(0,a.jsxs)("h3",{id:"publish-dialog-title",className:"text-sm font-semibold text-gray-800",children:["公開状態（",P.size," 件）"]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ev(P,!0),disabled:U,className:"w-full min-h-touch py-2 rounded-xl bg-[var(--admin-accent)] text-white text-sm font-medium disabled:opacity-50",children:U?"更新中...":"公開する"}),(0,a.jsx)("button",{type:"button",onClick:()=>ev(P,!1),disabled:U,className:"w-full min-h-touch py-2 rounded-xl border border-gray-300 text-gray-700 text-sm font-medium disabled:opacity-50",children:"下書きにする"}),(0,a.jsx)("button",{type:"button",onClick:ek,disabled:U,className:"w-full min-h-touch py-2 rounded-xl text-gray-500 text-sm",children:"キャンセル"})]})]})}),"stock"===Z&&P.size>0&&(0,a.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-[60] flex justify-center px-4 pt-2 pb-[max(7rem,calc(5rem+env(safe-area-inset-bottom)))] bg-gradient-to-t from-black/30 to-transparent pointer-events-none","aria-hidden":!0,children:(0,a.jsxs)("div",{className:"w-full max-w-xs rounded-2xl bg-white shadow-lg border border-gray-200 p-4 pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"bulk-stock-title",children:[(0,a.jsxs)("h3",{id:"bulk-stock-title",className:"text-sm font-semibold text-gray-800",children:["在庫数量（",P.size," 件）"]}),(0,a.jsxs)("div",{className:"mt-3 flex min-w-0 items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"bulk-stock-input",className:"text-sm text-gray-600 shrink-0",children:"在庫数量："}),(0,a.jsx)("input",{id:"bulk-stock-input",type:"number",min:0,step:1,inputMode:"numeric",value:B,onChange:e=>F(e.target.value),placeholder:"0",className:"min-w-0 flex-1 rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)]"})]}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:ek,disabled:J,className:"flex-1 min-h-touch py-2 rounded-xl border border-gray-300 text-gray-700 text-sm font-medium",children:"キャンセル"}),(0,a.jsx)("button",{type:"button",onClick:()=>{ej(P,Math.max(0,Math.floor(parseInt(B,10)||0)))},disabled:J,className:"flex-1 min-h-touch py-2 rounded-xl bg-[var(--admin-accent)] text-white text-sm font-medium disabled:opacity-50",children:J?"更新中...":"OK"})]})]})}),q&&(0,a.jsx)(M,{product:q,canceledQty:null!==(m=null===(e=ea[q.id])||void 0===e?void 0:e.totalQty)&&void 0!==m?m:0,showRestockButton:!q.stockManuallyEditedAt,restocking:en===q.id,onRestockCanceled:()=>ew(q.id),onClose:()=>{W(null),K(null)},onUpdateProduct:e=>eb(q.id,e),onAddImage:e=>ep(q.id,e),onReorderImages:e=>ef(q.id,e),onSetPublish:e=>ey(q.id,e,q.title),updatingPublish:U,addImageInputRef:V,addImageUploading:H,addImageError:_}),$&&(0,a.jsx)("div",{className:"fixed bottom-24 left-1/2 z-[55] -translate-x-1/2 rounded-full bg-gray-800 px-5 py-2.5 text-sm font-medium text-white shadow-lg transition-opacity duration-300 ".concat(Y?"opacity-0":"opacity-100"),role:"status","aria-live":"polite",children:$})]})}function M(e){let{product:t,canceledQty:r,showRestockButton:n,restocking:i,onRestockCanceled:s,onClose:c,onUpdateProduct:o,onAddImage:d,onReorderImages:u,onSetPublish:m,updatingPublish:h,addImageInputRef:x,addImageUploading:v,addImageError:j}=e,[k,N]=(0,l.useState)(0),[C,E]=(0,l.useState)(null),[M,S]=(0,l.useState)(!1),[T,A]=(0,l.useState)(!1),[L,Z]=(0,l.useState)(null),[z,P]=(0,l.useState)(t.title),[D,R]=(0,l.useState)(String(t.price)),[I,U]=(0,l.useState)(String(t.stockQuantity)),[Q,B]=(0,l.useState)(t.unit),[F,J]=(0,l.useState)(t.category),O=(0,l.useRef)(null),q=(0,l.useRef)(null),W=(0,l.useRef)(null),V=(0,l.useRef)(null),H=(0,l.useRef)(null),X=(0,l.useRef)(null),_=(0,l.useRef)(!1),K=(0,l.useRef)(null),$=(0,l.useRef)(null),[G,Y]=(0,l.useState)(null),ee=t.images,et=ee.length<3;(0,l.useEffect)(()=>{P(t.title),R(String(t.price)),U(String(t.stockQuantity)),B(t.unit),J(t.category)},[t.id,t.title,t.price,t.stockQuantity,t.unit,t.category]),(0,l.useEffect)(()=>{N(e=>e<ee.length?e:0)},[ee.length]);let er=(0,l.useCallback)(()=>{var e;null===(e=q.current)||void 0===e||e.getTracks().forEach(e=>e.stop()),q.current=null,A(!1),Z(null)},[]),ea=(0,l.useCallback)(async()=>{Z(null);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:1280}},audio:!1});q.current=e,A(!0)}catch(e){Z(e instanceof Error?e.message:"カメラを起動できませんでした"),A(!1)}},[]);(0,l.useEffect)(()=>{if(!T||!q.current)return;let e=O.current;if(e)return e.srcObject=q.current,e.play().catch(()=>{}),()=>{e.srcObject=null}},[T]),(0,l.useEffect)(()=>()=>{var e;null===(e=q.current)||void 0===e||e.getTracks().forEach(e=>e.stop()),q.current=null},[]);let el=(0,l.useCallback)(()=>{let e=O.current;e&&q.current&&!(e.readyState<2)&&new Promise((t,r)=>{let a=Math.min(e.videoWidth,e.videoHeight),l=(e.videoWidth-a)/2,n=(e.videoHeight-a)/2,i=document.createElement("canvas");i.width=a,i.height=a;let s=i.getContext("2d");if(!s){r(Error("Canvas not available"));return}s.drawImage(e,l,n,a,a,0,0,a,a),i.toBlob(e=>{e?t(e):r(Error("Failed to create blob"))},"image/jpeg",.9)}).then(e=>{let t=new File([e],"capture.jpg",{type:"image/jpeg"});er(),d(t)}).catch(()=>Z("撮影に失敗しました"))},[er,d]),en=(e,t)=>{if(_.current){e.preventDefault();return}if(E(t),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))),"undefined"!=typeof document&&e.dataTransfer){let t=document.createElement("div");t.style.width="1px",t.style.height="1px",t.style.opacity="0",t.style.pointerEvents="none",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t),W.current=t,e.dataTransfer.setDragImage(t,0,0)}},ei=(0,l.useCallback)(e=>{let t=K.current;if(!t)return 0;let r=Array.from(t.children).filter(e=>e.hasAttribute("data-drag-index")).sort((e,t)=>{var r,a;return parseInt(null!==(r=e.getAttribute("data-drag-index"))&&void 0!==r?r:"0",10)-parseInt(null!==(a=t.getAttribute("data-drag-index"))&&void 0!==a?a:"0",10)});if(0===r.length)return 0;for(let t=0;t<r.length;t++){let a=r[t].getBoundingClientRect();if(e<a.left+a.width/2)return t}return r.length},[]),es=e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move");let t=ei(e.clientX);$.current!==t&&($.current=t,Y(t))},ec=e=>{var t;e.preventDefault();let r=null!=C?C:e.dataTransfer.getData("text/plain")?parseInt(e.dataTransfer.getData("text/plain"),10):null,a=null!==(t=$.current)&&void 0!==t?t:0;if(null===r||r===a||Number.isNaN(r)){E(null),Y(null),$.current=null;return}let l=[...ee],[n]=l.splice(r,1);l.splice(r<a?a-1:a,0,n),u(l),E(null),Y(null),$.current=null},eo=()=>{var e;null===(e=W.current)||void 0===e||e.remove(),W.current=null,E(null),Y(null),$.current=null},ed=(e,t)=>{V.current=window.setTimeout(()=>{V.current=null,_.current=!0,H.current=t,E(t)},400)},eu=e=>{if(null!==H.current&&e.changedTouches[0]){e.preventDefault();let t=e.changedTouches[0];X.current={x:t.clientX,y:t.clientY};let r=ei(t.clientX);$.current!==r&&($.current=r,Y(r))}},em=e=>{V.current&&(clearTimeout(V.current),V.current=null);let t=H.current,r=$.current;if(null===t){E(null),Y(null),$.current=null,_.current=!1;return}if(null!==r&&!Number.isNaN(r)&&r!==t){let e=[...ee],[a]=e.splice(t,1);e.splice(t<r?r-1:r,0,a),u(e)}H.current=null,X.current=null,$.current=null,Y(null),_.current=!1,E(null)},eh=()=>{V.current&&(clearTimeout(V.current),V.current=null),H.current=null,X.current=null,$.current=null,Y(null),_.current=!1,E(null)};return(0,l.useEffect)(()=>{if(null===C)return;let e=e=>{null!==H.current&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>document.removeEventListener("touchmove",e)},[C]),(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col bg-white",role:"dialog","aria-modal":"true","aria-labelledby":"product-detail-title",children:[(0,a.jsx)("div",{className:"shrink-0 px-4 py-3",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-md items-center justify-between rounded-full bg-gray-100 px-4 py-3 shadow-sm",children:[(0,a.jsx)("h2",{id:"product-detail-title",className:"text-lg font-semibold text-gray-900",children:"商品詳細"}),(0,a.jsx)("button",{type:"button",onClick:c,className:"flex min-h-touch min-w-touch shrink-0 items-center justify-center rounded-full text-gray-500 active:bg-gray-200 active:text-gray-700","aria-label":"商品詳細を閉じる",children:(0,a.jsx)(f.Z,{className:"h-6 w-6","aria-hidden":!0})})]})}),(0,a.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(0,a.jsxs)("div",{className:"pb-28",children:[(0,a.jsx)("div",{className:"w-full max-w-md mx-auto px-4",children:(0,a.jsx)("div",{className:"relative aspect-square w-full min-w-0 bg-gray-100 rounded-xl overflow-hidden",children:ee[k]?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:ee[k],alt:t.title,className:"w-full h-full object-cover"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=ee.filter((e,t)=>t!==k);u(e),N(Math.min(k,Math.max(0,e.length-1)))},className:"absolute bottom-2 right-2 z-10 flex h-9 w-9 items-center justify-center rounded-full bg-white text-gray-500 shadow-md","aria-label":"画像を削除",children:(0,a.jsx)(f.Z,{className:"h-5 w-5"})})]}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:(0,a.jsx)(p.Z,{className:"h-16 w-16"})})})}),(0,a.jsxs)("div",{className:"px-4 mt-2 flex items-center gap-3",children:[(0,a.jsx)("input",{ref:x,type:"file",accept:"image/*",multiple:!0,onChange:e=>{var t;let r=Array.from(null!==(t=e.target.files)&&void 0!==t?t:[]).filter(e=>e.type.startsWith("image/")),a=Math.min(2,3-ee.length);r.slice(0,a).forEach(e=>d(e)),e.target.value=""},className:"hidden","aria-hidden":!0}),(0,a.jsxs)("div",{ref:K,className:"flex flex-1 min-w-0 items-center gap-2 overflow-x-auto",children:[ee.map((e,r)=>(0,a.jsxs)(l.Fragment,{children:[null!==C&&G===r&&(0,a.jsx)("div",{className:"w-0.5 h-20 flex-shrink-0 self-center rounded-full bg-[var(--admin-accent)]","aria-hidden":!0}),(0,a.jsx)("div",{"data-drag-index":r,draggable:!0,onDragStart:e=>en(e,r),onDragOver:es,onDrop:ec,onDragEnd:eo,onTouchStart:e=>ed(e,r),onTouchMove:eu,onTouchEnd:em,onTouchCancel:eh,className:"shrink-0 w-20 h-20 rounded-xl border-2 overflow-hidden bg-gray-100 touch-none select-none ".concat(C===r?"border-[var(--admin-accent)] opacity-70":"border-gray-200"),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none"},onContextMenu:e=>e.preventDefault(),children:(0,a.jsx)("button",{type:"button",onClick:()=>N(r),className:"w-full h-full block ".concat(k===r?"ring-2 ring-[var(--admin-accent)] ring-inset":""),children:(0,a.jsx)("img",{src:e,alt:"".concat(t.title," ").concat(r+1,"枚目"),className:"w-full h-full object-cover",draggable:!1})})})]},r)),null!==C&&G===ee.length&&(0,a.jsx)("div",{className:"w-0.5 h-20 flex-shrink-0 self-center rounded-full bg-[var(--admin-accent)]","aria-hidden":!0}),et&&!T&&(0,a.jsx)("button",{type:"button",onClick:()=>S(e=>!e),disabled:v,className:"shrink-0 flex h-20 w-20 items-center justify-center rounded-xl border-2 border-dashed border-gray-300 text-gray-400 hover:border-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"画像を追加",children:(0,a.jsx)(g.Z,{className:"h-8 w-8"})})]}),r>0&&n&&(0,a.jsx)("div",{className:"shrink-0 flex flex-col justify-center",children:(0,a.jsx)("button",{type:"button",onClick:s,disabled:i,className:"min-h-touch rounded-xl bg-amber-500 px-3 py-2.5 text-xs font-medium text-white active:bg-amber-600 disabled:opacity-60 whitespace-nowrap shadow-md",title:"キャンセル分".concat(r,"個を在庫に戻す"),children:i?"補充中…":"キャンセル分".concat(r,"個補充する")})}),M&&et&&!T&&(0,a.jsxs)("div",{className:"mt-2 w-max min-w-[220px] max-w-[min(100%,320px)] overflow-hidden rounded-2xl border border-gray-200/80 bg-white py-1.5 shadow-xl",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{S(!1),ea()},disabled:v,className:"flex w-full min-w-0 items-center gap-3 px-4 py-3 text-left text-gray-800 active:bg-gray-100 disabled:opacity-50",children:[(0,a.jsx)(y.Z,{className:"h-5 w-5 shrink-0 text-gray-500"}),(0,a.jsx)("span",{className:"truncate",children:"写真を撮る"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{var e;S(!1),null===(e=x.current)||void 0===e||e.click()},disabled:v,className:"flex w-full min-w-0 items-center gap-3 px-4 py-3 text-left text-gray-800 active:bg-gray-100 disabled:opacity-50",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5 shrink-0 text-gray-500"}),(0,a.jsx)("span",{className:"truncate",children:"アルバム・ファイルから選ぶ"})]})]}),j&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:j})]}),(0,a.jsxs)("div",{className:"px-4 mt-4 space-y-3",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"商品名"}),(0,a.jsx)("input",{type:"text",inputMode:"text",lang:"ja",autoComplete:"off",value:z,onChange:e=>P(e.target.value),onBlur:()=>{let e=z.trim();e!==t.title&&o({title:e})},placeholder:"（無題）",className:"mt-0.5 block w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-xl font-semibold text-gray-900 placeholder:text-gray-400 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)]",list:"product-detail-name-list"}),(0,a.jsx)("datalist",{id:"product-detail-name-list",children:w.HR.map(e=>(0,a.jsx)("option",{value:e},e))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 items-end",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"値段（円）"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",autoComplete:"off",value:D,onChange:e=>R(e.target.value.replace(/\D/g,"")),onBlur:()=>{let e=Math.max(0,Math.floor(parseInt(D,10)||0));e!==t.price&&o({price:e}),R(String(e))},className:"mt-0.5 block w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-gray-800 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)]"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"在庫数量"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",autoComplete:"off",value:I,onChange:e=>U(e.target.value.replace(/\D/g,"")),onBlur:()=>{let e=Math.max(0,Math.floor(parseInt(I,10)||0));e!==t.stockQuantity&&o({stockQuantity:e}),U(String(e))},className:"mt-0.5 block w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-gray-800 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)]"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"単位"}),(0,a.jsx)("input",{type:"text",inputMode:"text",lang:"ja",autoComplete:"off",value:Q,onChange:e=>B(e.target.value),onBlur:()=>{let e=Q.trim();e!==t.unit&&o({unit:e})},placeholder:"個",className:"mt-0.5 block w-full min-w-0 rounded-xl border border-gray-300 bg-white px-3 py-2 text-gray-800 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)] placeholder:text-gray-400",list:"product-detail-unit-list"}),(0,a.jsx)("datalist",{id:"product-detail-unit-list",children:w.X0.map(e=>(0,a.jsx)("option",{value:e},e))})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"カテゴリ"}),(0,a.jsx)("input",{type:"text",inputMode:"text",lang:"ja",autoComplete:"off",value:F,onChange:e=>J(e.target.value),onBlur:()=>{let e=F.trim();e!==t.category&&o({category:e})},placeholder:"パン",className:"mt-0.5 block w-full min-w-0 rounded-xl border border-gray-300 bg-white px-3 py-2 text-gray-800 focus:border-[var(--admin-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--admin-accent)] placeholder:text-gray-400",list:"product-detail-category-list"}),(0,a.jsx)("datalist",{id:"product-detail-category-list",children:w.ST.map(e=>(0,a.jsx)("option",{value:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"px-4 mt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"公開設定"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>m(!0),disabled:h,className:"flex-1 py-2.5 rounded-xl bg-[var(--admin-accent)] text-white text-sm font-medium disabled:opacity-50 disabled:pointer-events-none",children:h?"更新中...":"公開する"}),(0,a.jsx)("button",{type:"button",onClick:()=>m(!1),disabled:h||!t.published,className:"flex-1 py-2.5 rounded-xl border border-gray-300 bg-white text-gray-700 text-sm font-medium disabled:opacity-50 disabled:pointer-events-none",children:"下書きにする"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:t.published?"公開中":"下書き"})]}),T&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[55] flex flex-col bg-black",children:[(0,a.jsx)("button",{type:"button",onClick:er,className:"absolute top-4 right-4 z-10 flex min-h-touch min-w-touch items-center justify-center rounded-full bg-black/50 text-white","aria-label":"キャンセル",children:(0,a.jsx)(f.Z,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center min-h-0 bg-black",children:[(0,a.jsx)("div",{className:"relative w-full max-w-md aspect-square mx-auto bg-black overflow-hidden",children:(0,a.jsx)("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover object-center"})}),L&&(0,a.jsx)("p",{className:"mt-2 px-4 text-sm text-amber-400",role:"alert",children:L}),(0,a.jsx)("div",{className:"mt-4 pb-8",children:(0,a.jsx)("button",{type:"button",onClick:el,className:"flex min-h-[56px] min-w-[56px] items-center justify-center rounded-full border-4 border-white bg-white/90 shadow-lg active:scale-95","aria-label":"撮影",children:(0,a.jsx)("span",{className:"h-10 w-10 rounded-full bg-gray-800"})})})]})]})]})})]})}},3168:function(e,t,r){"use strict";r.d(t,{HR:function(){return a},ST:function(){return n},X0:function(){return l}});let a=["クロワッサン","メロンパン","アップルパイ","食パン","カレーパン","惣菜パン","飲み物"],l=["個","本","束","ケース","箱","袋","パック"],n=["パン","飲み物","惣菜","その他"]},316:function(e,t,r){"use strict";r.d(t,{S:function(){return n},i:function(){return i}});var a=r(5978),l=r(7293);let n="marche-link:new-orders";async function i(e){let t=(0,l.T)(),r=null==e?void 0:e.trim().toLowerCase();if(t&&r)try{let e=(0,a.IO)((0,a.hJ)(t,"stores",r,"orders"),(0,a.ar)("status","==","unpaid"),(0,a.b9)(100)),l=(await (0,a.PL)(e)).size;l>0&&window.dispatchEvent(new CustomEvent(n,{detail:{count:l}}))}catch(e){}}},3465:function(e,t,r){"use strict";function a(e){return new Promise((t,r)=>{let a="string"==typeof e&&e.startsWith("data:"),l=e=>{let a=new Image;a.onload=()=>{let e=document.createElement("canvas");e.width=1e3,e.height=1e3;let l=e.getContext("2d");if(!l){r(Error("Canvas context not available"));return}let n=Math.max(1e3/a.width,1e3/a.height),i=a.width,s=a.height;l.drawImage(a,(i-1e3/n)/2,(s-1e3/n)/2,1e3/n,1e3/n,0,0,1e3,1e3),e.toBlob(e=>{e?t(e):r(Error("Failed to create blob"))},"image/jpeg",.9)},a.onerror=()=>r(Error("Failed to load image")),a.src=e};a?l(e):new Promise((t,r)=>{let a=new FileReader;a.onload=()=>{let e=a.result;"string"==typeof e&&e.startsWith("data:")?t(e):r(Error("Failed to read file as data URL"))},a.onerror=()=>r(Error("Failed to load image")),a.readAsDataURL(e)}).then(l).catch(r)})}r.d(t,{R:function(){return a}})},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var a=r(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:l=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:o="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...i,width:l,height:l,stroke:r,strokeWidth:c?24*Number(s)/Number(l):s,className:n("lucide",o),...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let r=(0,a.forwardRef)((r,i)=>{let{className:c,...o}=r;return(0,a.createElement)(s,{ref:i,iconNode:t,className:n("lucide-".concat(l(e)),c),...o})});return r.displayName="".concat(e),r}},3581:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},3113:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},4794:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},9397:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7168:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8930:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[358,990,249,648,679,971,117,744],function(){return e(e.s=5611)}),_N_E=e.O()}]);