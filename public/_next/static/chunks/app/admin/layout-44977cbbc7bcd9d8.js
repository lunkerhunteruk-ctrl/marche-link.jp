(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{2613:function(e,t,r){Promise.resolve().then(r.bind(r,1286))},1286:function(e,t,r){"use strict";r.d(t,{AdminLayoutContent:function(){return en}});var a=r(7437),n=r(7648),s=r(2265);class l extends s.Component{static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){console.error("[AdminErrorBoundary]",e,t.componentStack)}render(){if(this.state.error){let e=this.state.error,t=e.message||"",r="INTERNAL"===t||t.toUpperCase().includes("INTERNAL")||"internal"===e.code;return(0,a.jsx)("main",{className:"max-w-2xl mx-auto p-6",children:(0,a.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[(0,a.jsx)("p",{className:"font-semibold",children:"表示エラーが発生しました"}),(0,a.jsx)("p",{className:"mt-2 break-all",children:r?"通信エラーが発生しました。しばらくしてから「再試行」を押すか、画面を更新してください。":t}),(e.stack||"").length>0&&(0,a.jsx)("pre",{className:"mt-3 max-h-40 overflow-auto whitespace-pre-wrap text-xs text-red-700",children:e.stack}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>this.setState({error:null}),className:"min-h-touch rounded bg-red-600 px-4 py-2.5 text-white hover:bg-red-700",children:"再試行"}),(0,a.jsx)(n.default,{href:"/admin/register",className:"min-h-touch block text-center rounded border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50",children:"新規ショップ登録はこちら"})]})]})})}return this.props.children}constructor(e){super(e),this.state={error:null}}}var i=r(9376),c=r(31),o=r(6515),d=r(9450),u=r(7293);let x=[0,400,900,1500,2200,3e3,3900,4900,6e3,7200],h=[0,300,600,1e3],m=[0,200,500,1e3,1500,2e3,3e3],f=[0,100,200,400,600];function p(){var e;let t=null===(e=window.location.search)||void 0===e?void 0:e.trim();return t?"".concat(c.SX).concat(t.startsWith("?")?t:"?".concat(t)):c.SX}function g(e){let{children:t}=e,r=(0,i.usePathname)(),[n,l]=(0,s.useState)(!1),[g,b]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),N=(0,s.useRef)(!1),v=(0,s.useRef)(!1),y=(0,s.useRef)(!1),k=(0,s.useRef)(!1),E=async()=>{if(await new Promise(e=>setTimeout(e,500)),!v.current)for(let a=0;a<x.length;a++){if(v.current||a>0&&(await new Promise(e=>setTimeout(e,x[a])),v.current))return;try{if(await Promise.race([(0,o.$w)(c.p3),new Promise((e,t)=>setTimeout(()=>t(Error("LIFF の初期化がタイムアウトしました")),2e4))]),v.current)return;let a=(0,o.DT)(),n=(0,o.jl)();if(a&&!n)for(let e of h){if(e>0&&(await new Promise(t=>setTimeout(t,e)),v.current))return;if(n=(0,o.jl)())break}if(a&&!n){y.current=!0,b(!0),(0,o.Lq)(p());return}let s=null;for(let e of m){if(e>0&&await new Promise(t=>setTimeout(t,e)),v.current)return;if(s=await (0,o.Tc)())break}if(!s){y.current=!0,b(!0),(0,o.Lq)(p());return}try{var e,t,r;if(await (0,d.T)(s),v.current)return;let a=(0,u.E7)(),n=null==a?void 0:null===(e=a.currentUser)||void 0===e?void 0:e.uid;if(!n)for(let e of f){if(e>0&&await new Promise(t=>setTimeout(t,e)),v.current)return;if(n=null!==(r=null==a?void 0:null===(t=a.currentUser)||void 0===t?void 0:t.uid)&&void 0!==r?r:void 0)break}if(!n){y.current=!0,b(!0),(0,o.Lq)(p());return}}catch(e){if(v.current)return;y.current=!0,b(!0),(0,o.Lq)(p());return}v.current||(y.current=!0,l(!0));return}catch(t){let e=t instanceof Error?t:String(t);if(v.current)return;if(a===x.length-1){y.current=!0;let t=window.location.href,r=e instanceof Error?e.message:String(e);w(t?"".concat(t,"\n").concat(r):r),l(!0)}}}};if((0,s.useEffect)(()=>{document.body.dataset.adminReady="1"},[]),(0,s.useEffect)(()=>{if(!N.current){if(N.current=!0,v.current=!1,"undefined"!=typeof sessionStorage&&"1"===sessionStorage.getItem(c.tE)&&(0,o.jl)()){sessionStorage.removeItem(c.tE),y.current=!0,l(!0);return}return E(),()=>{v.current=!0,N.current=!1}}},[]),(0,s.useEffect)(()=>{if(n||g||j)return;let e=setTimeout(()=>{y.current||(window.location.href=c.KC)},25e3);return()=>clearTimeout(e)},[n,g,j]),(0,s.useEffect)(()=>{let e=e=>{e.persisted&&(N.current=!1,l(!1),b(!1),w(null),v.current=!1,E())};return window.addEventListener("pageshow",e),()=>window.removeEventListener("pageshow",e)},[]),g)return(0,a.jsx)("main",{className:"max-w-2xl mx-auto p-6",children:(0,a.jsx)("p",{className:"text-gray-500",children:"LINE でログインしています..."})});if(!n)return(0,a.jsxs)("main",{className:"max-w-2xl mx-auto p-6",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"読み込み中..."}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-400",children:"初回は少し時間がかかることがあります"})]});if(("/admin"===r||"/admin/"===r)&&!(0,o.DT)()&&!k.current)return k.current=!0,window.location.href=c.KC,(0,a.jsx)("main",{className:"max-w-2xl mx-auto p-6",children:(0,a.jsx)("p",{className:"text-gray-500",children:"アプリ内で開き直しています..."})});if(j){var S,L;let e=j.split("\n"),t=(null===(S=e[0])||void 0===S?void 0:S.startsWith("http"))?e[0]:"",r=e.length>1?e.slice(1).join(" "):null!==(L=e[0])&&void 0!==L?L:j,n=t?t.replace(/#.*$/,"").replace(/(access_token|context_token)=[^&]*/gi,"$1=***"):"",s=async()=>{w(null);try{if(await (0,o.$w)(c.p3),(0,o.DT)()&&!(0,o.jl)()){(0,o.Lq)(p());return}l(!0)}catch(r){let e=window.location.href,t=r instanceof Error?r.message:String(r);w(e?"".concat(e,"\n").concat(t):t)}};return(0,a.jsxs)("main",{className:"max-w-2xl mx-auto p-6 space-y-4",children:[(0,a.jsx)("p",{className:"text-red-600 font-medium",children:"LINE の初期化に失敗しました"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["管理画面は必ず",(0,a.jsx)("strong",{children:"「LIFF のリンク」"}),"から開いてください。通常の URL（marche-link.jp/admin/）を直接開くと初期化に失敗します。",(0,a.jsxs)("span",{className:"block mt-1",children:["marche-link.jp/admin/?line_debug=1 のように",(0,a.jsx)("strong",{children:"通常 URL に ?line_debug=1 を付けても LIFF にならない"}),"ため、デバッグ時も「LIFF のリンク」に ?line_debug=1 を付けたものを LINE で開いてください。"]})]}),(0,a.jsxs)("p",{className:"text-sm text-amber-800 bg-amber-50 border border-amber-200 rounded-lg p-3",children:[(0,a.jsx)("strong",{children:"確実にログインするには"}),"、下のリンク（admin-entry）をタップして開き直してください。LINE Developers では、",(0,a.jsx)("strong",{children:"共有・オンボーディング用 LIFF"})," の Endpoint を ",(0,a.jsx)("code",{className:"bg-amber-100 px-1 rounded",children:"https://marche-link.jp/admin-entry/"}),"、",(0,a.jsx)("strong",{children:"顧客ショップ内「管理画面」用 LIFF"})," の Endpoint を ",(0,a.jsx)("code",{className:"bg-amber-100 px-1 rounded",children:"https://marche-link.jp/admin/"})," に設定してください。"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"「再読み込み」では直りません。"})," 同じ URL で開き直すだけなので LINE のコンテキストが付かず、初期化は必ず失敗します。必ず下のリンクをタップして開き直してください。"]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:"既にショップをお持ちの場合は、下のリンクをタップして開き直すと商品一覧に進みます。"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-800",children:"以下のリンクをタップして開き直してください（LINE のトークに送ってからタップしても同じです）。"}),(0,a.jsx)("p",{className:"text-sm bg-gray-100 p-3 rounded-lg",children:(0,a.jsx)("a",{href:c.KC,target:"_self",rel:"noopener noreferrer",className:"break-all text-[var(--admin-accent)] underline focus:outline-none focus:ring-2 focus:ring-[var(--admin-accent)]",children:c.KC})}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["デバッグ用（ログイン時の alert を出す）:"," ",(0,a.jsxs)("a",{href:"".concat(c.KC,"?line_debug=1"),target:"_self",rel:"noopener noreferrer",className:"break-all font-mono text-[var(--admin-accent)] underline",children:[c.KC,"?line_debug=1"]})]}),n&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 break-all",children:["現在のURL: ",n]}),r&&!r.startsWith("http")&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 break-all",children:["エラー: ",r]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"min-h-touch rounded-xl bg-[var(--admin-accent)] px-4 py-3 text-sm font-medium text-white",children:"もう一度試す"}),(0,a.jsx)("a",{href:c.KC,target:"_self",rel:"noopener noreferrer",className:"min-h-touch inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 no-underline",children:"LIFF リンクで開き直す"})]})]})}return(0,a.jsx)(a.Fragment,{children:t})}var b=r(5978),j=r(8736),w=r(3117),N=r(3388),v=r(2023),y=r(6275),k=r(4794),E=r(2718),S=r(9090),L=r(4413),C=r(7168),I=r(6942),T=r(6679);let F=(0,s.createContext)(null);function Z(e){let{children:t}=e,[r,n]=(0,s.useState)(null),l=(0,s.useMemo)(()=>({lineAuthError:r,setLineAuthError:n}),[r]);return(0,a.jsx)(F.Provider,{value:l,children:t})}var P=r(3582),D=r(6363),W=r(2498),q=r(8045);function R(){var e;let t=(0,i.useRouter)(),r=(0,i.usePathname)(),{user:n,loading:l,signInWithLine:d}=(0,I.a)(),{storeIds:x,loading:h,refetch:m}=(0,T.dD)(),{lineAuthError:f,setLineAuthError:p}=function(){let e=(0,s.useContext)(F);return null!=e?e:{lineAuthError:null,setLineAuthError:()=>{}}}(),[g,Z]=(0,s.useState)(!1),[R,_]=(0,s.useState)(null),[M,z]=(0,s.useState)(!1),[U,A]=(0,s.useState)(!1),[B,O]=(0,s.useState)(!1),[$,K]=(0,s.useState)(""),[J,V]=(0,s.useState)(!1),[X,G]=(0,s.useState)(null),[H,Q]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=!1;return(0,o.$w)(c.p3).then(()=>{e||z(!0)}),()=>{e=!0}},[]),(0,s.useEffect)(()=>{A((0,q.Mn)())},[n,x.length]);let Y=(0,s.useCallback)(()=>{window.location.reload()},[]),ee=(0,s.useCallback)(async()=>{Z(!0),_(null),p(null);let e=Date.now();try{await d(),await m()}catch(e){_(e instanceof Error?e.message:"LINE 認証に失敗しました。")}finally{let t=Date.now()-e;t<600&&await new Promise(e=>setTimeout(e,600-t)),Z(!1)}},[d,m,p]),et=(0,s.useCallback)(async()=>{let e=$.trim();if(!e){G("ショップ名を入力してください。");return}G(null),V(!0);try{if(await (0,o.$w)(c.p3),!(0,o.DT)()){G("LINE アプリ内で開いてから、もう一度お試しください。"),V(!1);return}(null==n?void 0:n.uid)||(_(null),p(null),await d(),await m());let{storeId:r,buttonColor:a}=await (0,P.W)(e);try{let t=await (0,D.$)(e,a),n=new FormData;n.append("image",t,"icon.jpg"),n.append("subdomain",r);let s=W.E.baseUrl,l=await fetch("".concat(s,"/upload-shop-icon.php"),{method:"POST",body:n}),i=await l.json().catch(()=>({}));if(l.ok&&i.success&&"string"==typeof i.url){let e=(0,u.T)();if(e){let t=i.url.startsWith("http")?i.url:"".concat(s).concat(i.url);await (0,b.r7)((0,b.JU)(e,"stores",r),{iconUrl:t,updatedAt:(0,b.Bt)()})}}}catch(e){}Q(!0),V(!1),sessionStorage.setItem("marche-link-admin-just-created-shop","1"),m(()=>{t.replace("/admin/products/quick?created=".concat(encodeURIComponent(e)))})}catch(e){G(e instanceof Error?e.message:"開店処理に失敗しました。")}finally{V(!1)}},[$,null==n?void 0:n.uid,d,m,p,t]);(0,s.useCallback)(()=>{let e=$.trim();if(!e){G("ショップ名を入力してください。");return}V(!0),G(null),(0,P.W)(e).then(async r=>{let{storeId:a,buttonColor:n}=r;try{let t=await (0,D.$)(e,n),r=new FormData;r.append("image",t,"icon.jpg"),r.append("subdomain",a);let s=W.E.baseUrl,l=await fetch("".concat(s,"/upload-shop-icon.php"),{method:"POST",body:r}),i=await l.json().catch(()=>({}));if(l.ok&&i.success&&"string"==typeof i.url){let e=(0,u.T)();if(e){let t=i.url.startsWith("http")?i.url:"".concat(s).concat(i.url);await (0,b.r7)((0,b.JU)(e,"stores",a),{iconUrl:t,updatedAt:(0,b.Bt)()})}}}catch(e){}Q(!0),sessionStorage.setItem("marche-link-admin-just-created-shop","1"),m(()=>{t.replace("/admin/products/quick?created=".concat(a))})}).catch(e=>{G(e instanceof Error?e.message:"ショップの作成に失敗しました。")}).finally(()=>V(!1))},[$,m,t]);let er=null!==(e=null==r?void 0:r.startsWith("/admin/register"))&&void 0!==e&&e,ea=("/admin"===r||"/admin/"===r)&&!er&&(0,o.DT)()&&(0===x.length||h);return((0,s.useEffect)(()=>{if(!ea)return;let e=document.title;return document.title="マルシェリンク | 30秒で開ける、あなたのネットショップ",()=>{document.title=e}},[ea]),ea)?(M&&(0,o.DT)(),(0,a.jsx)("div",{className:"fixed inset-0 z-[100] flex min-h-screen flex-col bg-earth-50",role:"dialog","aria-modal":"true","aria-labelledby":"admin-landing-title",children:(0,a.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto",children:[(0,a.jsx)("section",{className:"relative w-full bg-earth-100",children:(0,a.jsxs)("div",{className:"aspect-square max-w-md mx-auto w-full relative overflow-hidden",children:[B?(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-earth-200 via-earth-100 to-earth-200","aria-hidden":!0}):(0,a.jsx)("img",{src:"/LP02.jpg",alt:"こだわりのお店を、スマートに。マルシェリンクで叶える",className:"absolute inset-0 w-full h-full object-cover",width:1e3,height:1e3,sizes:"(max-width: 448px) 100vw, 448px",onError:()=>O(!0)}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-earth-900/60 via-transparent to-transparent"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-5 pb-8 text-white",children:(0,a.jsxs)("h1",{id:"admin-landing-title",className:"font-serif text-xl sm:text-2xl font-semibold leading-snug tracking-wide drop-shadow",children:["名前を決めるだけで、",(0,a.jsx)("br",{}),"あなたらしいお店がそこに。"]})})]})}),(0,a.jsxs)("section",{className:"w-full py-4 px-5 text-center",style:{backgroundColor:"#8B7E74"},"aria-label":"料金について",children:[(0,a.jsx)("p",{className:"font-serif text-white text-lg font-medium",children:"初期費用・月額費用・販売手数料 ずっと0円。"}),(0,a.jsx)("p",{className:"mt-1 text-white/95 text-sm font-sans",children:"売上はすべて作り手のもの。まずはリスクなく始められます。"})]}),(0,a.jsx)("section",{className:"px-5 pt-8 pb-6 max-w-lg mx-auto",children:(0,a.jsx)("p",{className:"font-serif text-earth-800 text-[15px] leading-relaxed tracking-wide",children:"ショップ名に込めた想いを、私たちがデザインに仕立てます。 難しい設定も、長い準備もいりません。 あなたの「売りたい」と思った瞬間に、素敵な店構えでお客様をお迎えしましょう。"})}),(0,a.jsxs)("section",{className:"px-5 pb-10 max-w-lg mx-auto",children:[(0,a.jsx)("h2",{className:"font-serif text-earth-800 text-lg font-semibold text-center mb-6",children:"もう、事務作業に追われる必要はありません。"}),(0,a.jsxs)("div",{className:"rounded-2xl border border-earth-200/80 bg-earth-100 overflow-hidden shadow-sm",children:[(0,a.jsxs)("div",{className:"p-5 pb-4 bg-earth-200/50 border-b border-earth-200/80",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-300/80 text-earth-700",children:(0,a.jsx)(j.Z,{className:"h-4 w-4","aria-hidden":!0})}),(0,a.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-300/80 text-earth-700",children:(0,a.jsx)(w.Z,{className:"h-4 w-4","aria-hidden":!0})})]}),(0,a.jsx)("p",{className:"font-sans text-earth-700 text-sm leading-relaxed",children:"手書きの伝票、散らばるDM、夜中の電卓計算…"})]}),(0,a.jsx)("div",{className:"flex items-center justify-center py-2 text-earth-400","aria-hidden":!0,children:(0,a.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,a.jsxs)("div",{className:"p-5 pt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,a.jsx)(N.Z,{className:"h-4 w-4","aria-hidden":!0})}),(0,a.jsx)("span",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,a.jsx)(v.Z,{className:"h-4 w-4","aria-hidden":!0})})]}),(0,a.jsx)("p",{className:"font-sans text-earth-800 text-sm leading-relaxed",children:"マルシェリンクなら、スマホひとつで完結。あなたの時間は、ものづくりのために。"})]})]})]}),(0,a.jsxs)("section",{className:"px-5 space-y-8 pb-10 max-w-lg mx-auto",children:[(0,a.jsxs)("article",{className:"flex gap-4",children:[(0,a.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,a.jsx)(y.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"職人の手仕事に、スマートな管理を"}),(0,a.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"注文を一元管理。手書きのメモやSNSのDMに埋もれていた注文を、ひとつの場所へ。 受注からお届けまで、大切な商品を待つお客様一人ひとりと、ゆとりを持って向き合えます。"})]})]}),(0,a.jsxs)("article",{className:"flex gap-4",children:[(0,a.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,a.jsx)(k.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"撮る、並べる、それだけで開店"}),(0,a.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"商品登録がかんたん。今日焼けた最高のパン、今朝採れたての野菜。 写真を撮って価格を添えるだけで、あなたのショップが色鮮やかに。 「今、一番いいもの」を、すぐにお客さまの元へ届けられます。"})]})]}),(0,a.jsxs)("article",{className:"flex gap-4",children:[(0,a.jsx)("span",{className:"flex h-11 w-11 shrink-0 items-center justify-center rounded-full bg-earth-200 text-earth-700",children:(0,a.jsx)(E.Z,{className:"h-5 w-5","aria-hidden":!0})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-earth-900 text-base",children:"いつものLINEで、心通う商売"}),(0,a.jsx)("p",{className:"text-earth-700 text-sm mt-1 leading-relaxed",children:"LINEでお客様とつながる。使い慣れたLINEの中に、あなたのお店を。 お客様はトーク画面から流れるように注文でき、 店主のあなたは、日々の暮らしの延長で軽やかにお店を運営できます。"})]})]})]}),(0,a.jsxs)("section",{className:"px-5 pt-4 pb-[max(2.5rem,env(safe-area-inset-bottom))] max-w-md mx-auto w-full border-t border-earth-200/80 bg-earth-50/90",children:[(0,a.jsx)("p",{className:"font-serif text-earth-800 text-lg font-medium text-center mt-6",children:"開店まで、わずか30秒。"}),(0,a.jsx)("p",{className:"text-earth-700 text-sm text-center mt-2 leading-relaxed",children:"あなたのショップ名を入力して、下のボタンで開店してください。 LINE でログインしていればそのまま、未ログインならログインしてから開店します。"}),(0,a.jsx)("div",{className:"mt-6 flex flex-col gap-3",children:U?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-earth-700 text-sm text-center",children:"既に登録済みの方はログインしてください。"}),(0,a.jsx)("p",{className:"text-earth-500 text-xs text-center",children:"LINE アプリ内で開いている場合のみ利用できます。"}),(0,a.jsxs)("button",{type:"button",onClick:ee,disabled:g,className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl border-2 border-earth-400 bg-earth-50 px-4 py-3 text-sm font-medium text-earth-800 active:bg-earth-100 disabled:opacity-60",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 shrink-0","aria-hidden":!0}),g?"ログイン中…":"ログイン"]}),R&&(0,a.jsx)("p",{className:"text-amber-700 text-xs text-center",role:"alert",children:R})]}):x.length>=1?(0,a.jsxs)("div",{className:"space-y-2 text-center",children:[(0,a.jsx)("p",{className:"text-earth-700 text-sm",children:"すでにショップをお持ちです。管理画面で商品や注文を管理できます。"}),(0,a.jsxs)("a",{href:"/admin/products/",className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl bg-earth-600 px-5 py-4 text-base font-semibold text-white shadow-md active:bg-earth-700 no-underline",children:[(0,a.jsx)(L.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),"管理画面へ"]})]}):H?(0,a.jsxs)("div",{className:"space-y-3 text-center py-2",children:[(0,a.jsx)("p",{className:"text-earth-800 font-medium",children:"開店しました。"}),(0,a.jsx)("p",{className:"text-earth-700 text-sm",children:"データを確認しています。商品登録へ進みます..."}),(0,a.jsx)("div",{className:"flex justify-center","aria-hidden":!0,children:(0,a.jsx)("span",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-earth-400 border-t-earth-600"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"sr-only",children:"ショップ名"}),(0,a.jsx)("input",{type:"text",value:$,onChange:e=>{K(e.target.value),G(null)},placeholder:"例: 陽だまりパン工房",className:"w-full rounded-2xl border-2 border-earth-300 bg-white px-4 py-3 text-base text-earth-900 placeholder:text-earth-400 focus:border-earth-500 focus:outline-none focus:ring-2 focus:ring-earth-500/20",autoComplete:"organization",disabled:J})]}),(X||R||f)&&(0,a.jsx)("p",{className:"text-amber-700 text-sm text-center",role:"alert",children:X||R||f}),(0,a.jsxs)("button",{type:"button",onClick:et,disabled:J||!$.trim(),className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl bg-earth-600 px-5 py-4 text-base font-semibold text-white shadow-md transition-[transform,opacity] hover:opacity-95 hover:scale-[1.02] active:bg-earth-700 active:scale-[0.99] disabled:opacity-50 disabled:scale-100",children:[(0,a.jsx)(L.Z,{className:"h-5 w-5 shrink-0","aria-hidden":!0}),J?"開店処理中…":"ショップ名を入力して開店する"]}),(0,a.jsx)("p",{className:"text-earth-600/80 text-xs text-center font-sans",children:"※ クレジットカード登録は不要です"}),(0,a.jsxs)("button",{type:"button",onClick:Y,className:"flex min-h-touch w-full items-center justify-center gap-2 rounded-2xl border border-earth-300 bg-white px-4 py-3 text-sm font-medium text-earth-700 active:bg-earth-100",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 shrink-0","aria-hidden":!0}),"認証がうまくいかない場合は画面を更新"]})]})}),(0,a.jsx)("p",{className:"text-earth-500 text-xs text-center mt-4",children:"マルシェリンク marche-link.jp"})]})]})})):null}let _="marche-link-new-order-last-count";function M(e){try{localStorage.setItem(_,String(e))}catch(e){}}let z=(0,s.createContext)(null);function U(e){let{children:t}=e,[r,n]=(0,s.useState)(!1),[l,i]=(0,s.useState)(0),c=(0,s.useRef)(null),o=(0,s.useCallback)(()=>{c.current&&(clearTimeout(c.current),c.current=null),n(!1)},[]),d=(0,s.useCallback)(e=>{let t=function(){try{let e=localStorage.getItem(_);if(null===e||""===e)return null;let t=parseInt(e,10);return Number.isFinite(t)&&t>=0?t:null}catch(e){return null}}();if(null===t||null!==t&&e<=t){M(e);return}let r=e-(null!=t?t:0);M(e),i(r),c.current&&clearTimeout(c.current),n(!0),c.current=setTimeout(o,3e3)},[o]);return(0,a.jsx)(z.Provider,{value:{visible:r,count:l,show:d,hide:o},children:t})}function A(){let e=(0,s.useContext)(z);if(!e)throw Error("useNewOrderNotice must be used within NewOrderNoticeProvider");return e}var B=r(2532),O=r(1277),$=r(3468);let K=[{href:"/admin/products/quick",label:"商品登録",Icon:v.Z},{href:"/admin/products",label:"商品一覧",Icon:$.Z,exact:!0},{href:"/admin/orders",label:"注文管理",Icon:y.Z,exact:!0},{href:"/admin/qrcode",label:"マイストア",Icon:L.Z}];function J(){if("undefined"!=typeof navigator)try{"function"==typeof navigator.vibrate&&navigator.vibrate(20)}catch(e){}}function V(){let e=(0,i.usePathname)();return(0,a.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-50 px-3 pt-1.5 pb-1.5 pb-safe-bottom","aria-label":"メインナビゲーション",style:{background:"transparent"},children:(0,a.jsx)("div",{className:"mx-auto flex max-w-md rounded-full p-1 shadow-lg ring-1 ring-white/40",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.30) 50%, rgba(245,245,250,0.45) 100%)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",boxShadow:"0 8px 32px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.6), inset 0 -1px 0 rgba(0,0,0,0.04)"},children:K.map(t=>{let{href:r,label:s,Icon:l,exact:i}=t,c=i?e===r||e===r+"/":e===r||(null==e?void 0:e.startsWith(r+"/"));return(0,a.jsxs)(n.default,{href:r,className:"flex min-h-touch flex-1 flex-col items-center justify-center rounded-full py-2 text-xs font-medium transition-all duration-300 active:scale-95 ".concat(c?"text-white":"text-gray-600 active:text-gray-900"),style:c?{background:"linear-gradient(135deg, var(--admin-accent) 0%, color-mix(in srgb, var(--admin-accent) 80%, #000) 100%)",boxShadow:"0 4px 16px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.25)"}:void 0,"aria-current":c?"page":void 0,onTouchStart:J,onPointerDown:J,children:[(0,a.jsx)(l,{className:"h-6 w-6 shrink-0","aria-hidden":!0}),(0,a.jsx)("span",{className:"mt-0.5 text-xs",children:s})]},r)})})})}var X=r(8728);function G(){var e,t;let r=(0,i.usePathname)(),{storeName:l}=(0,T.dD)(),c=!!(e=null!=r?r:null)&&("/admin/settings"===e||e.startsWith("/admin/settings/")),o=!!(t=null!=r?r:null)&&("/admin/qrcode"===t||t.startsWith("/admin/qrcode/")),d=o&&l?l:null;return(0,s.useEffect)(()=>{var e;let t=(e=null!=r?r:null)?"/admin/products/quick"===e||e.startsWith("/admin/products/quick/")?"商品登録":"/admin/products"===e||"/admin/products/"===e?"商品一覧":"/admin/orders"===e||e.startsWith("/admin/orders")?"注文管理":"/admin/qrcode"===e||e.startsWith("/admin/qrcode")?"マイストア":"/admin/settings"===e||e.startsWith("/admin/settings/")?"設定":"管理画面":"管理画面";return document.title=o&&l?l:t,()=>{document.title="管理画面"}},[r,l,o]),(0,a.jsxs)("header",{className:"sticky top-0 z-50 flex min-h-touch items-center justify-between px-4 pt-safe-top ring-1 ring-white/30",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.65) 0%, rgba(250,250,252,0.50) 100%)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",boxShadow:"0 1px 12px rgba(0,0,0,0.06), inset 0 -1px 0 rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[(0,a.jsx)("div",{className:"min-w-touch","aria-hidden":!0}),(0,a.jsx)("h1",{className:"flex-1 truncate text-center text-xl font-semibold text-gray-900",children:d}),(0,a.jsx)("div",{className:"flex min-w-touch items-center justify-end gap-1",children:c?(0,a.jsx)(n.default,{href:"/admin",className:"min-h-touch rounded-full px-5 py-2.5 text-sm font-medium text-white active:scale-95 transition-transform duration-200",style:{background:"linear-gradient(135deg, var(--admin-accent) 0%, color-mix(in srgb, var(--admin-accent) 80%, #000) 100%)",boxShadow:"0 4px 16px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.25)"},"aria-label":"設定を完了してトップへ",children:"設定完了"}):(0,a.jsx)(n.default,{href:"/admin/settings",className:"flex min-h-touch min-w-touch items-center justify-center text-gray-600 hover:text-gray-900 active:scale-95 transition-transform duration-200","aria-label":"設定",children:(0,a.jsx)(X.Z,{className:"h-6 w-6","aria-hidden":!0})})})]})}var H=r(316);function Q(){let{show:e}=A();return(0,s.useEffect)(()=>{let t=t=>{let r=t.detail;e("number"==typeof(null==r?void 0:r.count)&&r.count>0?r.count:1)};return window.addEventListener(H.S,t),()=>window.removeEventListener(H.S,t)},[e]),null}function Y(){let{visible:e,count:t,hide:r}=A();return e?(0,a.jsx)("div",{className:"fixed left-1/2 top-[calc(env(safe-area-inset-top)+2.75rem)] z-40 w-[min(20rem,78vw)] -translate-x-1/2",role:"alert",children:(0,a.jsx)(n.default,{href:"/admin/orders",onClick:r,className:"flex items-center justify-center rounded-xl bg-[var(--admin-accent)] px-4 py-3 text-center text-sm font-medium text-white shadow-lg no-underline active:opacity-90",children:t>=100?"新しい注文が".concat(100,"件以上来ています！"):"新しい注文が".concat(t,"件来ています！")})}):null}function ee(){let{storeIds:e,loading:t,newOrderNotificationEnabled:r}=(0,T.dD)(),a=(0,s.useRef)(null),n=(0,s.useRef)(0);return(0,s.useEffect)(()=>{if(!r||t||0===e.length)return;let n=e[0];a.current!==n&&(a.current=n,(0,H.i)(n))},[e,t,r]),(0,s.useEffect)(()=>{if(!r||0===e.length)return;let t=e[0],a=()=>{if("visible"!==document.visibilityState)return;let e=Date.now();e-n.current<5e3||(n.current=e,(0,H.i)(t))};return document.addEventListener("visibilitychange",a),()=>document.removeEventListener("visibilitychange",a)},[e,r]),null}function et(e){let{children:t}=e,[r,n]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{let e=setTimeout(()=>n(!0),80);return()=>clearTimeout(e)},[]),r)?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("main",{className:"max-w-2xl mx-auto p-6",children:(0,a.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})})}function er(e){let{children:t}=e,{theme:r,loading:n}=(0,T.dD)(),s=null==r?void 0:r.buttonColor,l=n||!s||"#2563eb"===s?"#6b7280":s,i=function(e,t){let r=e.replace(/^#/,"");if(6!==r.length&&3!==r.length)return e;let a=(6===r.length?[parseInt(r.slice(0,2),16),parseInt(r.slice(2,4),16),parseInt(r.slice(4,6),16)]:[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)]).map(e=>Math.round(.35*e+165.75));return"#".concat(a.map(e=>e.toString(16).padStart(2,"0")).join(""))}(l,0);return(0,a.jsx)("div",{className:"flex min-h-screen flex-col",style:{"--admin-accent":l,"--admin-accent-light":i,background:"linear-gradient(180deg, #f2f2f7 0%, #e5e5ea 100%)"},children:t})}function ea(e){let{children:t}=e,{minimized:r}=(0,B.n)();return r?(0,a.jsx)(O.u,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(G,{}),(0,a.jsx)(Q,{}),(0,a.jsx)(Y,{}),(0,a.jsx)(ee,{}),(0,a.jsx)(et,{children:(0,a.jsxs)(Z,{children:[(0,a.jsx)(R,{}),(0,a.jsx)(g,{children:(0,a.jsx)("main",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-y-none pt-4 px-4 pb-[max(6rem,calc(5rem+env(safe-area-inset-bottom)))]",style:{WebkitOverflowScrolling:"touch"},children:t})})]})}),(0,a.jsx)(V,{})]})}function en(e){let{children:t}=e;return(0,a.jsx)(l,{children:(0,a.jsx)(T.Be,{children:(0,a.jsx)(U,{children:(0,a.jsx)(er,{children:(0,a.jsx)(B.y,{children:(0,a.jsx)(ea,{children:t})})})})})})}},1277:function(e,t,r){"use strict";r.d(t,{u:function(){return i}});var a=r(7437),n=r(2532),s=r(6515),l=r(2489);function i(){let{setMinimized:e}=(0,n.n)();return(0,a.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 z-[100] flex items-center justify-between border-t border-gray-200 bg-white/95 px-4 py-3 pb-safe-bottom shadow-lg backdrop-blur-md",role:"banner",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>e(!1),className:"flex min-h-touch flex-1 items-center gap-2 text-left","aria-label":"元に戻す",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"マルシェリンク"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"タップで元に戻す"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>(0,s.lA)(),className:"flex min-h-touch min-w-touch items-center justify-center rounded-full p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700","aria-label":"アプリを閉じる",children:(0,a.jsx)(l.Z,{className:"h-5 w-5",strokeWidth:2.5})})]})}},2532:function(e,t,r){"use strict";r.d(t,{n:function(){return i},y:function(){return l}});var a=r(7437),n=r(2265);let s=(0,n.createContext)(null);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(!1),i={minimized:r,setMinimized:(0,n.useCallback)(e=>l(e),[])};return(0,a.jsx)(s.Provider,{value:i,children:t})}function i(){let e=(0,n.useContext)(s);return null===e?{minimized:!1,setMinimized:()=>{}}:e}},316:function(e,t,r){"use strict";r.d(t,{S:function(){return s},i:function(){return l}});var a=r(5978),n=r(7293);let s="marche-link:new-orders";async function l(e){let t=(0,n.T)(),r=null==e?void 0:e.trim().toLowerCase();if(t&&r)try{let e=(0,a.IO)((0,a.hJ)(t,"stores",r,"orders"),(0,a.ar)("status","==","unpaid"),(0,a.b9)(100)),n=(await (0,a.PL)(e)).size;n>0&&window.dispatchEvent(new CustomEvent(s,{detail:{count:n}}))}catch(e){}}},3468:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]])},7168:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8728:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[358,990,249,648,679,302,971,117,744],function(){return e(e.s=2613)}),_N_E=e.O()}]);